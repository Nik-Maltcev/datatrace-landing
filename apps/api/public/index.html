<!doctype html>
<html lang="ru">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DataTrace ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ç–µ—á–µ–∫</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      color-scheme: light dark;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial;
      background: #0f1115;
      color: #e6e8ef;
    }

    .container {
      max-width: 880px;
      margin: 48px auto;
      padding: 0 20px;
    }

    .card {
      background: #141824;
      border: 1px solid #23283b;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
    }

    h1 {
      font-size: 26px;
      margin: 0 0 12px;
      letter-spacing: 0.2px;
    }

    p.muted {
      color: #a3acc3;
      margin: 0 0 20px;
    }

    .row {
      display: flex;
      gap: 12px;
    }

    input[type="text"] {
      flex: 1;
      background: #0f1320;
      color: #e6e8ef;
      border: 1px solid #2a3046;
      border-radius: 12px;
      padding: 14px 16px;
      outline: none;
      font-size: 15px;
    }

    input[type="text"]:focus {
      border-color: #415bff;
      box-shadow: 0 0 0 4px rgba(65, 91, 255, 0.12);
    }

    button {
      background: #415bff;
      color: #fff;
      border: 0;
      padding: 14px 18px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      min-width: 160px;
    }

    button:disabled {
      opacity: .6;
      cursor: not-allowed;
    }

    .progress {
      margin: 16px 0 4px;
      height: 8px;
      background: #0f1320;
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid #2a3046;
    }

    .bar {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, #5b7bff, #7c4dff);
      transition: width .35s ease;
    }

    .small {
      font-size: 12px;
      color: #9aa3ba;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-top: 16px;
    }

    .item {
      background: #101524;
      border: 1px solid #23283b;
      border-radius: 12px;
      padding: 16px;
    }

    .item h3 {
      margin: 0 0 6px;
      font-size: 16px;
    }

    .ok {
      color: #6dd193;
    }

    .err {
      color: #ff8080;
    }

    .head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      cursor: pointer;
    }

    .titlewrap {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .caret {
      color: #9aa3ba;
      transition: transform .2s ease;
      user-select: none;
    }

    .item.open .caret {
      transform: rotate(90deg);
    }

    .body {
      display: none;
      margin-top: 10px;
    }

    .item.open .body {
      display: block;
    }

    .mini-btn {
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #2a3046;
      background: #0f1320;
      color: #e6e8ef;
      cursor: pointer;
    }

    .mini-btn:hover {
      border-color: #415bff;
    }

    .mini-btn.danger {
      border-color: rgba(255, 128, 128, 0.45);
      color: #ffb0b0;
    }

    .remove-panel {
      margin: 8px 0 4px;
      padding: 10px;
      border: 1px dashed rgba(255, 128, 128, 0.45);
      background: rgba(255, 128, 128, 0.06);
      border-radius: 10px;
    }

    .remove-panel .step {
      font-size: 13px;
      color: #e6e8ef;
    }

    .badge {
      display: inline-block;
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #2a3046;
      margin-left: 8px;
    }

    /* found -> red */
    .badge.found {
      background: rgba(255, 128, 128, 0.12);
      color: #ff8080;
      border-color: rgba(255, 128, 128, 0.35);
    }

    /* empty (–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö) -> green */
    .badge.empty {
      background: rgba(109, 209, 147, 0.12);
      color: #6dd193;
      border-color: rgba(109, 209, 147, 0.35);
    }

    /* errors remain red */
    .badge.err {
      background: rgba(255, 128, 128, 0.12);
      color: #ff8080;
      border-color: rgba(255, 128, 128, 0.35);
    }

    .rows {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      margin-top: 10px;
    }

    .rowx {
      background: #0f1320;
      border: 1px solid #2a3046;
      border-radius: 10px;
      padding: 10px;
    }

    .rowx .title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .chip {
      font-size: 12px;
      background: #0b1020;
      border: 1px solid #2a3046;
      color: #c9d2ea;
      padding: 2px 8px;
      border-radius: 999px;
    }

    details {
      margin-top: 10px;
    }

    details summary {
      cursor: pointer;
      color: #9aa3ba;
    }

    .kv {
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 6px 12px;
      margin-top: 8px;
    }

    .kv .k {
      color: #9aa3ba;
    }

    .kv .v {
      color: #c9d2ea;
    }

    .sectionTitle {
      margin-top: 10px;
      font-weight: 600;
      color: #e6e8ef;
    }

    .list {
      margin: 6px 0 0;
      padding-left: 18px;
      color: #c9d2ea;
    }

    .footer {
      margin-top: 22px;
      padding: 16px;
      background: #101524;
      border: 1px solid #23283b;
      border-radius: 12px;
    }

    code {
      background: #0f1320;
      padding: 2px 6px;
      border-radius: 6px;
      border: 1px solid #2a3046;
    }

    .summary {
      margin-top: 16px;
      padding: 14px;
      background: #0f1320;
      border: 1px solid #2a3046;
      border-radius: 12px;
    }

    .summary h3 {
      margin: 0 0 8px;
      font-size: 16px;
    }

    /* Company card specific styles */
    #companyReact {
      margin-top: 20px;
    }

    /* Ensure proper spacing and styling for company data */
    #companyReact .bg-gradient-to-br {
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    }

    #companyReact .bg-gradient-to-r {
      background: linear-gradient(90deg, #eff6ff 0%, #e0e7ff 100%);
    }

    /* Responsive improvements */
    @media (max-width: 768px) {
      #companyReact .grid-cols-\[140px_1fr_auto\] {
        grid-template-columns: 1fr;
        gap: 8px;
      }

      #companyReact .max-w-4xl {
        max-width: 100%;
      }
    }

    /* –ù–æ–≤—ã–π –∫—Ä–∞—Å–∏–≤—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */
    .progress-container {
      margin: 20px 0;
      padding: 20px;
      background: #1a1f2e;
      border: 1px solid #2a3046;
      border-radius: 12px;
    }

    .progress-wrapper {
      margin-bottom: 16px;
    }

    .progress-bar {
      width: 100%;
      height: 12px;
      background: #0f1320;
      border-radius: 6px;
      overflow: hidden;
      border: 1px solid #2a3046;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #5b7bff, #7c4dff, #10b981);
      border-radius: 6px;
      transition: width 0.3s ease;
      width: 0%;
      position: relative;
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .progress-text {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      font-size: 14px;
    }

    .progress-text #progressPercent {
      font-weight: 600;
      color: #5b7bff;
      font-size: 16px;
    }

    .progress-text #progressStatus {
      color: #9aa3ba;
    }

    .progress-steps {
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
    }

    .progress-steps::before {
      content: '';
      position: absolute;
      top: 15px;
      left: 15px;
      right: 15px;
      height: 2px;
      background: #2a3046;
      z-index: 1;
    }

    .step {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 2;
    }

    .step-circle {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: #2a3046;
      color: #9aa3ba;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 12px;
      transition: all 0.3s ease;
      border: 2px solid #2a3046;
    }

    .step.active .step-circle {
      background: #5b7bff;
      color: white;
      border-color: #5b7bff;
      box-shadow: 0 0 10px rgba(91, 123, 255, 0.3);
    }

    .step.completed .step-circle {
      background: #10b981;
      color: white;
      border-color: #10b981;
    }

    .step-label {
      margin-top: 8px;
      font-size: 12px;
      color: #9aa3ba;
      text-align: center;
      transition: color 0.3s ease;
    }

    .step.active .step-label {
      color: #5b7bff;
      font-weight: 600;
    }

    .step.completed .step-label {
      color: #10b981;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="card">
      <h1>–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ç–µ—á–µ–∫</h1>
      <p class="muted">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º. –ú—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.</p>
      <div class="row" style="gap: 10px; flex-wrap: wrap; margin-bottom: 8px;">
        <button id="modeLeaks" class="mini-btn" style="border-color:#415bff;color:#aebcff">–ü–æ–∏—Å–∫ —É—Ç–µ—á–µ–∫</button>
        <button id="modeCompany" class="mini-btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é</button>
        <button id="fastMode" class="mini-btn" title="–ë—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º –±–µ–∑ –ò–ò –æ–±—Ä–∞–±–æ—Ç–∫–∏">‚ö° –ë—ã—Å—Ç—Ä–æ</button>
      </div>
      <div class="row" style="gap: 10px; flex-wrap: wrap;">
        <select id="field"
          style="background:#0f1320;color:#e6e8ef;border:1px solid #2a3046;border-radius:12px;padding:14px 12px;min-width:200px;">
          <option value="phone">–¢–µ–ª–µ—Ñ–æ–Ω</option>
          <option value="email">Email</option>
          <option value="vk">VK</option>
          <option value="ok">–û–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–∏</option>
          <option value="inn">–ò–ù–ù</option>
          <option value="snils">–°–ù–ò–õ–°</option>
        </select>
        <input id="q" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: +79990000000" />
        <button id="btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
      </div>
      <!-- –ù–æ–≤—ã–π –∫—Ä–∞—Å–∏–≤—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
      <div id="progressContainer" class="progress-container" style="display: none;">
        <div class="progress-wrapper">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="progress-text">
            <span id="progressPercent">0%</span>
            <span id="progressStatus">–û–∂–∏–¥–∞–Ω–∏–µ...</span>
          </div>
        </div>
        <div class="progress-steps" id="progressSteps">
          <div class="step" data-step="1">
            <div class="step-circle">1</div>
            <div class="step-label">–ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö</div>
          </div>
          <div class="step" data-step="2">
            <div class="step-circle">2</div>
            <div class="step-label">–û–±—Ä–∞–±–æ—Ç–∫–∞ –ò–ò</div>
          </div>
          <div class="step" data-step="3">
            <div class="step-circle">3</div>
            <div class="step-label">–ì–æ—Ç–æ–≤–æ</div>
          </div>
        </div>
      </div>
      
      <!-- –°—Ç–∞—Ä—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä (—Å–∫—Ä—ã—Ç—ã–π) -->
      <div class="progress" aria-hidden="true" style="display: none;">
        <div class="bar" id="bar"></div>
      </div>
      <div class="small" id="status" style="display: none;">–û–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞‚Ä¶</div>

      <div class="grid" id="results"></div>
      <div id="companyReact" class="mt-4"></div>

      <div class="summary" id="summary" style="display:none">
        <h3>–ò—Ç–æ–≥–æ–≤—ã–π –≤—ã–≤–æ–¥ –ò–ò</h3>
        <div id="summaryBody" class="small"></div>
      </div>

      <div class="footer">
        <div style="font-weight:600; margin-bottom:6px;">–£–¥–∞–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç)</div>
        <div>1. —Å—Ç–∞—Ä—Ç—É–π—Ç–µ –±–æ—Ç–∞</div>
        <div>2. –≤—ã–±–µ—Ä–∏—Ç–µ –º–æ–π –ø—Ä–æ—Ñ–∏–ª—å</div>
        <div>3. –Ω–∞–∂–º–∏—Ç–µ "—Å–∫—Ä—ã—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é"</div>
      </div>
    </div>
  </div>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <script>
    const React = window.React;
    const ReactDOM = window.ReactDOM;

    function cx(...a) { return a.filter(Boolean).join(' ') }
    function Badge({ status }) {
      const active = /–¥–µ–π—Å—Ç–≤—É–µ—Ç/i.test(status || '');
      const liq = /–ª–∏–∫–≤–∏–¥/i.test(status || '');
      return React.createElement('span', {
        className: cx('inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-medium border',
          active && 'bg-emerald-50 text-emerald-700 border-emerald-200', liq && 'bg-rose-50 text-rose-700 border-rose-200', !active && !liq && 'bg-slate-100 text-slate-600 border-slate-200')
      }, status || '‚Äî')
    }
    function Row({ label, value, copy }) {
      const [cop, setCop] = React.useState(false);
      return React.createElement('div', { className: 'grid grid-cols-[140px_1fr_auto] items-start gap-3 py-1' },
        React.createElement('div', { className: 'text-sm text-slate-500' }, label),
        React.createElement('div', { className: 'text-sm text-slate-800 break-words' }, value || '‚Äî'),
        copy && value ? React.createElement('button', { className: 'inline-flex items-center gap-1.5 rounded-md border px-2 py-1 text-xs border-slate-200 bg-slate-50 hover:bg-slate-100', onClick: async () => { try { await navigator.clipboard.writeText(String(value)); setCop(true); setTimeout(() => setCop(false), 1200); } catch { } } }, cop ? '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ' : '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å') : null)
    }
    function List({ items }) { if (!items || !items.length) return React.createElement('div', { className: 'text-sm text-slate-500' }, '‚Äî'); return React.createElement('ul', { className: 'text-sm text-slate-800 list-disc pl-5 space-y-1' }, items.map((x, i) => React.createElement('li', { key: i }, x))) }
    function Collapsible({ items, initial = 5 }) {
      const [open, setOpen] = React.useState(false); const shown = open ? items : items.slice(0, initial); return React.createElement(React.Fragment, null,
        React.createElement(List, { items: shown }), items.length > shown.length && React.createElement('button', { onClick: () => setOpen(v => !v), className: 'mt-2 inline-flex items-center gap-1 text-xs text-sky-600 hover:text-sky-700' }, open ? '–°–≤–µ—Ä–Ω—É—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë'))
    }
    function StatusBadge({ status }) {
      const isActive = /–¥–µ–π—Å—Ç–≤—É–µ—Ç/i.test(status || '');
      const isLiquidated = /–ª–∏–∫–≤–∏–¥/i.test(status || '');
      const className = cx(
        'inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-medium border',
        isActive && 'bg-emerald-50 text-emerald-700 border-emerald-200',
        isLiquidated && 'bg-rose-50 text-rose-700 border-rose-200',
        !isActive && !isLiquidated && 'bg-slate-100 text-slate-600 border-slate-200'
      );
      return React.createElement('span', { className }, status || '‚Äî');
    }

    function Section({ title, children }) {
      return React.createElement('div', {
        className: 'rounded-xl border border-slate-200 bg-white/80 p-4 shadow-sm'
      }, [
        React.createElement('h3', {
          key: 'title',
          className: 'text-sm font-semibold text-slate-700 mb-3'
        }, title),
        React.createElement('div', { key: 'content' }, children)
      ]);
    }

    function InfoRow({ label, value, copyable }) {
      const [copied, setCopied] = React.useState(false);
      const text = typeof value === 'string' ? value : undefined;

      return React.createElement('div', {
        className: 'grid grid-cols-[140px_1fr_auto] items-start gap-3 py-2 border-b border-slate-100 last:border-b-0'
      }, [
        React.createElement('div', {
          key: 'label',
          className: 'text-sm font-medium text-slate-500'
        }, label),
        React.createElement('div', {
          key: 'value',
          className: 'text-sm text-slate-800 break-words'
        }, value || '‚Äî'),
        copyable && text ? React.createElement('button', {
          key: 'copy',
          className: 'inline-flex items-center gap-1.5 rounded-md border px-2 py-1 text-xs border-slate-200 bg-slate-50 hover:bg-slate-100 transition-colors',
          onClick: async () => {
            try {
              await navigator.clipboard.writeText(text);
              setCopied(true);
              setTimeout(() => setCopied(false), 1200);
            } catch { }
          }
        }, copied ? '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ' : '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å') : null
      ]);
    }

    function ContactItem({ icon, items, type }) {
      if (!items || !items.length) return null;
      return React.createElement('div', {
        className: 'flex items-center gap-3 text-sm'
      }, [
        React.createElement('div', {
          key: 'icon',
          className: 'w-4 h-4 text-slate-500 flex-shrink-0'
        }, icon),
        React.createElement('div', {
          key: 'items',
          className: 'flex gap-2 flex-wrap'
        }, items.map((item, i) => {
          const href = type === 'email' ? `mailto:${item}` :
            type === 'phone' ? `tel:${item}` :
              type === 'site' ? (/^https?:\/\//i.test(item) ? item : `https://${item}`) : null;
          return React.createElement('a', {
            key: i,
            href,
            className: 'text-blue-600 hover:text-blue-800 hover:underline',
            target: type === 'site' ? '_blank' : undefined,
            rel: type === 'site' ? 'noreferrer' : undefined
          }, item);
        }))
      ]);
    }

    function CollapsibleList({ items, initial = 5 }) {
      const [open, setOpen] = React.useState(false);
      if (!items || !items.length) return React.createElement('div', { className: 'text-sm text-slate-500' }, '‚Äî');

      const shown = open ? items : items.slice(0, initial);
      const hasMore = items.length > shown.length;

      return React.createElement('div', {}, [
        React.createElement('ul', {
          key: 'list',
          className: 'text-sm text-slate-800 list-disc pl-5 space-y-1'
        }, shown.map((x, i) => React.createElement('li', { key: i }, x))),
        hasMore ? React.createElement('button', {
          key: 'toggle',
          onClick: () => setOpen(v => !v),
          className: 'mt-2 inline-flex items-center gap-1 text-xs text-blue-600 hover:text-blue-700'
        }, open ? '–°–≤–µ—Ä–Ω—É—Ç—å' : `–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë (${items.length - shown.length})`) : null
      ]);
    }

    function CompanyCardReact({ data }) {
      console.log('CompanyCardReact data:', data);
      const c = data?.company || {};
      const companyName = c.name || c.fullName || c.shortName || '–ö–æ–º–ø–∞–Ω–∏—è';
      const phones = c.contacts?.phones || [];
      const emails = c.contacts?.emails || [];
      const sites = c.contacts?.sites || [];
      const okMain = data?.okved?.main;
      const okAdd = data?.okved?.additional || [];

      const managers = React.useMemo(() => {
        const res = [];
        if (data?.ceo) res.push({ name: data.ceo.name || data.ceo.fio, position: data.ceo.position || data.ceo.post });
        if (Array.isArray(data?.managers)) res.push(...data.managers);
        return res.filter(Boolean);
      }, [data?.ceo, data?.managers]);

      const owners = data?.owners || [];

      return React.createElement('div', {
        className: 'w-full mx-auto max-w-4xl'
      },
        React.createElement('div', {
          className: 'rounded-2xl border border-slate-200 bg-gradient-to-br from-white to-slate-50 shadow-xl overflow-hidden'
        }, [
          // Header
          React.createElement('div', {
            key: 'header',
            className: 'p-6 border-b border-slate-200 bg-gradient-to-r from-blue-50 to-indigo-50'
          }, [
            React.createElement('div', {
              key: 'title-row',
              className: 'flex items-center justify-between gap-3 mb-2'
            }, [
              React.createElement('h2', {
                key: 'title',
                className: 'text-xl font-bold text-slate-900'
              }, companyName),
              React.createElement(StatusBadge, { key: 'status', status: c.status })
            ]),
            React.createElement('div', {
              key: 'meta',
              className: 'text-sm text-slate-600'
            }, [c.inn ? `–ò–ù–ù ${c.inn}` : '', c.ogrn ? ` ‚Ä¢ –û–ì–†–ù ${c.ogrn}` : '', c.kpp ? ` ‚Ä¢ –ö–ü–ü ${c.kpp}` : ''].filter(Boolean).join(''))
          ]),

          // Content
          React.createElement('div', {
            key: 'content',
            className: 'p-6 grid grid-cols-1 gap-6'
          }, [
            // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            React.createElement(Section, {
              key: 'main',
              title: '–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'
            }, [
              React.createElement(InfoRow, { key: 'short', label: '–ö—Ä–∞—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ', value: c.shortName || c.name }),
              React.createElement(InfoRow, { key: 'full', label: '–ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ', value: c.fullName || c.name }),
              React.createElement(InfoRow, { key: 'reg', label: '–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏', value: c.registration_date }),
              React.createElement(InfoRow, { key: 'opf', label: '–û–ü–§', value: c.opf }),
              c.charter_capital ? React.createElement(InfoRow, { key: 'capital', label: '–£—Å—Ç–∞–≤–Ω–æ–π –∫–∞–ø–∏—Ç–∞–ª', value: c.charter_capital }) : null
            ].filter(Boolean)),

            // –ê–¥—Ä–µ—Å
            c.address ? React.createElement(Section, {
              key: 'address',
              title: '–ê–¥—Ä–µ—Å'
            }, React.createElement(InfoRow, { label: '–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å', value: c.address, copyable: true })) : null,

            // –ö–æ–Ω—Ç–∞–∫—Ç—ã
            (phones.length || emails.length || sites.length) ? React.createElement(Section, {
              key: 'contacts',
              title: '–ö–æ–Ω—Ç–∞–∫—Ç—ã'
            }, React.createElement('div', { className: 'space-y-3' }, [
              React.createElement(ContactItem, { key: 'emails', icon: 'üìß', items: emails, type: 'email' }),
              React.createElement(ContactItem, { key: 'phones', icon: 'üìû', items: phones, type: 'phone' }),
              React.createElement(ContactItem, { key: 'sites', icon: 'üåê', items: sites, type: 'site' })
            ].filter(Boolean))) : null,

            // –û–ö–í–≠–î
            (okMain || okAdd.length) ? React.createElement(Section, {
              key: 'okved',
              title: '–û–ö–í–≠–î'
            }, [
              okMain ? React.createElement('div', {
                key: 'main',
                className: 'text-sm mb-3 p-3 bg-blue-50 rounded-lg'
              }, [
                React.createElement('span', { key: 'label', className: 'font-medium text-blue-900' }, '–û—Å–Ω–æ–≤–Ω–æ–π: '),
                React.createElement('span', { key: 'value', className: 'text-blue-800' }, `${okMain.code || ''} ${okMain.text || okMain.title || ''}`)
              ]) : null,
              okAdd.length ? React.createElement('div', { key: 'additional' }, [
                React.createElement('div', { key: 'label', className: 'text-xs text-slate-500 mb-2' }, '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ:'),
                React.createElement(CollapsibleList, {
                  key: 'list',
                  items: okAdd.map(v => `${v.code || ''} ${v.text || v.title || ''}`),
                  initial: 6
                })
              ]) : null
            ].filter(Boolean)) : null,

            // –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–∏
            managers.length ? React.createElement(Section, {
              key: 'managers',
              title: '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–∏'
            }, React.createElement(CollapsibleList, {
              items: managers.map(m => `${m.name || ''}${m.position ? ` ‚Äî ${m.position}` : ''}`)
            })) : null,

            // –í–ª–∞–¥–µ–ª—å—Ü—ã
            owners.length ? React.createElement(Section, {
              key: 'owners',
              title: '–í–ª–∞–¥–µ–ª—å—Ü—ã –∏ —É—á—Ä–µ–¥–∏—Ç–µ–ª–∏'
            }, React.createElement(CollapsibleList, {
              items: owners.map(o => [o.name, o.share_text, o.inn].filter(Boolean).join(' ‚Äî ')),
              initial: 8
            })) : null
          ].filter(Boolean))
        ])
      );
    }
    const q = document.getElementById('q');
    const fieldSel = document.getElementById('field');
    const btn = document.getElementById('btn');
    const modeLeaks = document.getElementById('modeLeaks');
    const modeCompany = document.getElementById('modeCompany');
    const placeholders = {
      phone: '–ù–∞–ø—Ä–∏–º–µ—Ä: +79990000000',
      email: '–ù–∞–ø—Ä–∏–º–µ—Ä: example@mail.com',
      vk: '–°—Å—ã–ª–∫–∞ –∏–ª–∏ @username –∏–ª–∏ id123',
      ok: '–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å OK –∏–ª–∏ username',
      inn: '–ù–∞–ø—Ä–∏–º–µ—Ä: 781075550363',
      snils: '–ù–∞–ø—Ä–∏–º–µ—Ä: 11581339245'
    };

    function updatePlaceholder() {
      const f = fieldSel.value;
      q.placeholder = placeholders[f] || '–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å';
    }
    updatePlaceholder();
    fieldSel.addEventListener('change', updatePlaceholder);

    const bar = document.getElementById('bar');
    const statusEl = document.getElementById('status');
    const results = document.getElementById('results');

    // –°—Ç–∞—Ä–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (–æ—Å—Ç–∞–≤–ª—è–µ–º –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
    function setProgress(step, total) {
      const pct = Math.round((step / total) * 100);
      bar.style.width = pct + '%';
    }

    // –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    function showProgress() {
      const container = document.getElementById('progressContainer');
      container.style.display = 'block';
      resetProgress();
    }

    function hideProgress() {
      const container = document.getElementById('progressContainer');
      container.style.display = 'none';
    }

    function resetProgress() {
      const fill = document.getElementById('progressFill');
      const percent = document.getElementById('progressPercent');
      const status = document.getElementById('progressStatus');
      const steps = document.querySelectorAll('.step');
      
      fill.style.width = '0%';
      percent.textContent = '0%';
      status.textContent = '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...';
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —à–∞–≥–∏
      steps.forEach(step => {
        step.classList.remove('active', 'completed');
      });
    }

    function updateProgress(percentage, statusText, currentStep = 1) {
      const fill = document.getElementById('progressFill');
      const percent = document.getElementById('progressPercent');
      const status = document.getElementById('progressStatus');
      const steps = document.querySelectorAll('.step');
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
      fill.style.width = percentage + '%';
      percent.textContent = Math.round(percentage) + '%';
      status.textContent = statusText;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —à–∞–≥–∏
      steps.forEach((step, index) => {
        const stepNumber = index + 1;
        step.classList.remove('active', 'completed');
        
        if (stepNumber < currentStep) {
          step.classList.add('completed');
        } else if (stepNumber === currentStep) {
          step.classList.add('active');
        }
      });
    }

    function completeProgress() {
      updateProgress(100, '–ó–∞–≤–µ—Ä—à–µ–Ω–æ', 3);
      setTimeout(() => {
        hideProgress();
      }, 2000); // –°–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
    }

    function h(tag, attrs = {}, ...children) {
      const el = document.createElement(tag);
      for (const [k, v] of Object.entries(attrs || {})) {
        if (k === 'class') el.className = v; else if (k === 'text') el.textContent = v; else el.setAttribute(k, v);
      }
      for (const ch of children) { if (ch == null) continue; if (typeof ch === 'string') el.appendChild(document.createTextNode(ch)); else el.appendChild(ch); }
      return el;
    }

    function joinVals(val) {
      if (val == null) return '';
      if (Array.isArray(val)) return val.filter(Boolean).join('; ');
      return String(val);
    }

    function maskBotName(name) {
      if (!name || typeof name !== 'string') return '';
      const n = name.trim();
      if (n.length <= 2) return n;
      return `${n[0]}‚Ä¶${n[n.length - 1]}`;
    }

    function valueToText(v) {
      if (v == null) return '';
      if (typeof v === 'string' || typeof v === 'number' || typeof v === 'boolean') return String(v);
      try { return JSON.stringify(v); } catch { return String(v); }
    }

    function isNoDataText(str) {
      if (!str || typeof str !== 'string') return false;
      return /(–Ω–µ—Ç\s*–∏–Ω—Ñ–æ—Ä–º|–Ω–µ—Ç\s*–¥–∞–Ω–Ω|no\s*results|not\s*found)/i.test(str);
    }

    function itemHasData(item) {
      if (!item || !item.ok) return false;
      const it = item.items;
      if (typeof it === 'string') {
        return !isNoDataText(it);
      }
      if (Array.isArray(it)) {
        return it.length > 0;
      }
      if (it && typeof it === 'object') {
        // ITP shape: { dbName: { data: [...] }, ... }
        const vals = Object.values(it);
        if (vals.length === 0) return false;
        for (const v of vals) {
          if (v && Array.isArray(v.data) && v.data.length > 0) return true;
        }
        // If object with some keys but no explicit data arrays, assume has content
        return Object.keys(it).length > 0;
      }
      // Fallback to meta
      const mc = item.meta && ((item.meta.count ?? 0) || (item.meta.records ?? 0));
      return !!mc;
    }

    function keyChips(obj, opts = {}) {
      const max = opts.max ?? 12;
      const skip = new Set(['_id', 'id', '__v', '_score', 'data_provider', 'db_name', 'source', 'hits']);
      const chips = [];
      if (obj && typeof obj === 'object') {
        const entries = Object.entries(obj);
        for (const [k, v] of entries) {
          if (chips.length >= max) break;
          if (skip.has(k)) continue;
          const text = valueToText(v);
          if (!text || !String(text).trim()) continue;
          const short = text.length > 160 ? text.slice(0, 157) + '‚Ä¶' : text;
          chips.push(h('span', { class: 'chip' }, `${k}: ${short}`));
        }
      }
      return chips;
    }

    function renderRawBlock(data) {
      const pre = document.createElement('pre');
      pre.style.whiteSpace = 'pre-wrap';
      pre.style.wordBreak = 'break-word';
      pre.textContent = JSON.stringify(data, null, 2);
      const det = h('details', {}, h('summary', {}, '–°—ã—Ä–æ–π –æ—Ç–≤–µ—Ç (JSON)'));
      det.appendChild(pre);
      return det;
    }

    function renderITPContent(item) {
      const wrap = h('div', { class: 'rows' });
      const groups = item.items || {};
      const dbNames = Object.keys(groups);
      for (const db of dbNames) {
        const entries = (groups[db]?.data || []);
        for (const e of entries) {
          const kv = h('div', { class: 'kv' });
          const pushKV = (k, v) => { if (v) { kv.appendChild(h('div', { class: 'k', text: k })); kv.appendChild(h('div', { class: 'v', text: joinVals(v) })); } };
          pushKV('–§–ò–û', e.name);
          pushKV('–¢–µ–ª–µ—Ñ–æ–Ω', e.phone);
          pushKV('Email', e.email);
          pushKV('–ê–¥—Ä–µ—Å', e.address);
          pushKV('–ü–∞—Å–ø–æ—Ä—Ç', e.passport);
          wrap.appendChild(
            h('div', { class: 'rowx' },
              h('div', { class: 'title', text: db }),
              kv
            )
          );
        }
      }
      return wrap;
    }

    function renderDyxlessContent(item) {
      const wrap = h('div', { class: 'rows' });
      const list = Array.isArray(item.items) ? item.items : [];
      const groups = {};
      for (const e of list) {
        const base = e.baseName || e.database || e.source || '–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö';
        if (!groups[base]) groups[base] = [];
        groups[base].push(e);
      }
      const bases = Object.keys(groups);
      for (const base of bases) {
        for (const e of groups[base]) {
          const fullName = e.fullName || [e.first_name, e.last_name].filter(Boolean).join(' ') || e.name || e.username || e.login || '';
          const chips = [];
          if (fullName) chips.push(h('span', { class: 'chip' }, `–§–ò–û: ${fullName}`));
          if (e.first_name && !fullName.includes(e.first_name)) chips.push(h('span', { class: 'chip' }, `–ò–º—è: ${e.first_name}`));
          if (e.last_name && !(fullName && fullName.includes(e.last_name))) chips.push(h('span', { class: 'chip' }, `–§–∞–º–∏–ª–∏—è: ${e.last_name}`));
          const number = e.number || e.phone;
          if (number) chips.push(h('span', { class: 'chip' }, `–¢–µ–ª–µ—Ñ–æ–Ω: ${joinVals(number)}`));
          if (e.address) chips.push(h('span', { class: 'chip' }, `–ê–¥—Ä–µ—Å: ${joinVals(e.address)}`));
          if (e.email) chips.push(h('span', { class: 'chip' }, `Email: ${joinVals(e.email)}`));
          // Fallback: add a few more fields if chips are too few
          if (chips.length < 3) {
            const extra = keyChips(e, { max: 8 });
            for (const ch of extra) {
              if (chips.length >= 8) break;
              chips.push(ch);
            }
          }
          wrap.appendChild(
            h('div', { class: 'rowx' },
              h('div', { class: 'title', text: base }),
              h('div', { class: 'chips' }, ...chips)
            )
          );
        }
      }
      return wrap;
    }

    function renderLeakOsintContent(item) {
      const wrap = h('div', { class: 'rows' });
      const groups = Array.isArray(item.items) ? item.items : [];
      for (const g of groups) {
        const recs = Array.isArray(g.data) ? g.data : [];
        for (const e of recs) {
          const kv = h('div', { class: 'kv' });
          const pushKV = (k, v) => { if (v) { kv.appendChild(h('div', { class: 'k', text: k })); kv.appendChild(h('div', { class: 'v', text: joinVals(v) })); } };
          pushKV('–§–ò–û', e.name);
          pushKV('–¢–µ–ª–µ—Ñ–æ–Ω', e.phone);
          pushKV('Email', e.email);
          pushKV('–ê–¥—Ä–µ—Å', e.address);
          pushKV('–õ–æ–≥–∏–Ω', e.login);
          wrap.appendChild(
            h('div', { class: 'rowx' },
              h('div', { class: 'title', text: g.db || '–ò—Å—Ç–æ—á–Ω–∏–∫' }),
              g.info ? h('div', { class: 'small' }, g.info) : null,
              kv
            )
          );
        }
      }
      return wrap;
    }

    function renderUsersboxContent(item) {
      const wrap = h('div', { class: 'rows' });
      const entries = Array.isArray(item.items) ? item.items : [];
      for (const e of entries) {
        const src = e.source ? `${e.source.database}/${e.source.collection}` : '(–∏—Å—Ç–æ—á–Ω–∏–∫)';
        const docs = Array.isArray(e.hits?.items) ? e.hits.items : [];
        if (docs.length) {
          for (const d of docs) {
            const kv = h('div', { class: 'kv' });
            const pushKV = (k, v) => { if (v) { kv.appendChild(h('div', { class: 'k', text: k })); kv.appendChild(h('div', { class: 'v', text: joinVals(v) })); } };
            pushKV('–§–ò–û', d.full_name || d.name);
            pushKV('–¢–µ–ª–µ—Ñ–æ–Ω', d.phone);
            pushKV('Email', d.email);
            pushKV('–ê–¥—Ä–µ—Å', d.address);
            pushKV('–õ–æ–≥–∏–Ω', d.login);
            wrap.appendChild(
              h('div', { class: 'rowx' },
                h('div', { class: 'title', text: src }),
                kv
              )
            );
          }
        } else {
          const kv = h('div', { class: 'kv' });
          const pushKV = (k, v) => { if (v) { kv.appendChild(h('div', { class: 'k', text: k })); kv.appendChild(h('div', { class: 'v', text: joinVals(v) })); } };
          pushKV('–§–ò–û', e.full_name || e.name);
          pushKV('–¢–µ–ª–µ—Ñ–æ–Ω', e.phone);
          pushKV('Email', e.email);
          pushKV('–ê–¥—Ä–µ—Å', e.address);
          pushKV('–õ–æ–≥–∏–Ω', e.login);
          wrap.appendChild(
            h('div', { class: 'rowx' },
              h('div', { class: 'title', text: src }),
              kv
            )
          );
        }
      }
      return wrap;
    }

    function renderVektorContent(item) {
      const wrap = h('div', { class: 'rows' });
      const dict = item.items || {};
      const arr = Array.isArray(dict) ? dict : Object.values(dict);
      for (const e of arr) {
        const base = e['database'] || '–ò—Å—Ç–æ—á–Ω–∏–∫';
        const kv = h('div', { class: 'kv' });
        const pushKV = (k, v) => { if (v) { kv.appendChild(h('div', { class: 'k', text: k })); kv.appendChild(h('div', { class: 'v', text: joinVals(v) })); } };
        const fio = e['–§–ò–û'] || e['–§–∞–º–∏–ª–∏—è'];
        pushKV('–§–ò–û', fio);
        pushKV('–¢–µ–ª–µ—Ñ–æ–Ω', e['–¢–ï–õ–ï–§–û–ù']);
        pushKV('–î–†', e['–î–ê–¢–ê –†–û–ñ–î–ï–ù–ò–Ø']);
        wrap.appendChild(
          h('div', { class: 'rowx' },
            h('div', { class: 'title', text: base }),
            kv
          )
        );
      }
      return wrap;
    }

    // --- Company mode ---
    function extractAddress(addr) {
      if (!addr) return '';
      if (typeof addr === 'string') return addr;
      const parts = [];
      const pick = (k) => { if (addr[k]) parts.push(addr[k]); };
      pick('value'); pick('unrestricted_value'); pick('address'); pick('full');
      pick('region'); pick('city'); pick('settlement'); pick('street'); pick('house'); pick('building'); pick('block'); pick('office'); pick('room'); pick('flat'); pick('postal_code');
      const s = parts.join(', ');
      if (s) return s;
      try { return JSON.stringify(addr); } catch { return String(addr); }
    }

    function renderDatanewtonContent(item) {
      const wrap = h('div', { class: 'rows' });
      const data = item.items || {};
      // Company
      const company = data.company || {};
      const kvC = h('div', { class: 'kv' });
      const addKV = (k, v) => { if (v != null && String(v).trim() !== '') { kvC.appendChild(h('div', { class: 'k', text: k })); kvC.appendChild(h('div', { class: 'v', text: joinVals(v) })); } };
      addKV('–ò–ù–ù', data.inn || company.inn);
      addKV('–û–ì–†–ù', data.ogrn || company.ogrn);
      addKV('–ö–ü–ü', company.kpp);
      addKV('–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', company.company_names?.full || company.company_names?.short || company.name);
      addKV('–û–ü–§', company.opf);
      addKV('–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏', company.registration_date);
      addKV('–ê–¥—Ä–µ—Å', extractAddress(company.address));
      wrap.appendChild(h('div', { class: 'rowx' }, h('div', { class: 'title', text: '–Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ' }), kvC));

      // Owners
      if (company.owners) {
        const owners = [];
        for (const [k, list] of Object.entries(company.owners)) {
          if (Array.isArray(list)) {
            for (const o of list) {
              const line = [o.name || o.title, o.share_text || o.share, o.inn].filter(Boolean).join(' ‚Äî ');
              if (line) owners.push(line);
            }
          }
        }
        if (owners.length) {
          const box = h('div', { class: 'rowx' }, h('div', { class: 'title', text: '–£—á—Ä–µ–¥–∏—Ç–µ–ª–∏' }));
          const ul = h('ul', { class: 'list' });
          owners.slice(0, 20).forEach(t => ul.appendChild(h('li', {}, t)));
          box.appendChild(ul);
          wrap.appendChild(box);
        }
      }

      // Managers
      if (Array.isArray(company.managers) && company.managers.length) {
        const box = h('div', { class: 'rowx' }, h('div', { class: 'title', text: '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–∏' }));
        const ul = h('ul', { class: 'list' });
        company.managers.slice(0, 20).forEach(m => {
          const t = [m.fio || m.name, m.post || m.position].filter(Boolean).join(' ‚Äî ');
          if (t) ul.appendChild(h('li', {}, t));
        });
        box.appendChild(ul);
        wrap.appendChild(box);
      }

      // OKVEDs
      const okveds = company.okveds || [];
      if (Array.isArray(okveds) && okveds.length) {
        const box = h('div', { class: 'rowx' }, h('div', { class: 'title', text: '–û–ö–í–≠–î' }));
        const ul = h('ul', { class: 'list' });
        okveds.slice(0, 30).forEach(v => {
          const t = [v.code, v.text || v.title].filter(Boolean).join(' ‚Äî ');
          if (t) ul.appendChild(h('li', {}, t));
        });
        box.appendChild(ul);
        wrap.appendChild(box);
      }

      // Contacts
      if (company.contacts) {
        const kv = h('div', { class: 'kv' });
        addKV('–¢–µ–ª–µ—Ñ–æ–Ω', company.contacts.phone);
        addKV('Email', company.contacts.email);
        addKV('–°–∞–π—Ç', company.contacts.site || company.contacts.web || company.contacts.url);
        wrap.appendChild(h('div', { class: 'rowx' }, h('div', { class: 'title', text: '–ö–æ–Ω—Ç–∞–∫—Ç—ã' }), kv));
      }

      // Individual (–ò–ü)
      if (data.individual) {
        const i = data.individual;
        const kv = h('div', { class: 'kv' });
        const push = (k, v) => { if (v) { kv.appendChild(h('div', { class: 'k', text: k })); kv.appendChild(h('div', { class: 'v', text: joinVals(v) })); } };
        push('–§–ò–û', i.fio);
        push('–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏', i.registration_date);
        push('–ò–ù–ù', data.inn);
        wrap.appendChild(h('div', { class: 'rowx' }, h('div', { class: 'title', text: '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å' }), kv));
      }

      return wrap;
    }

    function renderCheckoContent(item) {
      const wrap = h('div', { class: 'rows' });
      const data = item.items || {};
      const kv = h('div', { class: 'kv' });
      const add = (k, v) => { if (v) { kv.appendChild(h('div', { class: 'k', text: k })); kv.appendChild(h('div', { class: 'v', text: joinVals(v) })); } };
      add('–ò–ù–ù', data.inn || data.INN);
      add('–û–ì–†–ù', data.ogrn || data.OGRN);
      add('–ö–ü–ü', data.kpp || data.KPP);
      add('–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', data.name || data.full_name || data.company_name);
      add('–ê–¥—Ä–µ—Å', extractAddress(data.address));
      add('–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å', data.ceo || data.manager || data.head);
      wrap.appendChild(h('div', { class: 'rowx' }, h('div', { class: 'title', text: '–ö–æ–º–ø–∞–Ω–∏—è' }), kv));

      if (Array.isArray(data.founders) && data.founders.length) {
        const box = h('div', { class: 'rowx' }, h('div', { class: 'title', text: '–£—á—Ä–µ–¥–∏—Ç–µ–ª–∏' }));
        const ul = h('ul', { class: 'list' });
        data.founders.slice(0, 20).forEach(f => {
          const t = [f.name, f.share_text || f.share, f.inn].filter(Boolean).join(' ‚Äî ');
          if (t) ul.appendChild(h('li', {}, t));
        });
        box.appendChild(ul);
        wrap.appendChild(box);
      }

      if (Array.isArray(data.okveds) && data.okveds.length) {
        const box = h('div', { class: 'rowx' }, h('div', { class: 'title', text: '–û–ö–í–≠–î' }));
        const ul = h('ul', { class: 'list' });
        data.okveds.slice(0, 30).forEach(v => {
          const t = [v.code, v.title || v.text].filter(Boolean).join(' ‚Äî ');
          if (t) ul.appendChild(h('li', {}, t));
        });
        box.appendChild(ul);
        wrap.appendChild(box);
      }

      return wrap;
    }

    function renderResult(item) {
      const card = document.createElement('div');
      card.className = 'item';

      const head = h('div', { class: 'head' });
      const displayName = (item.name === 'Datanewton' || item.name === 'Checko') ? item.name : maskBotName(item.name);
      const titlewrap = h('div', { class: 'titlewrap' }, h('h3', { text: displayName }));
      const statusWrap = document.createElement('div');
      if (item.ok) {
        const has = itemHasData(item);
        const b = document.createElement('span');
        b.className = has ? 'badge found' : 'badge empty';
        b.textContent = has ? ('–Ω–∞–π–¥–µ–Ω–æ' + (item.meta?.count || item.meta?.records ? ` ‚Äî ${item.meta?.count ?? item.meta?.records}` : '')) : '–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
        statusWrap.appendChild(b);
        if (has) {
          const delBtn = document.createElement('button');
          delBtn.className = 'mini-btn danger';
          delBtn.textContent = '—É–¥–∞–ª–∏—Ç—å';
          delBtn.addEventListener('click', (ev) => {
            ev.stopPropagation();
            // toggle panel
            let panel = body.querySelector('.remove-panel');
            if (!panel) {
              panel = document.createElement('div');
              panel.className = 'remove-panel';
              const title = document.createElement('div');
              title.style.fontWeight = '600';
              title.style.marginBottom = '6px';
              title.textContent = '–£–¥–∞–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏';
              const s1 = document.createElement('div'); s1.className = 'step'; s1.textContent = '1. —Å—Ç–∞—Ä—Ç—É–π—Ç–µ –±–æ—Ç–∞';
              const s2 = document.createElement('div'); s2.className = 'step'; s2.textContent = '2. –≤—ã–±–µ—Ä–∏—Ç–µ –º–æ–π –ø—Ä–æ—Ñ–∏–ª—å';
              const s3 = document.createElement('div'); s3.className = 'step'; s3.textContent = '3. –Ω–∞–∂–º–∏—Ç–µ "—Å–∫—Ä—ã—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é"';
              panel.appendChild(title); panel.appendChild(s1); panel.appendChild(s2); panel.appendChild(s3);
              body.prepend(panel);
              card.classList.add('open');
            } else {
              if (panel.style.display === 'none') { panel.style.display = ''; card.classList.add('open'); } else { panel.style.display = 'none'; }
            }
          });
          statusWrap.appendChild(delBtn);
        }
      } else {
        const b = document.createElement('span');
        b.className = 'badge err';
        b.textContent = '–æ—à–∏–±–∫–∞';
        statusWrap.appendChild(b);
      }
      const caret = h('span', { class: 'caret', text: '‚ñ∏' });
      head.appendChild(titlewrap);
      head.appendChild(statusWrap);
      head.appendChild(caret);
      card.appendChild(head);

      const body = h('div', { class: 'body' });
      if (item.ok) {
        let content = null;
        if (item.name === 'ITP') content = renderITPContent(item);
        else if (item.name === 'Dyxless') content = renderDyxlessContent(item);
        else if (item.name === 'LeakOsint') content = renderLeakOsintContent(item);
        else if (item.name === 'Usersbox') content = renderUsersboxContent(item);
        else if (item.name === 'Vektor') content = renderVektorContent(item);
        else if (item.name === 'Datanewton') content = renderDatanewtonContent(item);
        else if (item.name === 'Checko') content = renderCheckoContent(item);
        if (content) body.appendChild(content);
      }
      let raw = item.ok ? (item.items ?? item.meta ?? {}) : (item.error ?? {});
      if (Array.isArray(raw) && raw.length === 0) raw = { message: '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö' };
      if (raw && typeof raw === 'object' && !Array.isArray(raw) && Object.keys(raw).length === 0) raw = { message: '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö' };
      body.appendChild(renderRawBlock(raw));
      card.appendChild(body);

      head.addEventListener('click', () => {
        card.classList.toggle('open');
      });

      results.appendChild(card);
    }


    const API_BASE = (location.origin && location.origin.startsWith('http')) ? '' : 'http://localhost:3020';

    let companyMode = false;
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    function hasResults() {
      const companyResults = document.getElementById('companyReact').innerHTML.trim();
      const leakResults = document.getElementById('results').innerHTML.trim();
      return companyResults !== '' || leakResults !== '';
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    function clearAllResults() {
      document.getElementById('companyReact').innerHTML = '';
      document.getElementById('results').innerHTML = '';
      document.getElementById('summary').style.display = 'none';
      document.getElementById('q').value = ''; // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
      hideProgress();
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    function showConfirmModal(message, onConfirm, onCancel) {
      // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
      modal.innerHTML = `
        <div class="bg-white rounded-lg p-6 max-w-md mx-4 shadow-xl">
          <div class="flex items-center mb-4">
            <svg class="w-6 h-6 text-amber-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 15.5c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
            <h3 class="text-lg font-semibold text-gray-900">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
          </div>
          <p class="text-gray-600 mb-6">${message}</p>
          <div class="flex justify-end space-x-3">
            <button id="cancelBtn" class="px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
              –û—Ç–º–µ–Ω–∞
            </button>
            <button id="confirmBtn" class="px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors">
              –û—á–∏—Å—Ç–∏—Ç—å
            </button>
          </div>
        </div>
      `;

      document.body.appendChild(modal);

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
      modal.querySelector('#confirmBtn').addEventListener('click', () => {
        document.body.removeChild(modal);
        onConfirm();
      });

      modal.querySelector('#cancelBtn').addEventListener('click', () => {
        document.body.removeChild(modal);
        if (onCancel) onCancel();
      });

      // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          document.body.removeChild(modal);
          if (onCancel) onCancel();
        }
      });
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤
    modeLeaks.addEventListener('click', () => {
      // –ï—Å–ª–∏ —É–∂–µ –≤ —Ä–µ–∂–∏–º–µ —É—Ç–µ—á–µ–∫, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      if (!companyMode) return;

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
      if (hasResults()) {
        showConfirmModal(
          '–ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ "–ü–æ–∏—Å–∫ —É—Ç–µ—á–µ–∫" —Ç–µ–∫—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –æ—á–∏—â–µ–Ω—ã. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?',
          () => {
            // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ - –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º –∏ –æ—á–∏—â–∞–µ–º
            companyMode = false;
            modeLeaks.style.borderColor = '#415bff'; 
            modeLeaks.style.color = '#aebcff';
            modeCompany.style.borderColor = '#2a3046'; 
            modeCompany.style.color = '#e6e8ef';
            fieldSel.disabled = false;
            updatePlaceholder();
            clearAllResults();
          },
          () => {
            // –û—Ç–º–µ–Ω–µ–Ω–æ - –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
          }
        );
      } else {
        // –ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ - –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        companyMode = false;
        modeLeaks.style.borderColor = '#415bff'; 
        modeLeaks.style.color = '#aebcff';
        modeCompany.style.borderColor = '#2a3046'; 
        modeCompany.style.color = '#e6e8ef';
        fieldSel.disabled = false;
        updatePlaceholder();
      }
    });
    
    modeCompany.addEventListener('click', () => {
      // –ï—Å–ª–∏ —É–∂–µ –≤ —Ä–µ–∂–∏–º–µ –∫–æ–º–ø–∞–Ω–∏–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      if (companyMode) return;

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
      if (hasResults()) {
        showConfirmModal(
          '–ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é" —Ç–µ–∫—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –æ—á–∏—â–µ–Ω—ã. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?',
          () => {
            // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ - –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º –∏ –æ—á–∏—â–∞–µ–º
            companyMode = true;
            modeCompany.style.borderColor = '#415bff'; 
            modeCompany.style.color = '#aebcff';
            modeLeaks.style.borderColor = '#2a3046'; 
            modeLeaks.style.color = '#e6e8ef';
            fieldSel.value = 'inn'; 
            fieldSel.disabled = true; 
            updatePlaceholder();
            clearAllResults();
          },
          () => {
            // –û—Ç–º–µ–Ω–µ–Ω–æ - –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
          }
        );
      } else {
        // –ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ - –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        companyMode = true;
        modeCompany.style.borderColor = '#415bff'; 
        modeCompany.style.color = '#aebcff';
        modeLeaks.style.borderColor = '#2a3046'; 
        modeLeaks.style.color = '#e6e8ef';
        fieldSel.value = 'inn'; 
        fieldSel.disabled = true; 
        updatePlaceholder();
      }
    });
    modeLeaks.addEventListener('click', () => {
      companyMode = false;
      modeLeaks.style.borderColor = '#415bff'; modeLeaks.style.color = '#aebcff';
      modeCompany.style.borderColor = '#2a3046'; modeCompany.style.color = '#e6e8ef';
      fieldSel.disabled = false;
      updatePlaceholder();
    });
    modeCompany.addEventListener('click', () => {
      companyMode = true;
      modeCompany.style.borderColor = '#415bff'; modeCompany.style.color = '#aebcff';
      modeLeaks.style.borderColor = '#2a3046'; modeLeaks.style.color = '#e6e8ef';
      fieldSel.value = 'inn'; fieldSel.disabled = true; updatePlaceholder();
    });

    btn.addEventListener('click', async () => {
      const query = (q.value || '').trim();
      if (!companyMode) {
        if (query.length < 3) { alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å (–º–∏–Ω. 3 —Å–∏–º–≤–æ–ª–∞)'); return; }
      } else {
        if (!/^\d{10,12}$/.test(query)) { alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ò–ù–ù (10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä)'); return; }
      }
      
      // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
      results.innerHTML = '';
      document.getElementById('companyReact').innerHTML = '';
      showProgress();
      updateProgress(0, '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...', 1);
      btn.disabled = true;
      try {
        // –®–∞–≥ 1: –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ API
        updateProgress(10, '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º...', 1);
        
        const url = companyMode ? `${API_BASE}/api/company-search` : `${API_BASE}/api/search`;
        const payload = companyMode ? { inn: query } : { query, field: fieldSel.value };
        const r = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
        const data = await r.json();
        const items = data.results || [];
        
        // –®–∞–≥ 1 –∑–∞–≤–µ—Ä—à–µ–Ω: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã
        updateProgress(40, '–î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã, –Ω–∞—á–∏–Ω–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É...', 1);
        
        // AI summary for company mode - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –æ—Ç–¥–µ–ª—å–Ω–æ
        if (companyMode) {
          try {
            // –®–∞–≥ 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ –ò–ò
            updateProgress(50, '–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –ò–ò...', 2);
            console.log('Starting OpenAI processing for each source...');
            
            const mount = document.getElementById('companyReact');
            mount.innerHTML = ''; // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –æ—Ç–¥–µ–ª—å–Ω–æ
            const validItems = items.filter(item => item.ok && item.items);
            for (let i = 0; i < validItems.length; i++) {
              const item = validItems[i];
              
              // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
              const sourceProgress = 50 + (i / validItems.length) * 40; // –æ—Ç 50% –¥–æ 90%
              updateProgress(sourceProgress, `–û–±—Ä–∞–±–æ—Ç–∫–∞ ${item.name} —á–µ—Ä–µ–∑ –ò–ò...`, 2);
              console.log(`Processing ${item.name} with OpenAI...`);
              
              try {
                const openaiResponse = await fetch(`${API_BASE}/api/openai/format-company`, {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    prompt: `–¢—ã ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π. –ù–∞ –≤—Ö–æ–¥ —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å JSON-–æ—Ç–≤–µ—Ç —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–æ–º–ø–∞–Ω–∏–∏ –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ "${item.name}".

–ó–∞–¥–∞—á–∞: –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å —ç—Ç–æ—Ç JSON –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏ –∫—Ä–∞—Å–∏–≤–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏.

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ ‚Äî HTML —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –∏–Ω–ª–∞–π–Ω-—Å—Ç–∏–ª—è–º–∏, –Ω–æ —Å –∫–ª–∞—Å—Å–∞–º–∏ Tailwind CSS.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. –ü–µ—Ä–≤–∞—è —Å–µ–∫—Ü–∏—è ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ (–ø–æ–ª–Ω–æ–µ + —Å–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–µ) –∫—Ä—É–ø–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º, –Ω–∏–∂–µ –ò–ù–ù, –û–ì–†–ù, –¥–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –≤–æ–∑—Ä–∞—Å—Ç –∫–æ–º–ø–∞–Ω–∏–∏.
2. –í—Ç–æ—Ä–∞—è —Å–µ–∫—Ü–∏—è ‚Äî –∞–¥—Ä–µ—Å —Å –∏–∫–æ–Ω–∫–æ–π üìç, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π.
3. –¢—Ä–µ—Ç—å—è —Å–µ–∫—Ü–∏—è ‚Äî —Å—Ç–∞—Ç—É—Å –∫–æ–º–ø–∞–Ω–∏–∏, –≤—ã–¥–µ–ª–∏—Ç—å —Ü–≤–µ—Ç–æ–º (–∑–µ–ª—ë–Ω—ã–π –¥–ª—è "–î–µ–π—Å—Ç–≤—É–µ—Ç", –∫—Ä–∞—Å–Ω—ã–π –¥–ª—è "–õ–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω–∞").
4. –ß–µ—Ç–≤—ë—Ä—Ç–∞—è —Å–µ–∫—Ü–∏—è ‚Äî –û—Å–Ω–æ–≤–Ω–æ–π –û–ö–í–≠–î (–ø–æ–∫–∞–∑–∞—Ç—å –∫–æ–¥ –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫—É), –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ ‚Äî –≤ —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º–æ–º —Å–ø–∏—Å–∫–µ.
5. –ü—è—Ç–∞—è —Å–µ–∫—Ü–∏—è ‚Äî —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–∏ (–§–ò–û, –¥–æ–ª–∂–Ω–æ—Å—Ç—å).
6. –®–µ—Å—Ç–∞—è —Å–µ–∫—Ü–∏—è ‚Äî –∫–æ–Ω—Ç–∞–∫—Ç—ã (email ‚Äî –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π mailto:, —Ç–µ–ª–µ—Ñ–æ–Ω ‚Äî tel:, —Å–∞–π—Ç ‚Äî —Å—Å—ã–ª–∫–∞).
7. –°–µ–¥—å–º–∞—è —Å–µ–∫—Ü–∏—è ‚Äî –∫–∞–ø–∏—Ç–∞–ª –∏ –≤–ª–∞–¥–µ–ª—å—Ü—ã.
8. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å —Å–µ–∫—Ü–∏—é.
9. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π HTML (–Ω–∏–∫–∞–∫–∏—Ö script).
10. –î–æ–±–∞–≤—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞ "${item.name}" –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ –∫–∞—Ä—Ç–æ—á–∫–∏.

–û—Ç–≤–µ—Ç—å —Ç–æ–ª—å–∫–æ HTML-–∫–æ–¥–æ–º.

–í–æ—Ç JSON –æ—Ç ${item.name}: ${JSON.stringify(item)}`,
                    model: 'gpt-5'
                  })
                });

                if (openaiResponse.ok) {
                  const openaiData = await openaiResponse.json();
                  console.log(`${item.name} processed successfully`);
                  
                  // –°–æ–∑–¥–∞–µ–º —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏
                  const sourceContainer = document.createElement('div');
                  sourceContainer.className = 'mb-6 bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden';
                  
                  const header = document.createElement('div');
                  header.className = 'flex items-center justify-between p-4 bg-gray-50 border-b border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors';
                  header.innerHTML = `
                    <div class="flex items-center space-x-3">
                      <h3 class="text-lg font-semibold text-gray-900">${item.name}</h3>
                      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">–Ω–∞–π–¥–µ–Ω–æ</span>
                    </div>
                    <svg class="w-5 h-5 text-gray-500 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  `;
                  
                  const content = document.createElement('div');
                  content.className = 'p-4';
                  content.style.display = 'none'; // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–≤–µ—Ä–Ω—É—Ç–æ
                  content.innerHTML = openaiData.html || `<div class="text-gray-500">–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ—Ç ${item.name}</div>`;
                  
                  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è
                  header.addEventListener('click', () => {
                    const isHidden = content.style.display === 'none';
                    content.style.display = isHidden ? 'block' : 'none';
                    const arrow = header.querySelector('svg');
                    arrow.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';
                  });
                  
                  sourceContainer.appendChild(header);
                  sourceContainer.appendChild(content);
                  mount.appendChild(sourceContainer);
                } else {
                  console.error(`${item.name} processing failed:`, openaiResponse.status);
                  const errorContainer = document.createElement('div');
                  errorContainer.className = 'mb-6 p-4 bg-red-50 border border-red-200 rounded-lg';
                  errorContainer.innerHTML = `<div class="text-red-600">–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ—Ç ${item.name}</div>`;
                  mount.appendChild(errorContainer);
                }
              } catch (e) {
                console.error(`Error processing ${item.name}:`, e);
                const errorContainer = document.createElement('div');
                errorContainer.className = 'mb-6 p-4 bg-red-50 border border-red-200 rounded-lg';
                errorContainer.innerHTML = `<div class="text-red-600">–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ${item.name}: ${e.message}</div>`;
                mount.appendChild(errorContainer);
              }
              
              // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
              setProgress(3 + (i + 1) / items.length * 2, 5);
            }
            
            // –ó–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            // –ó–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            setProgress(5, 5);
            statusEl.textContent = '–ì–æ—Ç–æ–≤–æ';
            completeProgress();
          } catch (e) {
            console.error('Company formatting error:', e);
            const mount = document.getElementById('companyReact');
            mount.innerHTML = '<div class="p-4 text-red-400">–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ò–ò: ' + (e.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') + '</div>';
          }
        } else {
          // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Ç–µ—á–µ–∫ —á–µ—Ä–µ–∑ GPT-5 - –∫–∞–∂–¥—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –æ—Ç–¥–µ–ª—å–Ω–æ
          try {
            console.log('Starting OpenAI processing for leaks sources...');
            statusEl.textContent = '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è...';
            setProgress(3, 5);
            
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            results.innerHTML = '';
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Å –¥–∞–Ω–Ω—ã–º–∏
            const validItems = items.filter(item => item.ok && itemHasData(item));
            console.log(`Processing ${validItems.length} leak sources with GPT-5...`);
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —É—Ç–µ—á–µ–∫ —á–µ—Ä–µ–∑ GPT-5
            for (let i = 0; i < validItems.length; i++) {
              const item = validItems[i];
              console.log(`Processing ${item.name} leaks with OpenAI...`);
              
              try {
                const openaiResponse = await fetch(`${API_BASE}/api/openai/format-company`, {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    prompt: `–ü—Ä–µ–æ–±—Ä–∞–∑—É–π –¥–∞–Ω–Ω—ã–µ —É—Ç–µ—á–µ–∫ –≤ –∫—Ä–∞—Å–∏–≤—ã–π HTML —Å Tailwind CSS.

–ò—Å—Ç–æ—á–Ω–∏–∫: ${item.name}
–î–∞–Ω–Ω—ã–µ: ${JSON.stringify(item)}

–°–æ–∑–¥–∞–π HTML –∫–∞—Ä—Ç–æ—á–∫—É —Å:
1. –ó–∞–≥–æ–ª–æ–≤–æ–∫ "${item.name}" —Å –∫—Ä–∞—Å–Ω—ã–º –±–µ–π–¥–∂–µ–º "–Ω–∞–π–¥–µ–Ω–æ" –∏–ª–∏ –∑–µ–ª–µ–Ω—ã–º "–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö"
2. –ï—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ - –ø–æ–∫–∞–∂–∏ –∏—Ö —Å–ø–∏—Å–∫–æ–º:
   - –§–ò–û
   - –¢–µ–ª–µ—Ñ–æ–Ω (—Å–¥–µ–ª–∞–π —Å—Å—ã–ª–∫–æ–π tel:)
   - Email (—Å–¥–µ–ª–∞–π —Å—Å—ã–ª–∫–æ–π mailto:)
   - –ê–¥—Ä–µ—Å
   - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
   - –î—Ä—É–≥–∏–µ –ø–æ–ª—è
3. –ò—Å–ø–æ–ª—å–∑—É–π –∫–ª–∞—Å—Å—ã: bg-white, shadow-lg, rounded-lg, p-4, text-red-600 –¥–ª—è —É—Ç–µ—á–µ–∫, text-green-600 –¥–ª—è "–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö"
4. –ì—Ä—É–ø–ø–∏—Ä—É–π –ø–æ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö –µ—Å–ª–∏ –∏—Ö –Ω–µ—Å–∫–æ–ª—å–∫–æ

–û—Ç–≤–µ—Ç—å —Ç–æ–ª—å–∫–æ HTML –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π.`,
                    model: 'gpt-5'
                  })
                });

                if (openaiResponse.ok) {
                  const openaiData = await openaiResponse.json();
                  console.log(`${item.name} leaks processed successfully`);
                  
                  // –°–æ–∑–¥–∞–µ–º —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —É—Ç–µ—á–µ–∫
                  const sourceContainer = document.createElement('div');
                  sourceContainer.className = 'mb-6 bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden';
                  
                  const header = document.createElement('div');
                  header.className = 'flex items-center justify-between p-4 bg-gray-50 border-b border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors';
                  header.innerHTML = `
                    <div class="flex items-center space-x-3">
                      <h3 class="text-lg font-semibold text-gray-900">${item.name}</h3>
                      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">–Ω–∞–π–¥–µ–Ω–æ</span>
                    </div>
                    <svg class="w-5 h-5 text-gray-500 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  `;
                  
                  const content = document.createElement('div');
                  content.className = 'p-4';
                  content.style.display = 'none'; // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–≤–µ—Ä–Ω—É—Ç–æ
                  content.innerHTML = openaiData.html || `<div class="text-gray-500">–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ—Ç ${item.name}</div>`;
                  
                  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è
                  header.addEventListener('click', () => {
                    const isHidden = content.style.display === 'none';
                    content.style.display = isHidden ? 'block' : 'none';
                    const arrow = header.querySelector('svg');
                    arrow.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';
                  });
                  
                  sourceContainer.appendChild(header);
                  sourceContainer.appendChild(content);
                  results.appendChild(sourceContainer);
                } else {
                  console.error(`${item.name} leaks processing failed:`, openaiResponse.status);
                  const errorContainer = document.createElement('div');
                  errorContainer.className = 'mb-6 p-4 bg-red-50 border border-red-200 rounded-lg';
                  errorContainer.innerHTML = `<div class="text-red-600">–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ—Ç ${item.name}</div>`;
                  results.appendChild(errorContainer);
                }
              } catch (e) {
                console.error(`Error processing ${item.name} leaks:`, e);
                const errorContainer = document.createElement('div');
                errorContainer.className = 'mb-6 p-4 bg-red-50 border border-red-200 rounded-lg';
                errorContainer.innerHTML = `<div class="text-red-600">–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ${item.name}: ${e.message}</div>`;
                results.appendChild(errorContainer);
              }
              
              // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
              setProgress(3 + (i + 1) / validItems.length * 2, 5);
            }
            
            // –ó–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–ª—è —É—Ç–µ—á–µ–∫
            setProgress(5, 5);
            statusEl.textContent = '–ì–æ—Ç–æ–≤–æ';
            completeProgress();
          } catch (e) {
            console.error('Leaks formatting error:', e);
            results.innerHTML = '<div class="p-4 text-red-400">–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö —É—Ç–µ—á–µ–∫: ' + (e.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞') + '</div>';
            completeProgress();
          }
        }
        statusEl.textContent = '–ì–æ—Ç–æ–≤–æ';
      } catch (e) {
        statusEl.textContent = '–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞';
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>

</html>