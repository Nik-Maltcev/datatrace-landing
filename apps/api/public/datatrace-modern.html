<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DataTrace ‚Äî –ü–æ–∏—Å–∫ —É—Ç–µ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö v2.0</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=PT+Mono:wght@400&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'PT Mono', monospace;
      background: white;
      color: black;
      margin: 0;
      line-height: 1.6;
    }
    
    .container {
      max-width: 880px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    /* –ö–Ω–æ–ø–∫–∏ –≤ —Å—Ç–∏–ª–µ –ª–µ–Ω–¥–∏–Ω–≥–∞ */
    .btn-primary {
      background: black;
      color: white;
      border: 2px solid black;
      padding: 14px 24px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'PT Mono', monospace;
      text-transform: uppercase;
      font-size: 14px;
      letter-spacing: 0.5px;
    }
    
    .btn-primary:hover:not(:disabled) {
      background: white;
      color: black;
    }
    
    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .btn-secondary {
      background: transparent;
      color: black;
      border: 2px solid #e5e7eb;
      padding: 8px 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'PT Mono', monospace;
      font-size: 12px;
      text-transform: uppercase;
    }
    
    .btn-secondary:hover {
      border-color: black;
    }
    
    .btn-secondary.active {
      border-color: black;
      background: black;
      color: white;
    }
    
    /* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
    .input-field {
      background: white;
      color: black;
      border: 2px solid #e5e7eb;
      padding: 14px 16px;
      font-family: 'PT Mono', monospace;
      transition: border-color 0.2s;
      flex: 1;
      font-size: 15px;
      width: 100%;
      max-width: 400px;
      min-width: 320px;
    }
    
    .input-field:focus {
      outline: none;
      border-color: black;
    }
    
    .select-field {
      background: white;
      color: black;
      border: 2px solid #e5e7eb;
      padding: 14px 16px;
      font-family: 'PT Mono', monospace;
      min-width: 200px;
      font-size: 15px;
    }
    
    .select-field:focus {
      outline: none;
      border-color: black;
    }
    
    /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
    .result-card {
      background: white;
      border: 2px solid #e5e7eb;
      padding: 24px;
      margin-bottom: 16px;
      transition: all 0.2s;
    }
    
    .result-card:hover {
      border-color: black;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .result-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      margin-bottom: 16px;
    }
    
    .result-title {
      font-weight: 600;
      font-size: 18px;
      letter-spacing: 0.2px;
    }
    
    .status-badge {
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .status-clean {
      background: #dcfce7;
      color: #166534;
      border: 1px solid #bbf7d0;
    }
    
    .status-found {
      background: #fef2f2;
      color: #dc2626;
      border: 1px solid #fecaca;
    }
    
    .status-error {
      background: #fefce8;
      color: #ca8a04;
      border: 1px solid #fde047;
    }
    
    .result-body {
      display: none;
      padding-top: 16px;
      border-top: 1px solid #e5e7eb;
    }
    
    .result-card.open .result-body {
      display: block;
    }
    
    .caret {
      transition: transform 0.2s ease;
      font-size: 14px;
      color: #6b7280;
    }
    
    .result-card.open .caret {
      transform: rotate(90deg);
    }
    
    /* –ü—Ä–æ–≥—Ä–µ—Å—Å */
    .progress-container {
      margin: 32px 0;
      padding: 24px;
      background: #f9fafb;
      border: 2px solid #e5e7eb;
      display: none;
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e5e7eb;
      overflow: hidden;
      margin-bottom: 16px;
    }
    
    .progress-fill {
      height: 100%;
      background: black;
      transition: width 0.3s ease;
      width: 0%;
    }
    
    .progress-text {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
    }
    
    .progress-percent {
      font-weight: 600;
    }
    
    /* –î–∞–Ω–Ω—ã–µ */
    .data-grid {
      display: grid;
      grid-template-columns: 180px 1fr;
      gap: 12px 16px;
      margin-top: 16px;
    }
    
    .data-label {
      font-weight: 600;
      color: #6b7280;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .data-value {
      color: black;
      word-break: break-word;
      font-size: 14px;
    }
    
    /* –ò—Ç–æ–≥–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ */
    .summary-container {
      margin-top: 32px;
      padding: 24px;
      background: #f9fafb;
      border: 2px solid #e5e7eb;
      display: none;
    }
    
    .summary-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    /* –§—É—Ç–µ—Ä */
    .footer-section {
      margin-top: 48px;
      padding: 32px;
      background: black;
      color: white;
    }
    
    .footer-title {
      font-weight: 600;
      margin-bottom: 16px;
      font-size: 18px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .footer-text {
      font-size: 14px;
      line-height: 1.6;
    }
    
    .footer-text div {
      margin-bottom: 8px;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è */
    .formatted-profile {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      margin-bottom: 20px;
    }

    .profile-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 24px;
    }

    .profile-header h2 {
      color: white !important;
    }

    .view-toggle-btn {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .view-toggle-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.4);
    }

    .view-toggle-btn.active {
      background: white;
      color: #667eea;
      border-color: white;
      font-weight: 600;
    }

    .profile-content {
      padding: 24px;
    }

    .profile-text {
      font-size: 16px;
      line-height: 1.8;
      color: #374151;
    }

    .profile-text h3, .profile-text h4 {
      margin-top: 24px;
      margin-bottom: 12px;
      color: #1f2937;
      font-weight: 700;
    }

    .profile-text p {
      margin-bottom: 12px;
    }

    .profile-text ul {
      margin: 12px 0;
      padding-left: 0;
    }

    .profile-text li {
      margin-bottom: 8px;
      padding: 8px 0;
      border-bottom: 1px solid #f3f4f6;
      list-style: none;
    }

    .profile-text li:last-child {
      border-bottom: none;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-spinner {
      border: 3px solid #f3f4f6;
      border-top: 3px solid #3b82f6;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    /* AI Loading Overlay */
    .ai-loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 9999;
      align-items: center;
      justify-content: center;
    }

    .ai-loading-content {
      background: white;
      padding: 40px;
      border-radius: 16px;
      text-align: center;
      max-width: 420px;
      margin: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .ai-loading-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #1f2937;
    }

    .ai-loading-subtitle {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 32px;
    }

    .ai-spinner {
      width: 50px;
      height: 50px;
      margin: 0 auto 24px;
      border: 4px solid #f3f4f6;
      border-top: 4px solid #3b82f6;
      border-radius: 50%;
      animation: ai-spin 1s linear infinite;
    }

    @keyframes ai-spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .ai-progress-dots {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    .ai-dot {
      width: 10px;
      height: 10px;
      background: #3b82f6;
      border-radius: 50%;
      animation: ai-bounce 1.4s ease-in-out infinite both;
    }

    .ai-dot:nth-child(1) { animation-delay: -0.32s; }
    .ai-dot:nth-child(2) { animation-delay: -0.16s; }
    .ai-dot:nth-child(3) { animation-delay: 0s; }

    @keyframes ai-bounce {
      0%, 80%, 100% { 
        transform: scale(0.6); 
        opacity: 0.5; 
      }
      40% { 
        transform: scale(1.2); 
        opacity: 1; 
      }
    }

    .ai-status-text {
      font-size: 14px;
      color: #4b5563;
      font-weight: 500;
    }

    /* Utility classes */
    .flex {
      display: flex;
    }
    
    .items-center {
      align-items: center;
    }
    
    .gap-3 {
      gap: 12px;
    }

    /* Nothing OS Dashboard Styles */
    .dashboard-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #000000;
      min-height: 100vh;
      font-family: 'PT Mono', monospace;
      color: #ffffff;
    }

    .dashboard-header {
      background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
      border: 2px solid #ffffff;
      padding: 40px;
      margin-bottom: 30px;
      position: relative;
      overflow: hidden;
    }

    .dashboard-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #ff0000 0%, #ffffff 50%, #ff0000 100%);
    }

    .dashboard-title {
      color: #ffffff;
      margin-bottom: 30px;
    }

    .dashboard-title h1 {
      font-size: 32px;
      font-weight: 700;
      color: #ffffff !important;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .dashboard-title p {
      font-size: 16px;
      color: #cccccc;
      line-height: 1.6;
    }

    .dashboard-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 20px;
      text-align: center;
      position: relative;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: #ff0000;
    }

    .stat-number {
      font-size: 28px;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 8px;
    }

    .stat-label {
      font-size: 12px;
      color: #cccccc;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .risk-indicator {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 30px 0;
    }

    .risk-circle {
      width: 150px;
      height: 150px;
      border: 3px solid #333333;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      position: relative;
      background: #000000;
    }

    .risk-circle.high-risk {
      border-color: #ff0000;
      box-shadow: 0 0 30px rgba(255, 0, 0, 0.3);
    }

    .risk-circle.medium-risk {
      border-color: #ffffff;
      box-shadow: 0 0 30px rgba(255, 255, 255, 0.2);
    }

    .risk-circle.low-risk {
      border-color: #ffffff;
      box-shadow: 0 0 30px rgba(255, 255, 255, 0.1);
    }

    .risk-level {
      font-size: 16px;
      font-weight: 700;
      color: #ffffff;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .risk-count {
      font-size: 36px;
      font-weight: 700;
      color: #ff0000;
      margin-bottom: 8px;
    }

    .action-section {
      background: #000000;
      border: 2px solid #ff0000;
      padding: 30px;
      margin-bottom: 30px;
      text-align: center;
      position: relative;
    }

    .action-section::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, #ff0000, #ffffff, #ff0000);
      z-index: -1;
      opacity: 0.1;
    }

    .action-section h2 {
      color: #ff0000 !important;
      font-size: 20px;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .action-section p {
      color: #cccccc;
      margin-bottom: 20px;
    }

    .action-buttons {
      display: flex;
      gap: 16px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .nothing-btn {
      background: #ffffff;
      color: #000000;
      border: 2px solid #ffffff;
      padding: 12px 24px;
      font-family: 'PT Mono', monospace;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .nothing-btn:hover {
      background: #000000;
      color: #ffffff;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
    }

    .nothing-btn.danger {
      background: #ff0000;
      color: #ffffff;
      border-color: #ff0000;
    }

    .nothing-btn.danger:hover {
      background: #ffffff;
      color: #ff0000;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.3);
    }

    .breaches-section {
      background: #000000;
      border: 1px solid #333333;
      margin-bottom: 30px;
    }

    .breaches-section h2 {
      color: #ffffff !important;
      padding: 24px;
      margin: 0;
      font-size: 18px;
      text-transform: uppercase;
      letter-spacing: 1px;
      border-bottom: 1px solid #333333;
    }

    .breaches-section > p {
      padding: 16px 24px;
      color: #cccccc;
      margin: 0;
      border-bottom: 1px solid #333333;
    }

    .table-filters {
      padding: 20px 24px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      border-bottom: 1px solid #333333;
    }

    .nothing-filter-btn {
      background: transparent;
      color: #cccccc;
      border: 1px solid #333333;
      padding: 8px 16px;
      font-family: 'PT Mono', monospace;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .nothing-filter-btn:hover {
      border-color: #ffffff;
      color: #ffffff;
    }

    .nothing-filter-btn.active {
      background: #ffffff;
      color: #000000;
      border-color: #ffffff;
    }

    .nothing-table {
      width: 100%;
      border-collapse: collapse;
      background: #000000;
    }

    .nothing-table th {
      background: #1a1a1a;
      color: #ffffff;
      padding: 16px 24px;
      text-align: left;
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      border-bottom: 1px solid #333333;
    }

    .nothing-table td {
      padding: 16px 24px;
      border-bottom: 1px solid #1a1a1a;
      color: #cccccc;
      vertical-align: middle;
    }

    .nothing-table tr:hover {
      background: rgba(255, 255, 255, 0.02);
    }

    .source-info {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .source-icon {
      width: 40px;
      height: 40px;
      background: #1a1a1a;
      border: 1px solid #333333;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    .source-name {
      font-weight: 600;
      color: #ffffff;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .source-description {
      font-size: 11px;
      color: #666666;
      text-transform: uppercase;
    }

    .nothing-status-badge {
      padding: 6px 12px;
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      border: 1px solid;
    }

    .status-breach {
      background: rgba(255, 0, 0, 0.1);
      color: #ff0000;
      border-color: #ff0000;
    }

    .status-clean {
      background: rgba(255, 255, 255, 0.1);
      color: #ffffff;
      border-color: #ffffff;
    }

    .status-error {
      background: rgba(255, 255, 255, 0.05);
      color: #cccccc;
      border-color: #666666;
    }

    .nothing-details-btn {
      background: transparent;
      border: 1px solid #333333;
      color: #cccccc;
      padding: 6px 12px;
      font-family: 'PT Mono', monospace;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .nothing-details-btn:hover {
      border-color: #ffffff;
      color: #ffffff;
    }

    .view-toggle-container {
      background: #000000;
      padding: 20px 0;
      text-align: center;
      border-bottom: 1px solid #333333;
      margin-bottom: 30px;
    }

    .view-toggle-buttons {
      display: inline-flex;
      border: 1px solid #333333;
      background: #000000;
    }

    .view-toggle-btn {
      background: transparent !important;
      color: #cccccc !important;
      border: none !important;
      padding: 12px 24px !important;
      font-family: 'PT Mono', monospace !important;
      font-size: 12px !important;
      text-transform: uppercase !important;
      letter-spacing: 1px !important;
      cursor: pointer !important;
      transition: all 0.3s ease !important;
      border-right: 1px solid #333333 !important;
    }

    .view-toggle-btn:last-child {
      border-right: none !important;
    }

    .view-toggle-btn:hover {
      background: rgba(255, 255, 255, 0.05) !important;
      color: #ffffff !important;
    }

    .view-toggle-btn.active {
      background: #ffffff !important;
      color: #000000 !important;
    }

    /* Nothing OS Modal Styles */
    .nothing-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .nothing-modal-content {
      background: #000000;
      border: 2px solid #ffffff;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }

    .nothing-modal-header {
      padding: 24px;
      border-bottom: 1px solid #333333;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #1a1a1a;
    }

    .nothing-modal-header h3 {
      color: #ffffff !important;
      margin: 0;
      font-size: 16px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .nothing-modal-close {
      background: none;
      border: none;
      color: #cccccc;
      font-size: 24px;
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .nothing-modal-close:hover {
      color: #ff0000;
    }

    .nothing-modal-body {
      padding: 24px;
      color: #ffffff;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–Ω–∞—Ö */
    .data-grid {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 8px 16px;
      color: #ffffff;
    }

    .data-label {
      font-weight: 600;
      color: #cccccc !important;
      text-transform: uppercase;
      font-size: 12px;
      letter-spacing: 0.5px;
    }

    .data-value {
      color: #ffffff !important;
      font-family: 'PT Mono', monospace;
      word-break: break-all;
      background: rgba(255, 255, 255, 0.05);
      padding: 4px 8px;
      border-radius: 2px;
    }

    .data-value:empty::after {
      content: '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
      color: #666666;
      font-style: italic;
    }

    /* Nothing OS Animations */
    @keyframes nothing-pulse {
      0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.4); }
      70% { box-shadow: 0 0 0 20px rgba(255, 0, 0, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
    }

    .pulse-red {
      animation: nothing-pulse 2s infinite;
    }

    @keyframes nothing-glow {
      0%, 100% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.2); }
      50% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.4); }
    }

    .glow-white {
      animation: nothing-glow 3s ease-in-out infinite;
    }
  </style>
</head>

<body>
  <!-- Header –≤ —Å—Ç–∏–ª–µ –ª–µ–Ω–¥–∏–Ω–≥–∞ -->
  <header class="border-b-2 border-gray-200">
    <div class="container py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-2">
          <svg class="h-8 w-8" fill="currentColor" viewBox="0 0 24 24">
            <path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/>
          </svg>
          <span class="text-xl font-bold">DataTrace</span>
        </div>
        <div class="flex items-center space-x-4">
          <div id="userInfo" class="hidden">
            <span id="userEmail" class="text-sm"></span>
            <button id="logoutBtn" class="btn-secondary ml-2">–í—ã–π—Ç–∏</button>
          </div>
          <button id="loginBtn" class="btn-secondary">–í–æ–π—Ç–∏</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Auth Modal -->
  <div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white max-w-md w-full p-6 border-2 border-black">
        <div class="flex justify-between items-center mb-6">
          <h2 id="authTitle" class="text-xl font-bold">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
          <button id="closeAuthModal" class="text-2xl">&times;</button>
        </div>
        
        <div id="authError" class="hidden mb-4 p-3 bg-red-100 border border-red-400 text-red-700"></div>
        <div id="authSuccess" class="hidden mb-4 p-3 bg-green-100 border border-green-400 text-green-700"></div>
        
        <form id="authForm">
          <div class="mb-4">
            <label class="block text-sm font-bold mb-2">Email</label>
            <input id="authEmail" type="email" class="input-field w-full" required>
          </div>
          
          <div class="mb-4">
            <label class="block text-sm font-bold mb-2">–ü–∞—Ä–æ–ª—å</label>
            <input id="authPassword" type="password" class="input-field w-full" required>
          </div>
          
          <div class="mb-6">
            <button id="authSubmit" type="submit" class="btn-primary w-full">–í–æ–π—Ç–∏</button>
          </div>
          
          <div class="text-center">
            <button id="authToggle" type="button" class="text-sm underline">
              –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="container py-16">
    <!-- Hero Section -->
    <div class="text-center mb-16">
      <h1 id="heroTitle" class="text-5xl font-bold text-black leading-tight mb-6">
        –ü–æ–∏—Å–∫ —É—Ç–µ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö
      </h1>
      <p id="heroDescription" class="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
        –ü—Ä–æ–≤–µ—Ä–∏–º –≤–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –≤—Å–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º —É—Ç–µ—á–µ–∫ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–º –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
      </p>
    </div>

    <!-- Search Form -->
    <div class="max-w-4xl mx-auto">
      <!-- Mode Selection -->
      <div class="flex gap-3 mb-8 justify-center flex-wrap">
        <button id="modeLeaks" class="btn-secondary active">–ü–æ–∏—Å–∫ —É—Ç–µ—á–µ–∫</button>
        <button id="modeCompany" class="btn-secondary">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é</button>
        <button id="modePassword" class="btn-secondary">üîê –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
      </div>

      <!-- Search Input -->
      <div id="searchInput" class="flex gap-4 mb-8 flex-wrap">
        <select id="field" class="select-field">
          <option value="phone">–¢–µ–ª–µ—Ñ–æ–Ω</option>
          <option value="email">Email</option>
          <option value="vk">VK</option>
          <option value="ok">–û–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–∏</option>
          <option value="inn">–ò–ù–ù</option>
          <option value="snils">–°–ù–ò–õ–°</option>
        </select>
        <input id="q" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: +79990000000" class="input-field" />
        <button id="btn" class="btn-primary">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
      </div>

      <!-- Password Check Input -->
      <div id="passwordInput" class="hidden mb-8">
        <div class="max-w-2xl mx-auto">
          <div class="mb-4">
            <label class="block text-sm font-bold mb-2">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏</label>
            <div class="relative">
              <input id="passwordField" type="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å..." class="input-field w-full pr-12" />
              <button id="togglePassword" type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-black">
                üëÅÔ∏è
              </button>
            </div>
          </div>
          <div class="mb-4">
            <div id="passwordStrength" class="text-sm text-gray-600"></div>
          </div>
          <div class="text-center">
            <button id="checkPasswordBtn" class="btn-primary">üîê –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
          </div>
          <div class="mt-4 text-xs text-gray-500 text-center">
            <p>‚ö†Ô∏è –ü–∞—Ä–æ–ª—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ö–µ—à. –°–∞–º –ø–∞—Ä–æ–ª—å –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä.</p>
          </div>
        </div>
      </div>

      <!-- Progress -->
      <div id="progressContainer" class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text">
          <span id="progressStatus">–û–∂–∏–¥–∞–Ω–∏–µ...</span>
          <span id="progressPercent" class="progress-percent">0%</span>
        </div>
      </div>

      <!-- Results -->
      <div id="results"></div>
    </div>

    <!-- Footer Info -->
    <div class="footer-section">
      <div class="max-w-4xl mx-auto">
        <div class="footer-title">–£–¥–∞–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</div>
        <div class="footer-text">
          <div>1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö</div>
          <div>2. –í—ã–±–µ—Ä–∏—Ç–µ "–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å"</div>
          <div>3. –ù–∞–∂–º–∏—Ç–µ "–°–∫—Ä—ã—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é"</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    const q = document.getElementById('q');
    const fieldSel = document.getElementById('field');
    const btn = document.getElementById('btn');
    const modeLeaks = document.getElementById('modeLeaks');
    const modeCompany = document.getElementById('modeCompany');
    const modePassword = document.getElementById('modePassword');
    const results = document.getElementById('results');
    
    // Password check elements
    const searchInput = document.getElementById('searchInput');
    const passwordInput = document.getElementById('passwordInput');
    const passwordField = document.getElementById('passwordField');
    const togglePassword = document.getElementById('togglePassword');
    const passwordStrength = document.getElementById('passwordStrength');
    const checkPasswordBtn = document.getElementById('checkPasswordBtn');

    // Authentication elements
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const userInfo = document.getElementById('userInfo');
    const userEmail = document.getElementById('userEmail');
    const authModal = document.getElementById('authModal');
    const closeAuthModal = document.getElementById('closeAuthModal');
    const authForm = document.getElementById('authForm');
    const authTitle = document.getElementById('authTitle');
    const authSubmit = document.getElementById('authSubmit');
    const authToggle = document.getElementById('authToggle');
    const authError = document.getElementById('authError');
    const authSuccess = document.getElementById('authSuccess');

    // Authentication state
    let currentUser = null;
    let authToken = null;
    let isLoginMode = true;

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤
    let currentMode = 'leaks';

    // ===== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –£–¢–ï–ß–ö–ê–ú–ò (–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–µ) =====
    window.displayLeakResultsBySources = async function(sourceResults) {
      console.log('üé® Displaying results with Nothing OS dashboard option');
      
      if (!sourceResults || sourceResults.length === 0) {
        results.innerHTML = '<div class="result-card"><div style="color: #dc2626;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div></div>';
        return;
      }

      // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Å—Ç–∏–ª–µ Nothing OS
      const viewToggle = document.createElement('div');
      viewToggle.className = 'view-toggle-container';
      viewToggle.innerHTML = `
        <div class="view-toggle-buttons">
          <button id="listViewBtn" class="view-toggle-btn active">–°–ü–ò–°–û–ö –ò–°–¢–û–ß–ù–ò–ö–û–í</button>
          <button id="dashboardViewBtn" class="view-toggle-btn">–î–ê–®–ë–û–†–î</button>
        </div>
      `;
      
      results.innerHTML = '';
      results.appendChild(viewToggle);
      
      const resultsContainer = document.createElement('div');
      resultsContainer.id = 'resultsContainer';
      results.appendChild(resultsContainer);

      // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫
      showNothingListView(sourceResults, resultsContainer);

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
      document.getElementById('listViewBtn').addEventListener('click', () => {
        switchNothingView('list', sourceResults, resultsContainer);
      });
      
      document.getElementById('dashboardViewBtn').addEventListener('click', () => {
        switchNothingView('dashboard', sourceResults, resultsContainer);
      });
    };

    function switchNothingView(viewType, sourceResults, container) {
      document.querySelectorAll('.view-toggle-btn').forEach(btn => btn.classList.remove('active'));
      
      if (viewType === 'dashboard') {
        document.getElementById('dashboardViewBtn').classList.add('active');
        window.displayNothingDashboard(sourceResults);
      } else {
        document.getElementById('listViewBtn').classList.add('active');
        showNothingListView(sourceResults, container);
      }
    }

    function showNothingListView(sourceResults, container) {
      container.innerHTML = '';
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è AI –∞–Ω–∞–ª–∏–∑–∞
      const hasAnyData = sourceResults.some(result => 
        result.ok && result.items && window.checkIfSourceHasLeakData(result, result.name)
      );

      // AI –∞–Ω–∞–ª–∏–∑ –±–ª–æ–∫
      if (hasAnyData) {
        const aiAnalysisContainer = document.createElement('div');
        aiAnalysisContainer.className = 'result-card';
        aiAnalysisContainer.style.textAlign = 'center';
        aiAnalysisContainer.style.backgroundColor = '#f8fafc';
        aiAnalysisContainer.style.border = '2px dashed #cbd5e1';
        
        aiAnalysisContainer.innerHTML = `
          <div style="padding: 20px;">
            <div style="font-size: 18px; font-weight: 600; margin-bottom: 10px;">ü§ñ –ê–Ω–∞–ª–∏–∑ –ò–ò</div>
            <div style="color: #64748b; margin-bottom: 15px;">
              –ü–æ–ª—É—á–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —É—Ç–µ—á–µ–∫, –æ—Ü–µ–Ω–∫—É –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
            </div>
            <button id="getAIAnalysis" class="btn-primary" style="margin: 0 auto;">
              üìä –ü–æ–ª—É—á–∏—Ç—å –ò–ò –∞–Ω–∞–ª–∏–∑
            </button>
            <div id="aiAnalysisResult" style="display: none; margin-top: 20px;"></div>
          </div>
        `;
        
        container.appendChild(aiAnalysisContainer);

        document.getElementById('getAIAnalysis').addEventListener('click', async () => {
          await performAIAnalysis(sourceResults);
        });
      }

      // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤  
      sourceResults.forEach((result, index) => {
        const sourceName = result.name || `–ò—Å—Ç–æ—á–Ω–∏–∫ ${index + 1}`;
        let status = 'success';
        
        if (result.error) {
          status = 'warning';
        } else if (result.ok && result.items) {
          const hasData = window.checkIfSourceHasLeakData(result, sourceName);
          if (hasData) {
            status = 'danger';
          }
        }
        
        const item = createResultItem(sourceName, status, result.items || result.error);
        container.appendChild(item);
      });
    };

    // –§—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ò–ò –∞–Ω–∞–ª–∏–∑–∞
    async function performAIAnalysis(sourceResults) {
      const button = document.getElementById('getAIAnalysis');
      const resultDiv = document.getElementById('aiAnalysisResult');
      
      button.disabled = true;
      button.innerHTML = 'üîÑ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ...';
      
      try {
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ–ª—å—à–æ–π —Ç–∞–π–º–∞—É—Ç –¥–ª—è DeepSeek V3 –∞–Ω–∞–ª–∏–∑–∞ (120 —Å–µ–∫—É–Ω–¥)
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 120000);
        
        const response = await fetch('/api/ai-leak-analysis', {
          method: 'POST',
          headers: createAuthHeaders(),
          body: JSON.stringify({
            query: q.value.trim(),
            field: fieldSel.value,
            results: sourceResults
          }),
          signal: controller.signal
        });

        clearTimeout(timeoutId);
        const data = await response.json();
        
        if (data.ok && data.analysis) {
          displayAIAnalysis(data.analysis, resultDiv);
          button.style.display = 'none';
          resultDiv.style.display = 'block';
        } else {
          throw new Error(data.error || '–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞');
        }
      } catch (error) {
        if (error.name === 'AbortError') {
          console.error('AI Analysis timeout after 120 seconds');
          button.innerHTML = '‚è±Ô∏è –¢–∞–π–º–∞—É—Ç –∞–Ω–∞–ª–∏–∑–∞ (120—Å)';
        } else {
          console.error('AI Analysis error:', error);
          button.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞';
        }
        button.disabled = false;
        
        setTimeout(() => {
          button.innerHTML = 'üìä –ü–æ–ª—É—á–∏—Ç—å –ò–ò –∞–Ω–∞–ª–∏–∑';
        }, 3000);
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ò–ò –∞–Ω–∞–ª–∏–∑–∞
    function convertMarkdownTablesToHTML(content) {
      // –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è markdown —Ç–∞–±–ª–∏—Ü –æ—Ç DeepSeek V3
      const tableRegex = /(\|[^\n]*\|\s*\n)+/g;
      
      return content.replace(tableRegex, (match) => {
        console.log('üîç Found markdown table:', match);
        
        const lines = match.trim().split('\n').filter(line => line.includes('|') && line.trim().length > 0);
        
        if (lines.length < 2) {
          console.log('‚ùå Not enough lines for table');
          return match;
        }
        
        // –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ - –∑–∞–≥–æ–ª–æ–≤–∫–∏
        const headerLine = lines[0];
        const headerCells = headerLine.split('|')
          .map(cell => cell.trim())
          .filter(cell => cell.length > 0);
        
        console.log('üìã Header cells:', headerCells);
        
        // –ù–∞—Ö–æ–¥–∏–º —Å—Ç—Ä–æ–∫—É —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏ (–º–æ–∂–µ—Ç –±—ã—Ç—å –≤—Ç–æ—Ä–∞—è –∏–ª–∏ –ª—é–±–∞—è —Å --- –∏–ª–∏ |---|)
        let dataStartIndex = 1;
        for (let i = 1; i < lines.length; i++) {
          if (lines[i].includes('---') || lines[i].includes(':---') || lines[i].includes('---|') || lines[i].includes('|---')) {
            dataStartIndex = i + 1;
            break;
          }
        }
        
        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ - –¥–∞–Ω–Ω—ã–µ
        const dataRows = lines.slice(dataStartIndex)
          .map(line => {
            const cells = line.split('|').map(cell => cell.trim()).filter(cell => cell.length > 0);
            return cells;
          })
          .filter(row => row.length > 0);
        
        console.log('üìä Data rows:', dataRows);
        
        // –°–æ–∑–¥–∞–µ–º HTML —Ç–∞–±–ª–∏—Ü—É
        let html = '<table style="width: 100%; border-collapse: collapse; margin: 16px 0; border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;">';
        
        // –ó–∞–≥–æ–ª–æ–≤–∫–∏
        if (headerCells.length > 0) {
          html += '<thead><tr>';
          headerCells.forEach(header => {
            html += `<th style="background: #f8fafc; font-weight: 600; color: #374151; padding: 12px; border: 1px solid #e2e8f0; text-align: left;">${header}</th>`;
          });
          html += '</tr></thead>';
        }
        
        // –î–∞–Ω–Ω—ã–µ
        if (dataRows.length > 0) {
          html += '<tbody>';
          dataRows.forEach(row => {
            html += '<tr>';
            row.forEach(cell => {
              html += `<td style="padding: 12px; border: 1px solid #e2e8f0; color: #374151; vertical-align: top;">${cell}</td>`;
            });
            html += '</tr>';
          });
          html += '</tbody>';
        }
        
        html += '</table>';
        console.log('‚úÖ Generated HTML table');
        return html;
      });
    }

    function displayAIAnalysis(analysis, container) {
      console.log('üéØ displayAIAnalysis called!');
      console.log('üìä Analysis type:', typeof analysis);
      console.log('üìù Analysis preview:', typeof analysis === 'string' ? analysis.substring(0, 200) + '...' : analysis);
      console.log('üì¶ Container element:', container);
      
      let html = '<div style="text-align: left; background: white; padding: 20px; border-radius: 8px; border: 1px solid #e2e8f0;">';
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø –∞–Ω–∞–ª–∏–∑–∞ - —Å—Ç—Ä–æ–∫–∞ (DeepSeek V3) –∏–ª–∏ –æ–±—ä–µ–∫—Ç (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç)
      if (typeof analysis === 'string') {
        // DeepSeek V3 –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–æ—Ç–∏–≤—ã–π —Ç–µ–∫—Å—Ç - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º markdown –≤ HTML
        // üîß –í–ê–ñ–ù–û: –°–Ω–∞—á–∞–ª–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Ç–∞–±–ª–∏—Ü—ã (–ø–æ–∫–∞ –µ—Å—Ç—å \n), –ø–æ—Ç–æ–º –æ—Å—Ç–∞–ª—å–Ω–æ–µ!
        let htmlContent = convertMarkdownTablesToHTML(analysis);
        
        // –ü–æ—Ç–æ–º –¥–µ–ª–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–º–µ–Ω—ã
        htmlContent = htmlContent
          .replace(/\n/g, '<br>')
          .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
          .replace(/### (.*?)(<br>|$)/g, '<h3 style="color: #1f2937; margin: 20px 0 10px 0; font-size: 18px; font-weight: 600;">$1</h3>')
          .replace(/## (.*?)(<br>|$)/g, '<h2 style="color: #1f2937; margin: 24px 0 12px 0; font-size: 20px; font-weight: 700;">$1</h2>')
          .replace(/# (.*?)(<br>|$)/g, '<h1 style="color: #1f2937; margin: 28px 0 14px 0; font-size: 24px; font-weight: 800;">$1</h1>');

        html += `
          <div style="color: #374151; line-height: 1.6; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
            ${htmlContent}
          </div>
        `;
      } else if (typeof analysis === 'object' && analysis !== null) {
        // –°—Ç–∞—Ä—ã–π –æ–±—ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç - –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        
        // –£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏
        if (analysis.risk_level) {
          const riskColors = {
            'low': '#16a34a',
            'medium': '#d97706', 
            'high': '#dc2626',
            'critical': '#991b1b'
          };
          const riskTexts = {
            'low': '–ù–∏–∑–∫–∏–π',
            'medium': '–°—Ä–µ–¥–Ω–∏–π',
            'high': '–í—ã—Å–æ–∫–∏–π', 
            'critical': '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π'
          };
          
          html += `
            <div style="margin-bottom: 20px;">
              <div style="font-weight: 600; margin-bottom: 8px;">üö® –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞:</div>
              <div style="color: ${riskColors[analysis.risk_level] || '#6b7280'}; font-weight: 600; font-size: 16px;">
                ${riskTexts[analysis.risk_level] || analysis.risk_level}
              </div>
            </div>
          `;
        }

        // –°–∞–π—Ç—ã –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª–µ–π
        if (analysis.security_recommendations?.password_change_sites?.length > 0) {
          html += `
            <div style="margin-bottom: 20px;">
              <div style="font-weight: 600; margin-bottom: 8px;">üîê –°–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –Ω–∞ —Å–∞–π—Ç–∞—Ö:</div>
              <ul style="list-style: none; padding-left: 0;">
          `;
          analysis.security_recommendations.password_change_sites.forEach(site => {
            html += `<li style="margin-bottom: 4px; color: #dc2626;">‚Ä¢ ${site}</li>`;
          });
          html += '</ul></div>';
        }

        // –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞
        if (analysis.summary) {
          html += `
            <div style="margin-bottom: 20px;">
              <div style="font-weight: 600; margin-bottom: 8px;">üìã –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞:</div>
              <div style="color: #374151; line-height: 1.5;">${analysis.summary}</div>
            </div>
          `;
        }

        // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        if (analysis.security_recommendations?.immediate_actions?.length > 0) {
          html += `
            <div>
              <div style="font-weight: 600; margin-bottom: 8px;">‚ö° –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</div>
              <ul style="list-style: none; padding-left: 0;">
          `;
          analysis.security_recommendations.immediate_actions.forEach(action => {
            html += `<li style="margin-bottom: 4px; color: #059669;">‚Ä¢ ${action}</li>`;
          });
          html += '</ul></div>';
        }
      } else {
        // Fallback –¥–ª—è –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
        html += `
          <div style="color: #dc2626; font-weight: 600;">
            ‚ùå –û—à–∏–±–∫–∞: –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∞–Ω–∞–ª–∏–∑–∞
          </div>
          <pre style="background: #f3f4f6; padding: 10px; border-radius: 4px; margin-top: 10px; overflow-x: auto;">
            ${JSON.stringify(analysis, null, 2)}
          </pre>
        `;
      }

      html += '</div>';
      container.innerHTML = html;
      
      console.log('‚úÖ HTML content set!');
      console.log('üìè HTML length:', html.length);
      console.log('üëÅÔ∏è Container visibility:', container.style.display);
      console.log('üé® Final HTML preview:', html.substring(0, 300) + '...');
    }

    // –§—É–Ω–∫—Ü–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    function displayStandardLeakResults(sourceResults, aiSummary) {
      results.innerHTML = '';
      
      sourceResults.forEach((result, index) => {
        const sourceName = result.name || `–ò—Å—Ç–æ—á–Ω–∏–∫ ${index + 1}`;
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        let status = 'success'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–µ–ª–µ–Ω—ã–π (–Ω–µ—Ç —É—Ç–µ—á–µ–∫)
        
        if (result.error) {
          status = 'warning'; // –ñ–µ–ª—Ç—ã–π (–æ—à–∏–±–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞)
        } else if (result.ok && result.items) {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
          const hasData = window.checkIfSourceHasLeakData(result, sourceName);
          if (hasData) {
            status = 'danger'; // –ö—Ä–∞—Å–Ω—ã–π (–Ω–∞–π–¥–µ–Ω—ã —É—Ç–µ—á–∫–∏)
          }
        }
        
        let displayData = result.items || result.error;
        
        // –ï—Å–ª–∏ –µ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç AI, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö
        if (aiSummary && result.ok && result.items) {
          displayData = window.formatAIDataForLeakSource(result.items, sourceName, aiSummary);
        }
        
        const item = createResultItem(sourceName, status, displayData);
        results.appendChild(item);
      });
    }

    window.checkIfSourceHasLeakData = function(result, sourceName) {
      if (!result.ok || !result.items) {
        console.log(`‚ùå ${sourceName}: result.ok=${result.ok}, result.items=`, result.items);
        return false;
      }
      
      // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
      console.log(`üîç Checking ${sourceName}:`, { 
        ok: result.ok, 
        itemsType: typeof result.items, 
        itemsKeys: typeof result.items === 'object' ? Object.keys(result.items) : 'N/A',
        itemsLength: Array.isArray(result.items) ? result.items.length : 'N/A'
      });
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
      switch (sourceName) {
        case 'ITP':
          const hasITPData = result.items && typeof result.items === 'object' && Object.keys(result.items).length > 0;
          console.log(`üéØ ITP has data: ${hasITPData}`, result.items);
          return hasITPData;
        case 'Dyxless':
          return Array.isArray(result.items) && result.items.length > 0;
        case 'LeakOsint':
          return Array.isArray(result.items) && result.items.length > 0;
        case 'Usersbox':
          return Array.isArray(result.items) && result.items.length > 0;
        case 'Vektor':
          return result.items && (Array.isArray(result.items) ? result.items.length > 0 : Object.keys(result.items).length > 0);
        default:
          return false;
      }
    };

    // ===== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø –î–ê–ù–ù–´–• –ò–ò =====
    window.formatAIDataForLeakSource = function(originalData, sourceName, aiSummary) {
      const formattedData = {};
      
      // –ï—Å–ª–∏ –µ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –ò–ò –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö
      if (aiSummary && aiSummary.sources && aiSummary.sources[sourceName]) {
        const sourceInfo = aiSummary.sources[sourceName];
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
        if (sourceInfo.foundCount) {
          formattedData['üìä –ù–∞–π–¥–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π'] = sourceInfo.foundCount;
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        if (sourceInfo.databases && sourceInfo.databases.length > 0) {
          formattedData['üóÑÔ∏è –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö'] = sourceInfo.databases.join(', ');
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –æ—Ç –ò–ò
        if (sourceInfo.records && Array.isArray(sourceInfo.records)) {
          sourceInfo.records.forEach((record, index) => {
            if (record && typeof record === 'object') {
              const recordInfo = [];
              
              // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∫–∞–∂–¥—É—é –∑–∞–ø–∏—Å—å
              if (record.email) recordInfo.push(`üìß ${record.email}`);
              if (record.phone) recordInfo.push(`üìû ${record.phone}`);
              if (record.name) recordInfo.push(`üë§ ${record.name}`);
              if (record.username) recordInfo.push(`üîë ${record.username}`);
              if (record.password) recordInfo.push(`üîê ${record.password.substring(0, 8)}...`);
              if (record.database) recordInfo.push(`üóÑÔ∏è ${record.database}`);
              if (record.source) recordInfo.push(`üîó ${record.source}`);
              if (record.date) recordInfo.push(`üìÖ ${record.date}`);
              
              if (recordInfo.length > 0) {
                formattedData[`üìÑ –ó–∞–ø–∏—Å—å ${index + 1}`] = recordInfo.join(' | ');
              }
            } else if (typeof record === 'string') {
              formattedData[`üìÑ –ó–∞–ø–∏—Å—å ${index + 1}`] = record;
            }
          });
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–º–µ—Ç–∫–∏ –ò–ò
        if (sourceInfo.notes) {
          formattedData['üìù –ê–Ω–∞–ª–∏–∑ –ò–ò'] = sourceInfo.notes;
        }
        
        // –ï—Å–ª–∏ –µ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Ö
        if (Object.keys(formattedData).length > 1) { // –±–æ–ª—å—à–µ 1 –ø–æ—Ç–æ–º—É —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ —Å—á–µ—Ç—á–∏–∫
          return formattedData;
        }
      }
      
      // –ï—Å–ª–∏ –Ω–µ—Ç –ò–ò –¥–∞–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      if (originalData && typeof originalData === 'object') {
        switch (sourceName) {
          case 'ITP':
            formatITPData(originalData, formattedData);
            break;
          case 'Dyxless':
            formatDyxlessData(originalData, formattedData);
            break;
          case 'LeakOsint':
            formatLeakOsintData(originalData, formattedData);
            break;
          case 'Usersbox':
            formatUsersboxData(originalData, formattedData);
            break;
          case 'Vektor':
            formatVektorData(originalData, formattedData);
            break;
          default:
            Object.assign(formattedData, originalData);
        }
      }
      
      return Object.keys(formattedData).length > 0 ? formattedData : originalData;
    };

    function formatITPData(data, formattedData) {
      if (!data || typeof data !== 'object') return;
      
      // ITP –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –≤–∏–¥–µ –≥—Ä—É–ø–ø
      for (const [groupName, groupData] of Object.entries(data)) {
        if (groupData && groupData.data && Array.isArray(groupData.data)) {
          formattedData[`üìÅ ${groupName}`] = `${groupData.data.length} –∑–∞–ø–∏—Å–µ–π`;
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π
          groupData.data.slice(0, 3).forEach((record, index) => {
            if (record && typeof record === 'object') {
              const recordInfo = [];
              if (record.phone) recordInfo.push(`üìû ${record.phone}`);
              if (record.email) recordInfo.push(`üìß ${record.email}`);
              if (record.name) recordInfo.push(`üë§ ${record.name}`);
              if (record.address) recordInfo.push(`üè† ${record.address}`);
              
              if (recordInfo.length > 0) {
                formattedData[`  ‚îî –ó–∞–ø–∏—Å—å ${index + 1}`] = recordInfo.join(', ');
              }
            }
          });
          
          if (groupData.data.length > 3) {
            formattedData[`  ‚îî ...`] = `–∏ –µ—â–µ ${groupData.data.length - 3} –∑–∞–ø–∏—Å–µ–π`;
          }
        }
      }
    }

    function formatDyxlessData(data, formattedData) {
      if (!Array.isArray(data)) return;
      
      formattedData['üìä –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π'] = data.length;
      
      // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö
      const databases = {};
      data.forEach(record => {
        if (record && record.database) {
          if (!databases[record.database]) {
            databases[record.database] = [];
          }
          databases[record.database].push(record);
        }
      });
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –±–∞–∑–∞–º
      for (const [dbName, records] of Object.entries(databases)) {
        formattedData[`üóÑÔ∏è –ë–∞–∑–∞: ${dbName}`] = `${records.length} –∑–∞–ø–∏—Å–µ–π`;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ –∑–∞–ø–∏—Å–∏
        records.slice(0, 2).forEach((record, index) => {
          const recordInfo = [];
          if (record.email) recordInfo.push(`üìß ${record.email}`);
          if (record.phone) recordInfo.push(`üìû ${record.phone}`);
          if (record.name) recordInfo.push(`üë§ ${record.name}`);
          if (record.password) recordInfo.push(`üîë ${record.password.substring(0, 10)}...`);
          
          if (recordInfo.length > 0) {
            formattedData[`  ‚îî ${index + 1}`] = recordInfo.join(', ');
          }
        });
      }
    }

    function formatLeakOsintData(data, formattedData) {
      if (!Array.isArray(data)) return;
      
      formattedData['üìä –ù–∞–π–¥–µ–Ω–æ –±–∞–∑'] = data.length;
      
      data.forEach((leak, index) => {
        if (leak && leak.db) {
          formattedData[`üóÑÔ∏è –ë–∞–∑–∞: ${leak.db}`] = leak.info || '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–∑–µ';
          
          if (leak.data && Array.isArray(leak.data)) {
            formattedData[`  ‚îî –ó–∞–ø–∏—Å–µ–π –≤ –±–∞–∑–µ`] = leak.data.length;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ –∑–∞–ø–∏—Å–∏
            leak.data.slice(0, 2).forEach((record, recordIndex) => {
              if (typeof record === 'string') {
                formattedData[`  ‚îî ${recordIndex + 1}`] = record;
              } else if (typeof record === 'object') {
                const recordInfo = [];
                Object.entries(record).forEach(([key, value]) => {
                  if (value && typeof value === 'string') {
                    recordInfo.push(`${key}: ${value}`);
                  }
                });
                if (recordInfo.length > 0) {
                  formattedData[`  ‚îî ${recordIndex + 1}`] = recordInfo.join(', ');
                }
              }
            });
          }
        }
      });
    }

    function formatUsersboxData(data, formattedData) {
      if (!Array.isArray(data)) return;
      
      formattedData['üìä –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π'] = data.length;
      
      data.slice(0, 5).forEach((record, index) => {
        if (record && typeof record === 'object') {
          const recordInfo = [];
          if (record.email) recordInfo.push(`üìß ${record.email}`);
          if (record.phone) recordInfo.push(`üìû ${record.phone}`);
          if (record.name) recordInfo.push(`üë§ ${record.name}`);
          if (record.source) recordInfo.push(`üîó ${record.source}`);
          
          if (recordInfo.length > 0) {
            formattedData[`üìÑ –ó–∞–ø–∏—Å—å ${index + 1}`] = recordInfo.join(', ');
          }
        }
      });
      
      if (data.length > 5) {
        formattedData['...'] = `–∏ –µ—â–µ ${data.length - 5} –∑–∞–ø–∏—Å–µ–π`;
      }
    }

    function formatVektorData(data, formattedData) {
      if (Array.isArray(data)) {
        formattedData['üìä –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π'] = data.length;
        
        data.slice(0, 5).forEach((record, index) => {
          if (typeof record === 'string') {
            formattedData[`üìÑ ${index + 1}`] = record;
          } else if (typeof record === 'object') {
            const recordInfo = [];
            Object.entries(record).forEach(([key, value]) => {
              if (value) recordInfo.push(`${key}: ${value}`);
            });
            if (recordInfo.length > 0) {
              formattedData[`üìÑ ${index + 1}`] = recordInfo.join(', ');
            }
          }
        });
      } else if (typeof data === 'object') {
        Object.entries(data).forEach(([key, value]) => {
          if (value) {
            formattedData[key] = Array.isArray(value) ? value.join(', ') : value;
          }
        });
      }
    }

    function displayFinanceData(bodyId, financeData) {
      const bodyEl = document.getElementById(bodyId);
      if (!bodyEl || !financeData) return;
      
      console.log('üìä Displaying finance data:', financeData);
      
      let financeHtml = '<div style="margin-top: 20px; border-top: 2px solid #e5e7eb; padding-top: 16px;">';
      financeHtml += '<h4 style="color: #1f2937; font-weight: 600; margin-bottom: 12px;">üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>';
      
      // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–∞–Ω–∏–∏
      if (financeData.company) {
        financeHtml += '<div style="margin-bottom: 16px;">';
        financeHtml += '<h5 style="color: #374151; font-weight: 600; margin-bottom: 8px;">–ö–æ–º–ø–∞–Ω–∏—è</h5>';
        financeHtml += formatResultData(financeData.company);
        financeHtml += '</div>';
      }
      
      // –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –≥–æ–¥–∞–º
      if (financeData.data && typeof financeData.data === 'object') {
        financeHtml += '<div style="margin-bottom: 16px;">';
        financeHtml += '<h5 style="color: #374151; font-weight: 600; margin-bottom: 8px;">–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h5>';
        
        const years = Object.keys(financeData.data).sort((a, b) => b - a); // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é
        
        if (years.length > 0) {
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –≥–æ–¥–∞
          const recentYears = years.slice(0, 3);
          
          recentYears.forEach(year => {
            const yearData = financeData.data[year];
            if (yearData && typeof yearData === 'object') {
              financeHtml += `<div style="margin-bottom: 12px; padding: 8px; background: #f9fafb; border-radius: 4px;">`;
              financeHtml += `<h6 style="color: #1f2937; font-weight: 600; margin-bottom: 8px;">üìÖ ${year} –≥–æ–¥</h6>`;
              
              // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
              const formattedYearData = formatFinancialIndicators(yearData);
              financeHtml += formatResultData(formattedYearData);
              
              financeHtml += '</div>';
            }
          });
          
          if (years.length > 3) {
            financeHtml += `<div style="color: #6b7280; font-style: italic;">–ò –µ—â–µ –¥–∞–Ω–Ω—ã–µ –∑–∞ ${years.length - 3} –ª–µ—Ç(–∞)</div>`;
          }
        } else {
          financeHtml += '<div style="color: #6b7280;">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</div>';
        }
        
        financeHtml += '</div>';
      }
      
      // –°—Å—ã–ª–∫–∏ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã
      if (financeData['bo.nalog.ru'] && financeData['bo.nalog.ru']['–û—Ç—á–µ—Ç']) {
        const reports = financeData['bo.nalog.ru']['–û—Ç—á–µ—Ç'];
        financeHtml += '<div style="margin-bottom: 16px;">';
        financeHtml += '<h5 style="color: #374151; font-weight: 600; margin-bottom: 8px;">üìã –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –§–ù–°</h5>';
        
        Object.entries(reports).forEach(([year, url]) => {
          financeHtml += `<div style="margin-bottom: 4px;">`;
          financeHtml += `<a href="${url}" target="_blank" style="color: #2563eb; text-decoration: underline;">`;
          financeHtml += `üìÑ –û—Ç—á–µ—Ç –∑–∞ ${year} –≥–æ–¥</a>`;
          financeHtml += `</div>`;
        });
        
        financeHtml += '</div>';
      }
      
      financeHtml += '</div>';
      
      bodyEl.innerHTML += financeHtml;
    }
    
    function formatFinancialIndicators(yearData) {
      const formatted = {};
      
      // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–æ–π –∫–æ–¥–æ–≤
      const indicators = {
        '1100': '–ò—Ç–æ–≥–æ –ø–æ —Ä–∞–∑–¥–µ–ª—É I (–≤–Ω–µ–æ–±–æ—Ä–æ—Ç–Ω—ã–µ –∞–∫—Ç–∏–≤—ã)',
        '1200': '–ò—Ç–æ–≥–æ –ø–æ —Ä–∞–∑–¥–µ–ª—É II (–æ–±–æ—Ä–æ—Ç–Ω—ã–µ –∞–∫—Ç–∏–≤—ã)', 
        '1600': '–ë–ê–õ–ê–ù–° (–∞–∫—Ç–∏–≤)',
        '1300': '–ò—Ç–æ–≥–æ –ø–æ —Ä–∞–∑–¥–µ–ª—É III (–∫–∞–ø–∏—Ç–∞–ª –∏ —Ä–µ–∑–µ—Ä–≤—ã)',
        '1400': '–ò—Ç–æ–≥–æ –ø–æ —Ä–∞–∑–¥–µ–ª—É IV (–¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞)',
        '1500': '–ò—Ç–æ–≥–æ –ø–æ —Ä–∞–∑–¥–µ–ª—É V (–∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞)',
        '1700': '–ë–ê–õ–ê–ù–° (–ø–∞—Å—Å–∏–≤)',
        '2110': '–í—ã—Ä—É—á–∫–∞',
        '2200': '–ü—Ä–∏–±—ã–ª—å (—É–±—ã—Ç–æ–∫) –æ—Ç –ø—Ä–æ–¥–∞–∂',
        '2300': '–ü—Ä–∏–±—ã–ª—å (—É–±—ã—Ç–æ–∫) –¥–æ –Ω–∞–ª–æ–≥–æ–æ–±–ª–æ–∂–µ–Ω–∏—è',
        '2400': '–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å (—É–±—ã—Ç–æ–∫)'
      };
      
      Object.entries(indicators).forEach(([code, description]) => {
        if (yearData[code] !== undefined && yearData[code] !== null) {
          const value = Number(yearData[code]);
          if (!isNaN(value)) {
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∫—Ä—É–ø–Ω—ã–µ —Å—É–º–º—ã
            formatted[description] = formatCurrency(value);
          }
        }
      });
      
      return formatted;
    }
    
    function formatCurrency(value) {
      if (Math.abs(value) >= 1000000) {
        return `${(value / 1000000).toFixed(1)} –º–ª–Ω —Ä—É–±.`;
      } else if (Math.abs(value) >= 1000) {
        return `${(value / 1000).toFixed(0)} —Ç—ã—Å. —Ä—É–±.`;
      } else {
        return `${value} —Ä—É–±.`;
      }
    }

    // –§—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    function showProgress() {
      document.getElementById('progressContainer').style.display = 'block';
      resetProgress();
    }

    function hideProgress() {
      document.getElementById('progressContainer').style.display = 'none';
    }

    function resetProgress() {
      const fill = document.getElementById('progressFill');
      const percent = document.getElementById('progressPercent');
      const status = document.getElementById('progressStatus');
      
      fill.style.width = '0%';
      percent.textContent = '0%';
      status.textContent = '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...';
    }

    function updateProgress(percentage, statusText) {
      const fill = document.getElementById('progressFill');
      const percent = document.getElementById('progressPercent');
      const status = document.getElementById('progressStatus');
      
      fill.style.width = percentage + '%';
      percent.textContent = Math.round(percentage) + '%';
      status.textContent = statusText;
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    function createResultItem(title, status, data, isOpen = false) {
      const item = document.createElement('div');
      item.className = `result-card ${isOpen ? 'open' : ''}`;
      
      const statusClass = status === 'success' ? 'status-clean' : 
                         status === 'danger' ? 'status-found' : 'status-error';
      const statusText = status === 'success' ? '–ß–∏—Å—Ç–æ' : 
                        status === 'danger' ? '–ù–∞–π–¥–µ–Ω–æ' : '–û—à–∏–±–∫–∞';

      item.innerHTML = `
        <div class="result-header" onclick="toggleResult(this)">
          <div class="result-title">${title}</div>
          <div class="flex items-center gap-3">
            <span class="status-badge ${statusClass}">${statusText}</span>
            <span class="caret">‚ñ∂</span>
          </div>
        </div>
        <div class="result-body">
          ${typeof data === 'string' ? data : formatResultData(data)}
        </div>
      `;

      return item;
    }

    // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    function toggleResult(header) {
      const card = header.closest('.result-card');
      card.classList.toggle('open');
    }

    // –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    function formatResultData(data) {
      if (!data || (typeof data === 'object' && Object.keys(data).length === 0)) {
        return '<div style="color: #6b7280; font-style: italic;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>';
      }

      if (typeof data === 'string') {
        return data;
      }

      let html = '<div class="data-grid">';
      
      for (const [key, value] of Object.entries(data)) {
        if (value !== null && value !== undefined && value !== '') {
          const formattedValue = Array.isArray(value) ? value.join(', ') : 
                                 typeof value === 'object' ? JSON.stringify(value, null, 2) : 
                                 String(value);
          
          html += `
            <div class="data-label">${key}</div>
            <div class="data-value">${formattedValue}</div>
          `;
        }
      }
      
      html += '</div>';
      return html;
    }

    // Helper function –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
    function createAuthHeaders() {
      const headers = {
        'Content-Type': 'application/json'
      };
      
      if (authToken) {
        headers['Authorization'] = `Bearer ${authToken}`;
      }
      
      return headers;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞
    async function performSearch() {
      if (currentMode === 'password') {
        // Password mode uses its own button and logic
        return;
      }
      
      const query = q.value.trim();
      if (!query) {
        alert('–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∏—Å–∫–∞');
        return;
      }

      btn.disabled = true;
      btn.textContent = '–ü–æ–∏—Å–∫...';
      results.innerHTML = '';
      showProgress();

      try {
        if (currentMode === 'company') {
          await performCompanySearch(query);
        } else {
          await performLeakSearch(query);
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:', error);
        hideProgress();
        results.innerHTML = `<div class="result-card"><div style="color: #dc2626;">${error.message}</div></div>`;
      } finally {
        btn.disabled = false;
        btn.textContent = '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å';
      }
    }

    // –ü–æ–∏—Å–∫ —É—Ç–µ—á–µ–∫ (–Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —Å –∫–Ω–æ–ø–∫–æ–π –ò–ò)
    async function performLeakSearch(query) {
      console.log('üîç Starting leak search for:', query);
      
      const allResults = [];
      const sources = [
        { name: 'ITP', step: 1 },
        { name: 'Dyxless', step: 2 },
        { name: 'LeakOsint', step: 3 },
        { name: 'Usersbox', step: 4 },
        { name: 'Vektor', step: 5 }
      ];

      // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
      for (const source of sources) {
        updateProgress((source.step / sources.length) * 90, `–ü–æ–∏—Å–∫ –≤ ${source.name}...`);
        
        try {
          const response = await fetch('/api/leak-search-step', {
            method: 'POST',
            headers: createAuthHeaders(),
            body: JSON.stringify({
              query: query,
              field: fieldSel.value,
              step: source.step
            })
          });

          const stepData = await response.json();
          
          if (stepData.result) {
            console.log(`‚úÖ ${source.name} completed:`, stepData.result);
            console.log(`üìä ${source.name} response structure:`, {
              ok: stepData.result.ok,
              itemsType: typeof stepData.result.items,
              itemsKeys: typeof stepData.result.items === 'object' ? Object.keys(stepData.result.items) : 'N/A',
              error: stepData.result.error
            });
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–º—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
            allResults.push({ name: source.name, ...stepData.result });
          } else {
            console.log(`‚ùå ${source.name} failed:`, stepData.error);
            allResults.push({ name: source.name, ok: false, error: stepData.error });
          }
        } catch (error) {
          console.error(`üí• Error in ${source.name}:`, error);
          allResults.push({ name: source.name, ok: false, error: error.message });
        }
        
        await new Promise(resolve => setTimeout(resolve, 300));
      }

      // –°—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—ã—Ä—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
      updateProgress(100, '–ó–∞–≤–µ—Ä—à–µ–Ω–æ');
      setTimeout(() => {
        hideProgress();
        window.displayLeakResultsBySources(allResults);
      }, 500);
    }

    // –ü–æ–∏—Å–∫ –∫–æ–º–ø–∞–Ω–∏–π (—Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    async function performCompanySearch(query) {
      console.log('üè¢ Starting company search for:', query);
      
      const allResults = [];
      const sources = [
        { name: 'Datanewton', step: 1 },
        { name: 'Checko', step: 2 }
      ];

      // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –∫–æ–º–ø–∞–Ω–∏–π
      for (let i = 0; i < sources.length; i++) {
        const source = sources[i];
        const progress = 25 + (i * 25);
        
        updateProgress(progress, `–ü–æ–∏—Å–∫ –≤ ${source.name}...`);
        
        try {
          const response = await fetch('/api/company-search-step', {
            method: 'POST',
            headers: createAuthHeaders(),
            body: JSON.stringify({ inn: query, step: source.step })
          });

          const stepData = await response.json();
          
          if (response.ok && stepData.result) {
            allResults.push(stepData.result);
            console.log(`‚úÖ ${source.name} completed:`, stepData.result);
          } else {
            console.log(`‚ùå ${source.name} failed:`, stepData.error);
            allResults.push({ name: source.name, ok: false, error: stepData.error });
          }
        } catch (error) {
          console.error(`üí• Error in ${source.name}:`, error);
          allResults.push({ name: source.name, ok: false, error: error.message });
        }
        
        await new Promise(resolve => setTimeout(resolve, 300));
      }

      // –î–ª—è –∫–æ–º–ø–∞–Ω–∏–π –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–±–µ–∑ –ò–ò –∫–Ω–æ–ø–∫–∏)
      updateProgress(100, '–ó–∞–≤–µ—Ä—à–µ–Ω–æ');
      setTimeout(() => {
        hideProgress();
        displayCompanyResults(allResults);
      }, 500);
    }

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)
    function formatCompanyData(data, sourceName) {
      if (!data || (typeof data === 'object' && Object.keys(data).length === 0)) {
        return '<div style="color: #6b7280; font-style: italic;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>';
      }

      if (typeof data === 'string') {
        return data;
      }

      let html = '<div class="data-grid">';
      
      // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–∞–Ω–∏–∏
      if (data.name || data.fullName) {
        html += `
          <div class="data-label">üè¢ –ù–∞–∑–≤–∞–Ω–∏–µ</div>
          <div class="data-value">${data.name || data.fullName}</div>
        `;
      }
      
      if (data.inn) {
        html += `
          <div class="data-label">üÜî –ò–ù–ù</div>
          <div class="data-value">${data.inn}</div>
        `;
      }
      
      if (data.kpp) {
        html += `
          <div class="data-label">üèõÔ∏è –ö–ü–ü</div>
          <div class="data-value">${data.kpp}</div>
        `;
      }
      
      if (data.ogrn) {
        html += `
          <div class="data-label">üìã –û–ì–†–ù</div>
          <div class="data-value">${data.ogrn}</div>
        `;
      }
      
      if (data.address) {
        html += `
          <div class="data-label">üìç –ê–¥—Ä–µ—Å</div>
          <div class="data-value">${data.address}</div>
        `;
      }
      
      if (data.ceo || data.director) {
        html += `
          <div class="data-label">üë®‚Äçüíº –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å</div>
          <div class="data-value">${data.ceo || data.director}</div>
        `;
      }
      
      if (data.status) {
        html += `
          <div class="data-label">üìä –°—Ç–∞—Ç—É—Å</div>
          <div class="data-value">${data.status}</div>
        `;
      }
      
      if (data.registrationDate) {
        html += `
          <div class="data-label">üìÖ –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</div>
          <div class="data-value">${data.registrationDate}</div>
        `;
      }
      
      // –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
      if (data.revenue) {
        html += `
          <div class="data-label">üí∞ –í—ã—Ä—É—á–∫–∞</div>
          <div class="data-value">${formatCurrency(data.revenue)}</div>
        `;
      }
      
      if (data.profit) {
        html += `
          <div class="data-label">üìà –ü—Ä–∏–±—ã–ª—å</div>
          <div class="data-value">${formatCurrency(data.profit)}</div>
        `;
      }
      
      if (data.employees) {
        html += `
          <div class="data-label">üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</div>
          <div class="data-value">${data.employees}</div>
        `;
      }
      
      // –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
      if (data.phone) {
        html += `
          <div class="data-label">üìû –¢–µ–ª–µ—Ñ–æ–Ω</div>
          <div class="data-value">${data.phone}</div>
        `;
      }
      
      if (data.email) {
        html += `
          <div class="data-label">üìß Email</div>
          <div class="data-value">${data.email}</div>
        `;
      }
      
      if (data.website) {
        html += `
          <div class="data-label">üåê –°–∞–π—Ç</div>
          <div class="data-value"><a href="${data.website}" target="_blank" style="color: #2563eb;">${data.website}</a></div>
        `;
      }
      
      // –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–¥–µ–ª—å–Ω–æ
      if (data.finance && typeof data.finance === 'object') {
        html += '</div>';
        html += '<div style="margin-top: 20px; border-top: 2px solid #e5e7eb; padding-top: 16px;">';
        html += '<h4 style="color: #1f2937; font-weight: 600; margin-bottom: 12px;">üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>';
        html += formatResultData(data.finance);
        return html;
      }
      
      // –ï—Å–ª–∏ –æ—Å—Ç–∞–ª–∏—Å—å –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
      const processedFields = ['name', 'fullName', 'inn', 'kpp', 'ogrn', 'address', 'ceo', 'director', 'status', 'registrationDate', 'revenue', 'profit', 'employees', 'phone', 'email', 'website', 'finance'];
      
      for (const [key, value] of Object.entries(data)) {
        if (!processedFields.includes(key) && value !== null && value !== undefined && value !== '') {
          const formattedValue = Array.isArray(value) ? value.join(', ') : 
                                 typeof value === 'object' ? JSON.stringify(value, null, 2) : 
                                 String(value);
          
          html += `
            <div class="data-label">${key}</div>
            <div class="data-value">${formattedValue}</div>
          `;
        }
      }
      
      html += '</div>';
      return html;
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–æ–º–ø–∞–Ω–∏–π (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞)
    function displayCompanyResults(companyResults) {
      results.innerHTML = '';
      
      if (!companyResults || companyResults.length === 0) {
        results.innerHTML = '<div class="result-card"><div style="color: #dc2626;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div></div>';
        return;
      }

      companyResults.forEach((result, index) => {
        const sourceName = result.name || `–ò—Å—Ç–æ—á–Ω–∏–∫ ${index + 1}`;
        let status = 'success';
        
        if (result.error) {
          status = 'warning';
        } else if (result.ok && result.items) {
          // –î–ª—è –∫–æ–º–ø–∞–Ω–∏–π —Å—á–∏—Ç–∞–µ–º —É—Å–ø–µ—Ö–æ–º –Ω–∞–ª–∏—á–∏–µ –ª—é–±—ã—Ö –¥–∞–Ω–Ω—ã—Ö
          status = 'success';
        }
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º formatCompanyData –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const formattedData = formatCompanyData(result.items || {}, sourceName);
        const item = createResultItem(sourceName, status, formattedData);
        results.appendChild(item);
      });
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    btn.addEventListener('click', () => {
      console.log('Button clicked! Current mode:', currentMode);
      console.log('Button element:', btn);
      console.log('Query input:', q);
      performSearch();
    });
    
    q.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        console.log('Enter pressed! Current mode:', currentMode);
        performSearch();
      }
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤
    modeLeaks.addEventListener('click', () => {
      setMode('leaks');
    });
    
    modeCompany.addEventListener('click', () => {
      setMode('company');
    });
    
    modePassword.addEventListener('click', () => {
      setMode('password');
    });

    // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤
    function setMode(mode) {
      currentMode = mode;
      
      // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
      modeLeaks.classList.remove('active');
      modeCompany.classList.remove('active');
      modePassword.classList.remove('active');
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–µ
      if (mode === 'leaks') {
        modeLeaks.classList.add('active');
        searchInput.style.display = 'block';
        searchInput.style.justifyContent = 'flex-start';
        passwordInput.style.display = 'none';
        fieldSel.style.display = 'inline-block';
        fieldSel.value = 'phone'; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        q.placeholder = '–ù–∞–ø—Ä–∏–º–µ—Ä: +79990000000';
        q.value = '';
      } else if (mode === 'company') {
        modeCompany.classList.add('active');
        searchInput.style.display = 'block';
        searchInput.style.justifyContent = 'center'; // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –¥–ª—è –ò–ù–ù
        passwordInput.style.display = 'none';
        fieldSel.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä –¥–ª—è –ò–ù–ù
        q.placeholder = '–í–≤–µ–¥–∏—Ç–µ –ò–ù–ù';
        q.value = '';
        fieldSel.value = 'inn'; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –∫–∞–∫ –ò–ù–ù
      } else if (mode === 'password') {
        modePassword.classList.add('active');
        searchInput.style.display = 'none';
        passwordInput.style.display = 'block';
        fieldSel.style.display = 'none';
      }
      
      // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∏ —Å–º–µ–Ω–µ —Ä–µ–∂–∏–º–∞
      results.innerHTML = '';
    }

    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    window.toggleResult = toggleResult;

    // AI Loading —Ñ—É–Ω–∫—Ü–∏–∏
    function showAILoading() {
      const overlay = document.getElementById('aiLoadingOverlay');
      if (overlay) {
        overlay.style.display = 'flex';
      }
    }

    function hideAILoading() {
      const overlay = document.getElementById('aiLoadingOverlay');
      if (overlay) {
        overlay.style.display = 'none';
      }
    }

    function updateAIStatus(message) {
      const statusElement = document.querySelector('#aiLoadingOverlay .loading-text');
      if (statusElement) {
        statusElement.textContent = message;
      }
    }

    // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ
    window.showAILoading = showAILoading;
    window.hideAILoading = hideAILoading;
    window.updateAIStatus = updateAIStatus;

    // ===== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –î–õ–Ø –†–ï–ñ–ò–ú–ê –ü–†–û–í–ï–†–ö–ò –ü–ê–†–û–õ–ï–ô =====

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è (–∏—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ –æ–±—ä—è–≤–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ)
    if (togglePassword && passwordField) {
      togglePassword.addEventListener('click', () => {
        const type = passwordField.type === 'password' ? 'text' : 'password';
        passwordField.type = type;
        togglePassword.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
      });
    }

    // –ê–Ω–∞–ª–∏–∑ —Å–∏–ª—ã –ø–∞—Ä–æ–ª—è –ø—Ä–∏ –≤–≤–æ–¥–µ
    if (passwordField && passwordStrength) {
      passwordField.addEventListener('input', () => {
        const password = passwordField.value;
        const strength = analyzePasswordStrength(password);
        passwordStrength.innerHTML = strength.html;
      });
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è
    if (checkPasswordBtn) {
      checkPasswordBtn.addEventListener('click', async () => {
        const password = passwordField.value.trim();
        
        if (!password) {
          alert('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏');
          return;
        }
        
        if (password.length < 1 || password.length > 200) {
          alert('–î–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 1 –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤');
          return;
        }
        
        await checkPasswordSecurity(password);
      });
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Enter
    if (passwordField) {
      passwordField.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          checkPasswordBtn.click();
        }
      });
    }

    // –§—É–Ω–∫—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ —Å–∏–ª—ã –ø–∞—Ä–æ–ª—è
    function analyzePasswordStrength(password) {
      if (!password) {
        return { score: 0, html: '' };
      }
      
      let score = 0;
      let feedback = [];
      
      // –î–ª–∏–Ω–∞
      if (password.length >= 8) score += 20;
      else feedback.push('–î–ª–∏–Ω–∞ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤');
      
      if (password.length >= 12) score += 10;
      if (password.length >= 16) score += 10;
      
      // –°–∏–º–≤–æ–ª—ã
      if (/[a-z]/.test(password)) score += 10;
      else feedback.push('–ù–µ—Ç —Å—Ç—Ä–æ—á–Ω—ã—Ö –±—É–∫–≤');
      
      if (/[A-Z]/.test(password)) score += 10;
      else feedback.push('–ù–µ—Ç –∑–∞–≥–ª–∞–≤–Ω—ã—Ö –±—É–∫–≤');
      
      if (/[0-9]/.test(password)) score += 10;
      else feedback.push('–ù–µ—Ç —Ü–∏—Ñ—Ä');
      
      if (/[^a-zA-Z0-9]/.test(password)) score += 20;
      else feedback.push('–ù–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤');
      
      // –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
      const uniqueChars = new Set(password).size;
      if (uniqueChars >= password.length * 0.7) score += 10;
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å
      let level, color, emoji;
      if (score < 30) {
        level = '–°–ª–∞–±—ã–π';
        color = '#dc2626';
        emoji = 'üî¥';
      } else if (score < 60) {
        level = '–°—Ä–µ–¥–Ω–∏–π';
        color = '#f59e0b';
        emoji = 'üü°';
      } else if (score < 80) {
        level = '–•–æ—Ä–æ—à–∏–π';
        color = '#10b981';
        emoji = 'üü¢';
      } else {
        level = '–û—Ç–ª–∏—á–Ω—ã–π';
        color = '#059669';
        emoji = 'üíö';
      }
      
      let html = `
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
          <span>${emoji}</span>
          <span style="color: ${color}; font-weight: 600;">–°–∏–ª–∞ –ø–∞—Ä–æ–ª—è: ${level}</span>
          <span style="color: #6b7280;">(${score}/100)</span>
        </div>
      `;
      
      if (feedback.length > 0) {
        html += `<div style="color: #6b7280; font-size: 12px;">üí° ${feedback.join(', ')}</div>`;
      }
      
      return { score, html };
    }

    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è —á–µ—Ä–µ–∑ API
    async function checkPasswordSecurity(password) {
      const button = checkPasswordBtn;
      const originalText = button.textContent;
      
      button.disabled = true;
      button.textContent = 'üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º...';
      
      try {
        console.log('üîê Starting password security check...');
        
        const response = await fetch('/api/password-check', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ password })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.error?.message || '–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è');
        }
        
        displayPasswordResults(data, password);
        
      } catch (error) {
        console.error('Password check error:', error);
        
        results.innerHTML = `
          <div class="result-card">
            <div style="color: #dc2626;">
              <strong>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏</strong><br>
              ${error.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.'}
            </div>
          </div>
        `;
      } finally {
        button.disabled = false;
        button.textContent = originalText;
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è
    function displayPasswordResults(data, password) {
      let html = '';
      
      if (data.ok === false) {
        html = `
          <div class="result-card">
            <div style="color: #dc2626;">
              <strong>‚ùå –°–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</strong><br>
              ${data.error?.message || '–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª–µ–π –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞'}
            </div>
          </div>
        `;
      } else if (data.isCompromised) {
        html = `
          <div class="result-card">
            <div class="result-header">
              <div class="result-title">üö® –ü–∞—Ä–æ–ª—å —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω</div>
              <span class="status-badge status-found">–ù–∞–π–¥–µ–Ω</span>
            </div>
            <div class="result-body" style="display: block;">
              <div class="data-grid">
                <div class="data-label">üî¥ –°—Ç–∞—Ç—É—Å</div>
                <div class="data-value">–ü–∞—Ä–æ–ª—å –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–∞—Ö —É—Ç–µ—á–µ–∫</div>
                
                <div class="data-label">üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ç–µ—á–µ–∫</div>
                <div class="data-value">${data.breachCount || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</div>
                
                <div class="data-label">‚ö†Ô∏è –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞</div>
                <div class="data-value" style="color: #dc2626; font-weight: 600;">–í–´–°–û–ö–ò–ô</div>
                
                <div class="data-label">üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è</div>
                <div class="data-value">
                  <strong style="color: #dc2626;">–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ —Å–º–µ–Ω–∏—Ç–µ —ç—Ç–æ—Ç –ø–∞—Ä–æ–ª—å!</strong><br>
                  –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å –¥–ª–∏–Ω–æ–π –º–∏–Ω–∏–º—É–º 12 —Å–∏–º–≤–æ–ª–æ–≤ —Å –∫–æ–º–±–∏–Ω–∞—Ü–∏–µ–π –±—É–∫–≤, —Ü–∏—Ñ—Ä –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤.
                </div>
              </div>
              
              <div style="margin-top: 16px; padding: 12px; background: #fef2f2; border: 1px solid #fecaca; border-radius: 4px;">
                <strong style="color: #dc2626;">üî• –ö—Ä–∏—Ç–∏—á–Ω–æ:</strong> –≠—Ç–æ—Ç –ø–∞—Ä–æ–ª—å —É–∂–µ –∏–∑–≤–µ—Å—Ç–µ–Ω –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞–º –∏ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –∞—Ç–∞–∫ –Ω–∞ –≤–∞—à–∏ –∞–∫–∫–∞—É–Ω—Ç—ã.
              </div>
            </div>
          </div>
        `;
      } else {
        html = `
          <div class="result-card">
            <div class="result-header">
              <div class="result-title">‚úÖ –ü–∞—Ä–æ–ª—å –±–µ–∑–æ–ø–∞—Å–µ–Ω</div>
              <span class="status-badge status-clean">–ß–∏—Å—Ç–æ</span>
            </div>
            <div class="result-body" style="display: block;">
              <div class="data-grid">
                <div class="data-label">üü¢ –°—Ç–∞—Ç—É—Å</div>
                <div class="data-value">–ü–∞—Ä–æ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —É—Ç–µ—á–∫–∞—Ö</div>
                
                <div class="data-label">üîç –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –±–∞–∑</div>
                <div class="data-value">DeHashed (–∫—Ä—É–ø–Ω–µ–π—à–∞—è –±–∞–∑–∞ —É—Ç–µ—á–µ–∫)</div>
                
                <div class="data-label">‚≠ê –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞</div>
                <div class="data-value" style="color: #059669; font-weight: 600;">–ù–ò–ó–ö–ò–ô</div>
                
                <div class="data-label">üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è</div>
                <div class="data-value">
                  –ü–∞—Ä–æ–ª—å –≤—ã–≥–ª—è–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–º, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º:<br>
                  ‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∞–π—Ç–∞<br>
                  ‚Ä¢ –í–∫–ª—é—á–∏—Ç—å –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é<br>
                  ‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –º–µ–Ω—è—Ç—å –ø–∞—Ä–æ–ª–∏ (—Ä–∞–∑ –≤ 6-12 –º–µ—Å—è—Ü–µ–≤)
                </div>
              </div>
              
              <div style="margin-top: 16px; padding: 12px; background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 4px;">
                <strong style="color: #059669;">‚ú® –û—Ç–ª–∏—á–Ω–æ:</strong> –≠—Ç–æ—Ç –ø–∞—Ä–æ–ª—å –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω –≤ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –±–∞–∑–∞—Ö —É—Ç–µ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö.
              </div>
            </div>
          </div>
        `;
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∞–ª–∏–∑ —Å–∏–ª—ã –ø–∞—Ä–æ–ª—è
      const strength = analyzePasswordStrength(password);
      html += `
        <div class="result-card">
          <div class="result-header">
            <div class="result-title">üìä –ê–Ω–∞–ª–∏–∑ —Å–∏–ª—ã –ø–∞—Ä–æ–ª—è</div>
          </div>
          <div class="result-body" style="display: block;">
            ${strength.html}
            
            <div style="margin-top: 16px;">
              <div style="font-weight: 600; margin-bottom: 8px;">üí° –°–æ–≤–µ—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è:</div>
              <ul style="margin: 0; padding-left: 16px; color: #6b7280;">
                <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∏–Ω–∏–º—É–º 12 —Å–∏–º–≤–æ–ª–æ–≤</li>
                <li>–ö–æ–º–±–∏–Ω–∏—Ä—É–π—Ç–µ –±—É–∫–≤—ã —Ä–∞–∑–Ω–æ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞</li>
                <li>–î–æ–±–∞–≤–ª—è–π—Ç–µ —Ü–∏—Ñ—Ä—ã –∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã (!@#$%^&*)</li>
                <li>–ò–∑–±–µ–≥–∞–π—Ç–µ –ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</li>
                <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞—Ä–æ–ª–µ–π</li>
              </ul>
            </div>
          </div>
        </div>
      `;
      
      results.innerHTML = html;
    }

    // Nothing OS Dashboard Functions
    window.displayNothingDashboard = function(sourceResults) {
      console.log('üé® Creating Nothing OS dashboard for:', sourceResults);
      
      const dashboardData = analyzeNothingDashboardData(sourceResults);
      
      document.getElementById('resultsContainer').innerHTML = `
        <div class="dashboard-container">
          <!-- Header Section -->
          <div class="dashboard-header">
            <div class="dashboard-title">
              <h1>–ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h1>
              <p>–ö–û–ú–ü–õ–ï–ö–°–ù–û–ï –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï –¶–ò–§–†–û–í–û–ì–û –°–õ–ï–î–ê –ó–ê–í–ï–†–®–ï–ù–û</p>
              <p>–û–ë–ù–ê–†–£–ñ–ï–ù–û <strong>${dashboardData.totalBreaches}</strong> –£–¢–ï–ß–ï–ö –î–ê–ù–ù–´–• –í <strong>${dashboardData.affectedSources}</strong> –ò–°–¢–û–ß–ù–ò–ö–ê–•</p>
            </div>
            
            <!-- Stats Grid -->
            <div class="dashboard-stats">
              <div class="stat-card ${dashboardData.foundBreaches > 0 ? 'pulse-red' : ''}">
                <div class="stat-number">${dashboardData.foundBreaches}</div>
                <div class="stat-label">–ù–ê–ô–î–ï–ù–û –£–¢–ï–ß–ï–ö</div>
              </div>
              <div class="stat-card">
                <div class="stat-number">${dashboardData.cleanSources}</div>
                <div class="stat-label">–ß–ò–°–¢–´–• –ò–°–¢–û–ß–ù–ò–ö–û–í</div>
              </div>
              <div class="stat-card">
                <div class="stat-number">${dashboardData.totalBreaches}</div>
                <div class="stat-label">–í–°–ï–ì–û –ó–ê–ü–ò–°–ï–ô</div>
              </div>
              <div class="stat-card ${dashboardData.errorSources > 0 ? 'pulse-red' : ''}">
                <div class="stat-number">${dashboardData.errorSources}</div>
                <div class="stat-label">–û–®–ò–ë–û–ö –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–Ø</div>
              </div>
            </div>
            
            <!-- Risk Indicator -->
            <div class="risk-indicator">
              <div class="risk-circle ${getRiskClass(dashboardData)}">
                <div class="risk-count">${dashboardData.foundBreaches}</div>
                <div class="risk-level">${getRiskLevel(dashboardData)}</div>
              </div>
            </div>
          </div>

          <!-- Action Section -->
          ${dashboardData.foundBreaches > 0 ? `
          <div class="action-section">
            <h2>–¢–†–ï–ë–£–Æ–¢–°–Ø –ù–ï–ú–ï–î–õ–ï–ù–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø</h2>
            <p>–í–ê–®–ò –î–ê–ù–ù–´–ï –°–ö–û–ú–ü–†–û–ú–ï–¢–ò–†–û–í–ê–ù–´. –°–õ–ï–î–£–ô–¢–ï –ü–†–û–¢–û–ö–û–õ–£ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò.</p>
            <div class="action-buttons">
              <button id="nothingFixBtn" class="nothing-btn danger">
                üö® –ó–ê–ü–£–°–¢–ò–¢–¨ –ü–†–û–¢–û–ö–û–õ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò
              </button>
              <button id="nothingAIBtn" class="nothing-btn">
                ü§ñ –ê–ù–ê–õ–ò–ó –£–ì–†–û–ó –ò–ò
              </button>
            </div>
          </div>
          ` : `
          <div class="action-section">
            <h2>–°–¢–ê–¢–£–° –°–ò–°–¢–ï–ú–´: –ë–ï–ó–û–ü–ê–°–ù–û</h2>
            <p>–ù–ï–ú–ï–î–õ–ï–ù–ù–´–• –£–ì–†–û–ó –ù–ï –û–ë–ù–ê–†–£–ñ–ï–ù–û. –ü–†–û–î–û–õ–ñ–ê–ô–¢–ï –ú–û–ù–ò–¢–û–†–ò–ù–ì.</p>
            <div class="action-buttons">
              <button id="nothingAIBtn" class="nothing-btn">
                üìä –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó
              </button>
            </div>
          </div>
          `}

          <!-- Data Table -->
          <div class="breaches-section">
            <h2>–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–ù–ê–õ–ò–ó–ê –ò–°–¢–û–ß–ù–ò–ö–û–í</h2>
            <p>–ü–†–û–í–ï–†–ï–ù–û ${sourceResults.length} –ë–ê–ó –î–ê–ù–ù–´–• –ù–ê –ù–ê–õ–ò–ß–ò–ï –¶–ò–§–†–û–í–´–• –°–õ–ï–î–û–í</p>
            
            <div class="table-filters">
              <button class="nothing-filter-btn active" data-filter="all">
                –í–°–ï –ò–°–¢–û–ß–ù–ò–ö–ò (${sourceResults.length})
              </button>
              <button class="nothing-filter-btn" data-filter="breaches">
                –°–ö–û–ú–ü–†–û–ú–ï–¢–ò–†–û–í–ê–ù–´ (${dashboardData.foundBreaches})
              </button>
              <button class="nothing-filter-btn" data-filter="clean">
                –ë–ï–ó–û–ü–ê–°–ù–´ (${dashboardData.cleanSources})
              </button>
              <button class="nothing-filter-btn" data-filter="errors">
                –û–®–ò–ë–ö–ò (${dashboardData.errorSources})
              </button>
            </div>
            
            <table class="nothing-table">
              <thead>
                <tr>
                  <th>–ë–ê–ó–ê –î–ê–ù–ù–´–• –ò–°–¢–û–ß–ù–ò–ö–ê</th>
                  <th>–î–ê–¢–ê –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–Ø</th>
                  <th>–°–¢–ê–¢–£–°</th>
                  <th>–î–ï–ô–°–¢–í–ò–ï</th>
                </tr>
              </thead>
              <tbody>
                ${generateNothingTableRows(sourceResults)}
              </tbody>
            </table>
          </div>
        </div>
      `;

      setupNothingDashboardHandlers(sourceResults);
    };

    function analyzeNothingDashboardData(sourceResults) {
      let totalBreaches = 0;
      let foundBreaches = 0;
      let cleanSources = 0;
      let errorSources = 0;
      let affectedSources = 0;

      sourceResults.forEach(result => {
        if (result.error) {
          errorSources++;
        } else if (result.ok && result.items) {
          const hasData = window.checkIfSourceHasLeakData(result, result.name);
          if (hasData) {
            foundBreaches++;
            affectedSources++;
            
            if (result.name === 'ITP' && typeof result.items === 'object') {
              Object.values(result.items).forEach(db => {
                if (db.data) totalBreaches += db.data.length;
              });
            } else if (Array.isArray(result.items)) {
              totalBreaches += result.items.length;
            } else {
              totalBreaches += 1;
            }
          } else {
            cleanSources++;
          }
        }
      });

      return {
        totalBreaches,
        foundBreaches,
        cleanSources,
        errorSources,
        affectedSources
      };
    }

    function getRiskClass(data) {
      if (data.foundBreaches >= 3) return 'high-risk';
      if (data.foundBreaches >= 1) return 'medium-risk';
      return 'low-risk';
    }

    function getRiskLevel(data) {
      if (data.foundBreaches >= 3) return '–í–´–°–û–ö–ò–ô –†–ò–°–ö';
      if (data.foundBreaches >= 1) return '–†–ò–°–ö –û–ë–ù–ê–†–£–ñ–ï–ù';
      return '–ë–ï–ó–û–ü–ê–°–ù–û';
    }

    function generateNothingTableRows(sourceResults) {
      return sourceResults.map(result => {
        const sourceName = result.name || 'UNKNOWN';
        const currentDate = new Date().toLocaleDateString('en-US');
        
        let status, statusClass, statusText;
        
        if (result.error) {
          status = 'ERROR';
          statusClass = 'status-error';
          statusText = '–û–®–ò–ë–ö–ê –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–Ø';
        } else if (result.ok && result.items) {
          const hasData = window.checkIfSourceHasLeakData(result, sourceName);
          if (hasData) {
            status = 'COMPROMISED';
            statusClass = 'status-breach';
            statusText = '–î–ê–ù–ù–´–ï –ù–ê–ô–î–ï–ù–´';
          } else {
            status = 'SECURE';
            statusClass = 'status-clean';
            statusText = '–£–ì–†–û–ó –ù–ï–¢';
          }
        } else {
          status = 'UNKNOWN';
          statusClass = 'status-error';
          statusText = '–ù–ï–¢ –î–ê–ù–ù–´–•';
        }

        return `
          <tr class="table-row" data-status="${statusClass}">
            <td>
              <div class="source-info">
                <div class="source-icon">${getNothingSourceIcon(sourceName)}</div>
                <div>
                  <div class="source-name">${sourceName}</div>
                  <div class="source-description">${getNothingSourceDescription(sourceName)}</div>
                </div>
              </div>
            </td>
            <td>${currentDate}</td>
            <td>
              <span class="nothing-status-badge ${statusClass}">
                ${statusText}
              </span>
            </td>
            <td>
              <button class="nothing-details-btn" onclick="showNothingSourceDetails('${sourceName}', ${JSON.stringify(result).replace(/"/g, '&quot;')})">
                –ü–û–î–†–û–ë–ù–ï–ï
              </button>
            </td>
          </tr>
        `;
      }).join('');
    }

    function getNothingSourceIcon(sourceName) {
      const icons = {
        'ITP': '‚óâ',
        'Dyxless': '‚óé', 
        'LeakOsint': '‚äô',
        'Usersbox': '‚äó',
        'Vektor': '‚äò'
      };
      return icons[sourceName] || '‚óã';
    }

    function getNothingSourceDescription(sourceName) {
      const descriptions = {
        'ITP': '–ë–ê–ó–ê –†–ê–ó–í–ï–î–î–ê–ù–ù–´–•',
        'Dyxless': '–ö–û–õ–õ–ï–ö–¶–ò–Ø –£–¢–ï–ß–ï–ö',
        'LeakOsint': 'OSINT –†–ï–ü–û–ó–ò–¢–û–†–ò–ô',
        'Usersbox': '–ê–†–•–ò–í –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô',
        'Vektor': '–í–ï–ö–¢–û–†–ù–ê–Ø –ë–ê–ó–ê'
      };
      return descriptions[sourceName] || '–ò–°–¢–û–ß–ù–ò–ö –î–ê–ù–ù–´–•';
    }

    function setupNothingDashboardHandlers(sourceResults) {
      // Fix button
      const fixBtn = document.getElementById('nothingFixBtn');
      if (fixBtn) {
        fixBtn.addEventListener('click', () => {
          showNothingFixProtocol(sourceResults);
        });
      }

      // AI button
      const aiBtn = document.getElementById('nothingAIBtn');
      if (aiBtn) {
        aiBtn.addEventListener('click', async () => {
          await performAIAnalysis(sourceResults);
        });
      }

      // Filter buttons
      document.querySelectorAll('.nothing-filter-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          document.querySelectorAll('.nothing-filter-btn').forEach(b => b.classList.remove('active'));
          e.target.classList.add('active');
          
          const filter = e.target.dataset.filter;
          filterNothingTable(filter);
        });
      });
    }

    function filterNothingTable(filter) {
      const rows = document.querySelectorAll('.table-row');
      
      rows.forEach(row => {
        const status = row.dataset.status;
        
        if (filter === 'all') {
          row.style.display = '';
        } else if (filter === 'breaches' && status === 'status-breach') {
          row.style.display = '';
        } else if (filter === 'clean' && status === 'status-clean') {
          row.style.display = '';
        } else if (filter === 'errors' && status === 'status-error') {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }

    window.showNothingSourceDetails = function(sourceName, result) {
      const modal = document.createElement('div');
      modal.className = 'nothing-modal';
      modal.innerHTML = `
        <div class="nothing-modal-content">
          <div class="nothing-modal-header">
            <h3>${getNothingSourceIcon(sourceName)} ${sourceName} - –î–ï–¢–ê–õ–¨–ù–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´ –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–Ø</h3>
            <button class="nothing-modal-close" onclick="this.closest('.nothing-modal').remove()">√ó</button>
          </div>
          <div class="nothing-modal-body">
            ${formatResultData(result.items || result.error)}
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    };

    function showNothingFixProtocol(sourceResults) {
      const modal = document.createElement('div');
      modal.className = 'nothing-modal';
      modal.innerHTML = `
        <div class="nothing-modal-content">
          <div class="nothing-modal-header">
            <h2>üö® –ü–†–û–¢–û–ö–û–õ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò –ó–ê–ü–£–©–ï–ù</h2>
            <button class="nothing-modal-close" onclick="this.closest('.nothing-modal').remove()">√ó</button>
          </div>
          <div class="nothing-modal-body">
            <div style="margin-bottom: 24px;">
              <h3 style="color: #ff0000; margin-bottom: 16px;">–§–ê–ó–ê 1: –ù–ï–ú–ï–î–õ–ï–ù–ù–ê–Ø –ò–ó–û–õ–Ø–¶–ò–Ø</h3>
              <ul style="list-style: none; padding: 0;">
                <li style="padding: 8px 0; border-bottom: 1px solid #333;">üîê –°–ú–ï–ù–ò–¢–ï –í–°–ï –ü–ê–†–û–õ–ò –ê–ö–ö–ê–£–ù–¢–û–í</li>
                <li style="padding: 8px 0; border-bottom: 1px solid #333;">üì± –í–ö–õ–Æ–ß–ò–¢–ï 2FA –ù–ê –í–°–ï–• –°–ï–†–í–ò–°–ê–•</li>
                <li style="padding: 8px 0; border-bottom: 1px solid #333;">üè¶ –ü–†–û–í–ï–†–¨–¢–ï –§–ò–ù–ê–ù–°–û–í–´–ï –ê–ö–ö–ê–£–ù–¢–´</li>
                <li style="padding: 8px 0; border-bottom: 1px solid #333;">üìß –ó–ê–©–ò–¢–ò–¢–ï EMAIL –ê–ö–ö–ê–£–ù–¢–´</li>
              </ul>
              <button class="nothing-btn" style="margin-top: 16px;" onclick="nextProtocolPhase(this)">
                –§–ê–ó–ê 1 –ó–ê–í–ï–†–®–ï–ù–ê
              </button>
            </div>
            
            <div style="margin-bottom: 24px; display: none;" data-phase="2">
              <h3 style="color: #ffffff; margin-bottom: 16px;">–§–ê–ó–ê 2: –ù–ê–°–¢–†–û–ô–ö–ê –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê</h3>
              <ul style="list-style: none; padding: 0;">
                <li style="padding: 8px 0; border-bottom: 1px solid #333;">üîî –ù–ê–°–¢–†–û–ô–¢–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –û –£–¢–ï–ß–ö–ê–•</li>
                <li style="padding: 8px 0; border-bottom: 1px solid #333;">üìä –ü–û–î–ö–õ–Æ–ß–ò–¢–ï –ö–†–ï–î–ò–¢–ù–´–ô –ú–û–ù–ò–¢–û–†–ò–ù–ì</li>
                <li style="padding: 8px 0; border-bottom: 1px solid #333;">üëÄ –í–ö–õ–Æ–ß–ò–¢–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –ê–ö–ö–ê–£–ù–¢–û–í</li>
                <li style="padding: 8px 0; border-bottom: 1px solid #333;">üîÑ –ó–ê–ü–õ–ê–ù–ò–†–£–ô–¢–ï –†–ï–ì–£–õ–Ø–†–ù–´–ï –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–Ø</li>
              </ul>
              <button class="nothing-btn" style="margin-top: 16px;" onclick="nextProtocolPhase(this)">
                –ü–†–û–¢–û–ö–û–õ –ó–ê–í–ï–†–®–ï–ù
              </button>
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    window.nextProtocolPhase = function(button) {
      const currentPhase = button.closest('[data-phase], div:not([data-phase])');
      const nextPhase = document.querySelector('[data-phase="2"]');
      
      if (nextPhase && nextPhase.style.display === 'none') {
        currentPhase.style.display = 'none';
        nextPhase.style.display = 'block';
      } else {
        document.querySelector('.nothing-modal').remove();
        alert('üéØ –ü–†–û–¢–û–ö–û–õ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò –ó–ê–í–ï–†–®–ï–ù. –í–ê–® –¶–ò–§–†–û–í–û–ô –°–õ–ï–î –¢–ï–ü–ï–†–¨ –ó–ê–©–ò–©–ï–ù.');
      }
    };
  </script>

  <!-- AI Loading Overlay -->
  <div id="aiLoadingOverlay" class="ai-loading-overlay">
    <div class="ai-loading-content">
      <div class="ai-loading-title">ü§ñ –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ò–ò</div>
      <div class="ai-loading-subtitle">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞–π–¥–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é...</div>
      
      <div class="ai-spinner"></div>
      
      <div class="ai-progress-dots">
        <div class="ai-dot"></div>
        <div class="ai-dot"></div>
        <div class="ai-dot"></div>
      </div>
      
      <div id="aiStatusText" class="ai-status-text">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</div>
    </div>
  </div>

</body>
</html>