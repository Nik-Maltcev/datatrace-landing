<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DataTrace ‚Äî –ü–æ–∏—Å–∫ —É—Ç–µ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö v2.0</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=PT+Mono:wght@400&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'PT Mono', monospace;
      background: white;
      color: black;
      margin: 0;
      line-height: 1.6;
    }
    
    .container {
      max-width: 880px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    /* –ö–Ω–æ–ø–∫–∏ –≤ —Å—Ç–∏–ª–µ –ª–µ–Ω–¥–∏–Ω–≥–∞ */
    .btn-primary {
      background: black;
      color: white;
      border: 2px solid black;
      padding: 14px 24px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'PT Mono', monospace;
      text-transform: uppercase;
      font-size: 14px;
      letter-spacing: 0.5px;
    }
    
    .btn-primary:hover:not(:disabled) {
      background: white;
      color: black;
    }
    
    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .btn-secondary {
      background: transparent;
      color: black;
      border: 2px solid #e5e7eb;
      padding: 8px 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'PT Mono', monospace;
      font-size: 12px;
      text-transform: uppercase;
    }
    
    .btn-secondary:hover {
      border-color: black;
    }
    
    .btn-secondary.active {
      border-color: black;
      background: black;
      color: white;
    }
    
    /* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
    .input-field {
      background: white;
      color: black;
      border: 2px solid #e5e7eb;
      padding: 14px 16px;
      font-family: 'PT Mono', monospace;
      transition: border-color 0.2s;
      flex: 1;
      font-size: 15px;
      width: 100%;
      max-width: 400px;
      min-width: 320px;
    }
    
    .input-field:focus {
      outline: none;
      border-color: black;
    }
    
    .select-field {
      background: white;
      color: black;
      border: 2px solid #e5e7eb;
      padding: 14px 16px;
      font-family: 'PT Mono', monospace;
      min-width: 200px;
      font-size: 15px;
    }
    
    .select-field:focus {
      outline: none;
      border-color: black;
    }
    
    /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
    .result-card {
      background: white;
      border: 2px solid #e5e7eb;
      padding: 24px;
      margin-bottom: 16px;
      transition: all 0.2s;
    }
    
    .result-card:hover {
      border-color: black;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .result-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      margin-bottom: 16px;
    }
    
    .result-title {
      font-weight: 600;
      font-size: 18px;
      letter-spacing: 0.2px;
    }
    
    .status-badge {
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .status-clean {
      background: #dcfce7;
      color: #166534;
      border: 1px solid #bbf7d0;
    }
    
    .status-found {
      background: #fef2f2;
      color: #dc2626;
      border: 1px solid #fecaca;
    }
    
    .status-error {
      background: #fefce8;
      color: #ca8a04;
      border: 1px solid #fde047;
    }
    
    .result-body {
      display: none;
      padding-top: 16px;
      border-top: 1px solid #e5e7eb;
    }
    
    .result-card.open .result-body {
      display: block;
    }
    
    .caret {
      transition: transform 0.2s ease;
      font-size: 14px;
      color: #6b7280;
    }
    
    .result-card.open .caret {
      transform: rotate(90deg);
    }
    
    /* –ü—Ä–æ–≥—Ä–µ—Å—Å */
    .progress-container {
      margin: 32px 0;
      padding: 24px;
      background: #f9fafb;
      border: 2px solid #e5e7eb;
      display: none;
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e5e7eb;
      overflow: hidden;
      margin-bottom: 16px;
    }
    
    .progress-fill {
      height: 100%;
      background: black;
      transition: width 0.3s ease;
      width: 0%;
    }
    
    .progress-text {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
    }
    
    .progress-percent {
      font-weight: 600;
    }
    
    /* –î–∞–Ω–Ω—ã–µ */
    .data-grid {
      display: grid;
      grid-template-columns: 180px 1fr;
      gap: 12px 16px;
      margin-top: 16px;
    }
    
    .data-label {
      font-weight: 600;
      color: #6b7280;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .data-value {
      color: black;
      word-break: break-word;
      font-size: 14px;
    }
    
    /* –ò—Ç–æ–≥–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ */
    .summary-container {
      margin-top: 32px;
      padding: 24px;
      background: #f9fafb;
      border: 2px solid #e5e7eb;
      display: none;
    }
    
    .summary-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    /* –§—É—Ç–µ—Ä */
    .footer-section {
      margin-top: 48px;
      padding: 32px;
      background: black;
      color: white;
    }
    
    .footer-title {
      font-weight: 600;
      margin-bottom: 16px;
      font-size: 18px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .footer-text {
      font-size: 14px;
      line-height: 1.6;
    }
    
    .footer-text div {
      margin-bottom: 8px;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è */
    .formatted-profile {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      margin-bottom: 20px;
    }

    .profile-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 24px;
    }

    .profile-header h2 {
      color: white !important;
    }

    .view-toggle-btn {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .view-toggle-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.4);
    }

    .view-toggle-btn.active {
      background: white;
      color: #667eea;
      border-color: white;
      font-weight: 600;
    }

    .profile-content {
      padding: 24px;
    }

    .profile-text {
      font-size: 16px;
      line-height: 1.8;
      color: #374151;
    }

    .profile-text h3, .profile-text h4 {
      margin-top: 24px;
      margin-bottom: 12px;
      color: #1f2937;
      font-weight: 700;
    }

    .profile-text p {
      margin-bottom: 12px;
    }

    .profile-text ul {
      margin: 12px 0;
      padding-left: 0;
    }

    .profile-text li {
      margin-bottom: 8px;
      padding: 8px 0;
      border-bottom: 1px solid #f3f4f6;
      list-style: none;
    }

    .profile-text li:last-child {
      border-bottom: none;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-spinner {
      border: 3px solid #f3f4f6;
      border-top: 3px solid #3b82f6;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    /* AI Loading Overlay */
    .ai-loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 9999;
      align-items: center;
      justify-content: center;
    }

    .ai-loading-content {
      background: white;
      padding: 40px;
      border-radius: 16px;
      text-align: center;
      max-width: 420px;
      margin: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .ai-loading-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #1f2937;
    }

    .ai-loading-subtitle {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 32px;
    }

    .ai-spinner {
      width: 50px;
      height: 50px;
      margin: 0 auto 24px;
      border: 4px solid #f3f4f6;
      border-top: 4px solid #3b82f6;
      border-radius: 50%;
      animation: ai-spin 1s linear infinite;
    }

    @keyframes ai-spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .ai-progress-dots {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    .ai-dot {
      width: 10px;
      height: 10px;
      background: #3b82f6;
      border-radius: 50%;
      animation: ai-bounce 1.4s ease-in-out infinite both;
    }

    .ai-dot:nth-child(1) { animation-delay: -0.32s; }
    .ai-dot:nth-child(2) { animation-delay: -0.16s; }
    .ai-dot:nth-child(3) { animation-delay: 0s; }

    @keyframes ai-bounce {
      0%, 80%, 100% { 
        transform: scale(0.6); 
        opacity: 0.5; 
      }
      40% { 
        transform: scale(1.2); 
        opacity: 1; 
      }
    }

    .ai-status-text {
      font-size: 14px;
      color: #4b5563;
      font-weight: 500;
    }

    /* Utility classes */
    .flex {
      display: flex;
    }
    
    .items-center {
      align-items: center;
    }
    
    .gap-3 {
      gap: 12px;
    }
  </style>
</head>

<body>
  <!-- Header –≤ —Å—Ç–∏–ª–µ –ª–µ–Ω–¥–∏–Ω–≥–∞ -->
  <header class="border-b-2 border-gray-200">
    <div class="container py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-2">
          <svg class="h-8 w-8" fill="currentColor" viewBox="0 0 24 24">
            <path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/>
          </svg>
          <span class="text-xl font-bold">DataTrace</span>
        </div>
        <div class="flex items-center space-x-4">
          <div id="userInfo" class="hidden">
            <span id="userEmail" class="text-sm"></span>
            <button id="logoutBtn" class="btn-secondary ml-2">–í—ã–π—Ç–∏</button>
          </div>
          <button id="loginBtn" class="btn-secondary">–í–æ–π—Ç–∏</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Auth Modal -->
  <div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white max-w-md w-full p-6 border-2 border-black">
        <div class="flex justify-between items-center mb-6">
          <h2 id="authTitle" class="text-xl font-bold">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
          <button id="closeAuthModal" class="text-2xl">&times;</button>
        </div>
        
        <div id="authError" class="hidden mb-4 p-3 bg-red-100 border border-red-400 text-red-700"></div>
        <div id="authSuccess" class="hidden mb-4 p-3 bg-green-100 border border-green-400 text-green-700"></div>
        
        <form id="authForm">
          <div class="mb-4">
            <label class="block text-sm font-bold mb-2">Email</label>
            <input id="authEmail" type="email" class="input-field w-full" required>
          </div>
          
          <div class="mb-4">
            <label class="block text-sm font-bold mb-2">–ü–∞—Ä–æ–ª—å</label>
            <input id="authPassword" type="password" class="input-field w-full" required>
          </div>
          
          <div class="mb-6">
            <button id="authSubmit" type="submit" class="btn-primary w-full">–í–æ–π—Ç–∏</button>
          </div>
          
          <div class="text-center">
            <button id="authToggle" type="button" class="text-sm underline">
              –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="container py-16">
    <!-- Hero Section -->
    <div class="text-center mb-16">
      <h1 id="heroTitle" class="text-5xl font-bold text-black leading-tight mb-6">
        –ü–æ–∏—Å–∫ —É—Ç–µ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö
      </h1>
      <p id="heroDescription" class="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
        –ü—Ä–æ–≤–µ—Ä–∏–º –≤–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –≤—Å–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º —É—Ç–µ—á–µ–∫ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–º –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
      </p>
    </div>

    <!-- Search Form -->
    <div class="max-w-4xl mx-auto">
      <!-- Mode Selection -->
      <div class="flex gap-3 mb-8 justify-center flex-wrap">
        <button id="modeLeaks" class="btn-secondary active">–ü–æ–∏—Å–∫ —É—Ç–µ—á–µ–∫</button>
        <button id="modeCompany" class="btn-secondary">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é</button>
        <button id="modePassword" class="btn-secondary">üîê –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
      </div>

      <!-- Search Input -->
      <div id="searchInput" class="flex gap-4 mb-8 flex-wrap">
        <select id="field" class="select-field">
          <option value="phone">–¢–µ–ª–µ—Ñ–æ–Ω</option>
          <option value="email">Email</option>
          <option value="vk">VK</option>
          <option value="ok">–û–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–∏</option>
          <option value="inn">–ò–ù–ù</option>
          <option value="snils">–°–ù–ò–õ–°</option>
        </select>
        <input id="q" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: +79990000000" class="input-field" />
        <button id="btn" class="btn-primary">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
      </div>

      <!-- Password Check Input -->
      <div id="passwordInput" class="hidden mb-8">
        <div class="max-w-2xl mx-auto">
          <div class="mb-4">
            <label class="block text-sm font-bold mb-2">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏</label>
            <div class="relative">
              <input id="passwordField" type="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å..." class="input-field w-full pr-12" />
              <button id="togglePassword" type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-black">
                üëÅÔ∏è
              </button>
            </div>
          </div>
          <div class="mb-4">
            <div id="passwordStrength" class="text-sm text-gray-600"></div>
          </div>
          <div class="text-center">
            <button id="checkPasswordBtn" class="btn-primary">üîê –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
          </div>
          <div class="mt-4 text-xs text-gray-500 text-center">
            <p>‚ö†Ô∏è –ü–∞—Ä–æ–ª—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ö–µ—à. –°–∞–º –ø–∞—Ä–æ–ª—å –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä.</p>
          </div>
        </div>
      </div>

      <!-- Progress -->
      <div id="progressContainer" class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text">
          <span id="progressStatus">–û–∂–∏–¥–∞–Ω–∏–µ...</span>
          <span id="progressPercent" class="progress-percent">0%</span>
        </div>
      </div>

      <!-- Results -->
      <div id="results"></div>
    </div>

    <!-- Footer Info -->
    <div class="footer-section">
      <div class="max-w-4xl mx-auto">
        <div class="footer-title">–£–¥–∞–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</div>
        <div class="footer-text">
          <div>1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö</div>
          <div>2. –í—ã–±–µ—Ä–∏—Ç–µ "–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å"</div>
          <div>3. –ù–∞–∂–º–∏—Ç–µ "–°–∫—Ä—ã—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é"</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    const q = document.getElementById('q');
    const fieldSel = document.getElementById('field');
    const btn = document.getElementById('btn');
    const modeLeaks = document.getElementById('modeLeaks');
    const modeCompany = document.getElementById('modeCompany');
    const modePassword = document.getElementById('modePassword');
    const results = document.getElementById('results');
    
    // Password check elements
    const searchInput = document.getElementById('searchInput');
    const passwordInput = document.getElementById('passwordInput');
    const passwordField = document.getElementById('passwordField');
    const togglePassword = document.getElementById('togglePassword');
    const passwordStrength = document.getElementById('passwordStrength');
    const checkPasswordBtn = document.getElementById('checkPasswordBtn');

    // Authentication elements
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const userInfo = document.getElementById('userInfo');
    const userEmail = document.getElementById('userEmail');
    const authModal = document.getElementById('authModal');
    const closeAuthModal = document.getElementById('closeAuthModal');
    const authForm = document.getElementById('authForm');
    const authTitle = document.getElementById('authTitle');
    const authSubmit = document.getElementById('authSubmit');
    const authToggle = document.getElementById('authToggle');
    const authError = document.getElementById('authError');
    const authSuccess = document.getElementById('authSuccess');

    // Authentication state
    let currentUser = null;
    let authToken = null;
    let isLoginMode = true;

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤
    let currentMode = 'leaks';

    // ===== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –£–¢–ï–ß–ö–ê–ú–ò (–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–µ) =====
    window.displayLeakResultsBySources = async function(sourceResults) {
      results.innerHTML = '';
      
      if (!sourceResults || sourceResults.length === 0) {
        results.innerHTML = '<div class="result-card"><div style="color: #dc2626;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div></div>';
        return;
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –≤–æ–æ–±—â–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è AI –∞–Ω–∞–ª–∏–∑–∞
      const hasAnyData = sourceResults.some(result => 
        result.ok && result.items && window.checkIfSourceHasLeakData(result, result.name)
      );

      // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ò–ò –∞–Ω–∞–ª–∏–∑–∞ –í –ù–ê–ß–ê–õ–ï –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ
      if (hasAnyData) {
        const aiAnalysisContainer = document.createElement('div');
        aiAnalysisContainer.className = 'result-card';
        aiAnalysisContainer.style.textAlign = 'center';
        aiAnalysisContainer.style.backgroundColor = '#f8fafc';
        aiAnalysisContainer.style.border = '2px dashed #cbd5e1';
        
        aiAnalysisContainer.innerHTML = `
          <div style="padding: 20px;">
            <div style="font-size: 18px; font-weight: 600; margin-bottom: 10px;">ü§ñ –ê–Ω–∞–ª–∏–∑ –ò–ò</div>
            <div style="color: #64748b; margin-bottom: 15px;">
              –ü–æ–ª—É—á–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —É—Ç–µ—á–µ–∫, –æ—Ü–µ–Ω–∫—É –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
            </div>
            <button id="getAIAnalysis" class="btn-primary" style="margin: 0 auto;">
              üìä –ü–æ–ª—É—á–∏—Ç—å –ò–ò –∞–Ω–∞–ª–∏–∑
            </button>
            <div id="aiAnalysisResult" style="display: none; margin-top: 20px;"></div>
          </div>
        `;
        
        results.appendChild(aiAnalysisContainer);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏
        document.getElementById('getAIAnalysis').addEventListener('click', async () => {
          await performAIAnalysis(sourceResults);
        });
      }

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –ü–û–°–õ–ï AI –±–ª–æ–∫–∞
      sourceResults.forEach((result, index) => {
        const sourceName = result.name || `–ò—Å—Ç–æ—á–Ω–∏–∫ ${index + 1}`;
        let status = 'success';
        
        if (result.error) {
          status = 'warning';
        } else if (result.ok && result.items) {
          const hasData = window.checkIfSourceHasLeakData(result, sourceName);
          if (hasData) {
            status = 'danger';
          }
        }
        
        const item = createResultItem(sourceName, status, result.items || result.error);
        results.appendChild(item);
      });
    };

    // –§—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ò–ò –∞–Ω–∞–ª–∏–∑–∞
    async function performAIAnalysis(sourceResults) {
      const button = document.getElementById('getAIAnalysis');
      const resultDiv = document.getElementById('aiAnalysisResult');
      
      button.disabled = true;
      button.innerHTML = 'üîÑ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ...';
      
      try {
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ–ª—å—à–æ–π —Ç–∞–π–º–∞—É—Ç –¥–ª—è DeepSeek V3 –∞–Ω–∞–ª–∏–∑–∞ (120 —Å–µ–∫—É–Ω–¥)
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 120000);
        
        const response = await fetch('/api/ai-leak-analysis', {
          method: 'POST',
          headers: createAuthHeaders(),
          body: JSON.stringify({
            query: q.value.trim(),
            field: fieldSel.value,
            results: sourceResults
          }),
          signal: controller.signal
        });

        clearTimeout(timeoutId);
        const data = await response.json();
        
        if (data.ok && data.analysis) {
          displayAIAnalysis(data.analysis, resultDiv);
          button.style.display = 'none';
          resultDiv.style.display = 'block';
        } else {
          throw new Error(data.error || '–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞');
        }
      } catch (error) {
        if (error.name === 'AbortError') {
          console.error('AI Analysis timeout after 120 seconds');
          button.innerHTML = '‚è±Ô∏è –¢–∞–π–º–∞—É—Ç –∞–Ω–∞–ª–∏–∑–∞ (120—Å)';
        } else {
          console.error('AI Analysis error:', error);
          button.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞';
        }
        button.disabled = false;
        
        setTimeout(() => {
          button.innerHTML = 'üìä –ü–æ–ª—É—á–∏—Ç—å –ò–ò –∞–Ω–∞–ª–∏–∑';
        }, 3000);
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ò–ò –∞–Ω–∞–ª–∏–∑–∞
    function displayAIAnalysis(analysis, container) {
      console.log('üéØ displayAIAnalysis called!');
      console.log('üìä Analysis type:', typeof analysis);
      console.log('üìù Analysis preview:', typeof analysis === 'string' ? analysis.substring(0, 200) + '...' : analysis);
      console.log('üì¶ Container element:', container);
      
      let html = '<div style="text-align: left; background: white; padding: 20px; border-radius: 8px; border: 1px solid #e2e8f0;">';
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø –∞–Ω–∞–ª–∏–∑–∞ - —Å—Ç—Ä–æ–∫–∞ (DeepSeek V3) –∏–ª–∏ –æ–±—ä–µ–∫—Ç (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç)
      if (typeof analysis === 'string') {
        // DeepSeek V3 –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π markdown-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
        let htmlContent = analysis
          .replace(/\n/g, '<br>')
          .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
          .replace(/### (.*?)(?=<br>|$)/g, '<h3 style="color: #1f2937; margin: 16px 0 8px 0; font-size: 18px;">$1</h3>')
          .replace(/#### (.*?)(?=<br>|$)/g, '<h4 style="color: #374151; margin: 12px 0 6px 0; font-size: 16px;">$1</h4>');

        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º markdown-—Ç–∞–±–ª–∏—Ü—ã –≤ HTML-—Ç–∞–±–ª–∏—Ü—ã
        htmlContent = htmlContent.replace(
          /(\|.*?\|<br>)+/g,
          match => {
            const lines = match.split('<br>').filter(line => line.trim().startsWith('|'));
            if (lines.length < 2) return match; // –Ω–µ —Ç–∞–±–ª–∏—Ü–∞
            
            const rows = lines.map(line => 
              line.trim().slice(1, -1).split('|').map(cell => cell.trim())
            );
            
            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç—Ä–æ–∫—É —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏ (---|---|---)
            const dataRows = rows.filter(row => !row[0].includes('-'));
            if (dataRows.length < 2) return match;
            
            let table = '<table style="width:100%;border-collapse:collapse;margin:16px 0;font-size:14px;">';
            
            // –ó–∞–≥–æ–ª–æ–≤–æ–∫
            table += '<thead><tr>';
            dataRows[0].forEach(cell => {
              table += `<th style="border:1px solid #d1d5db;padding:8px 12px;background:#f9fafb;text-align:left;font-weight:600;">${cell}</th>`;
            });
            table += '</tr></thead>';
            
            // –î–∞–Ω–Ω—ã–µ
            table += '<tbody>';
            for (let i = 1; i < dataRows.length; i++) {
              table += '<tr>';
              dataRows[i].forEach(cell => {
                table += `<td style="border:1px solid #d1d5db;padding:8px 12px;">${cell}</td>`;
              });
              table += '</tr>';
            }
            table += '</tbody></table>';
            
            return table;
          }
        );

        html += `
          <div style="color: #374151; line-height: 1.6; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
            ${htmlContent}
          </div>
        `;
      } else if (typeof analysis === 'object' && analysis !== null) {
        // –°—Ç–∞—Ä—ã–π –æ–±—ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç - –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        
        // –£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏
        if (analysis.risk_level) {
          const riskColors = {
            'low': '#16a34a',
            'medium': '#d97706', 
            'high': '#dc2626',
            'critical': '#991b1b'
          };
          const riskTexts = {
            'low': '–ù–∏–∑–∫–∏–π',
            'medium': '–°—Ä–µ–¥–Ω–∏–π',
            'high': '–í—ã—Å–æ–∫–∏–π', 
            'critical': '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π'
          };
          
          html += `
            <div style="margin-bottom: 20px;">
              <div style="font-weight: 600; margin-bottom: 8px;">üö® –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞:</div>
              <div style="color: ${riskColors[analysis.risk_level] || '#6b7280'}; font-weight: 600; font-size: 16px;">
                ${riskTexts[analysis.risk_level] || analysis.risk_level}
              </div>
            </div>
          `;
        }

        // –°–∞–π—Ç—ã –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª–µ–π
        if (analysis.security_recommendations?.password_change_sites?.length > 0) {
          html += `
            <div style="margin-bottom: 20px;">
              <div style="font-weight: 600; margin-bottom: 8px;">üîê –°–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –Ω–∞ —Å–∞–π—Ç–∞—Ö:</div>
              <ul style="list-style: none; padding-left: 0;">
          `;
          analysis.security_recommendations.password_change_sites.forEach(site => {
            html += `<li style="margin-bottom: 4px; color: #dc2626;">‚Ä¢ ${site}</li>`;
          });
          html += '</ul></div>';
        }

        // –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞
        if (analysis.summary) {
          html += `
            <div style="margin-bottom: 20px;">
              <div style="font-weight: 600; margin-bottom: 8px;">üìã –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞:</div>
              <div style="color: #374151; line-height: 1.5;">${analysis.summary}</div>
            </div>
          `;
        }

        // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        if (analysis.security_recommendations?.immediate_actions?.length > 0) {
          html += `
            <div>
              <div style="font-weight: 600; margin-bottom: 8px;">‚ö° –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</div>
              <ul style="list-style: none; padding-left: 0;">
          `;
          analysis.security_recommendations.immediate_actions.forEach(action => {
            html += `<li style="margin-bottom: 4px; color: #059669;">‚Ä¢ ${action}</li>`;
          });
          html += '</ul></div>';
        }
      } else {
        // Fallback –¥–ª—è –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
        html += `
          <div style="color: #dc2626; font-weight: 600;">
            ‚ùå –û—à–∏–±–∫–∞: –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∞–Ω–∞–ª–∏–∑–∞
          </div>
          <pre style="background: #f3f4f6; padding: 10px; border-radius: 4px; margin-top: 10px; overflow-x: auto;">
            ${JSON.stringify(analysis, null, 2)}
          </pre>
        `;
      }

      html += '</div>';
      container.innerHTML = html;
      
      console.log('‚úÖ HTML content set!');
      console.log('üìè HTML length:', html.length);
      console.log('üëÅÔ∏è Container visibility:', container.style.display);
      console.log('üé® Final HTML preview:', html.substring(0, 300) + '...');
    }

    // –§—É–Ω–∫—Ü–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    function displayStandardLeakResults(sourceResults, aiSummary) {
      results.innerHTML = '';
      
      sourceResults.forEach((result, index) => {
        const sourceName = result.name || `–ò—Å—Ç–æ—á–Ω–∏–∫ ${index + 1}`;
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        let status = 'success'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–µ–ª–µ–Ω—ã–π (–Ω–µ—Ç —É—Ç–µ—á–µ–∫)
        
        if (result.error) {
          status = 'warning'; // –ñ–µ–ª—Ç—ã–π (–æ—à–∏–±–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞)
        } else if (result.ok && result.items) {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
          const hasData = window.checkIfSourceHasLeakData(result, sourceName);
          if (hasData) {
            status = 'danger'; // –ö—Ä–∞—Å–Ω—ã–π (–Ω–∞–π–¥–µ–Ω—ã —É—Ç–µ—á–∫–∏)
          }
        }
        
        let displayData = result.items || result.error;
        
        // –ï—Å–ª–∏ –µ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç AI, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö
        if (aiSummary && result.ok && result.items) {
          displayData = window.formatAIDataForLeakSource(result.items, sourceName, aiSummary);
        }
        
        const item = createResultItem(sourceName, status, displayData);
        results.appendChild(item);
      });
    }

    window.checkIfSourceHasLeakData = function(result, sourceName) {
      if (!result.ok || !result.items) return false;
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
      switch (sourceName) {
        case 'ITP':
          return result.items && typeof result.items === 'object' && Object.keys(result.items).length > 0;
        case 'Dyxless':
          return Array.isArray(result.items) && result.items.length > 0;
        case 'LeakOsint':
          return Array.isArray(result.items) && result.items.length > 0;
        case 'Usersbox':
          return Array.isArray(result.items) && result.items.length > 0;
        case 'Vektor':
          return result.items && (Array.isArray(result.items) ? result.items.length > 0 : Object.keys(result.items).length > 0);
        default:
          return false;
      }
    };

    // ===== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø –î–ê–ù–ù–´–• –ò–ò =====
    window.formatAIDataForLeakSource = function(originalData, sourceName, aiSummary) {
      const formattedData = {};
      
      // –ï—Å–ª–∏ –µ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –ò–ò –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö
      if (aiSummary && aiSummary.sources && aiSummary.sources[sourceName]) {
        const sourceInfo = aiSummary.sources[sourceName];
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
        if (sourceInfo.foundCount) {
          formattedData['üìä –ù–∞–π–¥–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π'] = sourceInfo.foundCount;
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        if (sourceInfo.databases && sourceInfo.databases.length > 0) {
          formattedData['üóÑÔ∏è –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö'] = sourceInfo.databases.join(', ');
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –æ—Ç –ò–ò
        if (sourceInfo.records && Array.isArray(sourceInfo.records)) {
          sourceInfo.records.forEach((record, index) => {
            if (record && typeof record === 'object') {
              const recordInfo = [];
              
              // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∫–∞–∂–¥—É—é –∑–∞–ø–∏—Å—å
              if (record.email) recordInfo.push(`üìß ${record.email}`);
              if (record.phone) recordInfo.push(`üìû ${record.phone}`);
              if (record.name) recordInfo.push(`üë§ ${record.name}`);
              if (record.username) recordInfo.push(`üîë ${record.username}`);
              if (record.password) recordInfo.push(`üîê ${record.password.substring(0, 8)}...`);
              if (record.database) recordInfo.push(`üóÑÔ∏è ${record.database}`);
              if (record.source) recordInfo.push(`üîó ${record.source}`);
              if (record.date) recordInfo.push(`üìÖ ${record.date}`);
              
              if (recordInfo.length > 0) {
                formattedData[`üìÑ –ó–∞–ø–∏—Å—å ${index + 1}`] = recordInfo.join(' | ');
              }
            } else if (typeof record === 'string') {
              formattedData[`üìÑ –ó–∞–ø–∏—Å—å ${index + 1}`] = record;
            }
          });
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–º–µ—Ç–∫–∏ –ò–ò
        if (sourceInfo.notes) {
          formattedData['üìù –ê–Ω–∞–ª–∏–∑ –ò–ò'] = sourceInfo.notes;
        }
        
        // –ï—Å–ª–∏ –µ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Ö
        if (Object.keys(formattedData).length > 1) { // –±–æ–ª—å—à–µ 1 –ø–æ—Ç–æ–º—É —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ —Å—á–µ—Ç—á–∏–∫
          return formattedData;
        }
      }
      
      // –ï—Å–ª–∏ –Ω–µ—Ç –ò–ò –¥–∞–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      if (originalData && typeof originalData === 'object') {
        switch (sourceName) {
          case 'ITP':
            formatITPData(originalData, formattedData);
            break;
          case 'Dyxless':
            formatDyxlessData(originalData, formattedData);
            break;
          case 'LeakOsint':
            formatLeakOsintData(originalData, formattedData);
            break;
          case 'Usersbox':
            formatUsersboxData(originalData, formattedData);
            break;
          case 'Vektor':
            formatVektorData(originalData, formattedData);
            break;
          default:
            Object.assign(formattedData, originalData);
        }
      }
      
      return Object.keys(formattedData).length > 0 ? formattedData : originalData;
    };

    function formatITPData(data, formattedData) {
      if (!data || typeof data !== 'object') return;
      
      // ITP –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –≤–∏–¥–µ –≥—Ä—É–ø–ø
      for (const [groupName, groupData] of Object.entries(data)) {
        if (groupData && groupData.data && Array.isArray(groupData.data)) {
          formattedData[`üìÅ ${groupName}`] = `${groupData.data.length} –∑–∞–ø–∏—Å–µ–π`;
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π
          groupData.data.slice(0, 3).forEach((record, index) => {
            if (record && typeof record === 'object') {
              const recordInfo = [];
              if (record.phone) recordInfo.push(`üìû ${record.phone}`);
              if (record.email) recordInfo.push(`üìß ${record.email}`);
              if (record.name) recordInfo.push(`üë§ ${record.name}`);
              if (record.address) recordInfo.push(`üè† ${record.address}`);
              
              if (recordInfo.length > 0) {
                formattedData[`  ‚îî –ó–∞–ø–∏—Å—å ${index + 1}`] = recordInfo.join(', ');
              }
            }
          });
          
          if (groupData.data.length > 3) {
            formattedData[`  ‚îî ...`] = `–∏ –µ—â–µ ${groupData.data.length - 3} –∑–∞–ø–∏—Å–µ–π`;
          }
        }
      }
    }

    function formatDyxlessData(data, formattedData) {
      if (!Array.isArray(data)) return;
      
      formattedData['üìä –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π'] = data.length;
      
      // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö
      const databases = {};
      data.forEach(record => {
        if (record && record.database) {
          if (!databases[record.database]) {
            databases[record.database] = [];
          }
          databases[record.database].push(record);
        }
      });
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –±–∞–∑–∞–º
      for (const [dbName, records] of Object.entries(databases)) {
        formattedData[`üóÑÔ∏è –ë–∞–∑–∞: ${dbName}`] = `${records.length} –∑–∞–ø–∏—Å–µ–π`;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ –∑–∞–ø–∏—Å–∏
        records.slice(0, 2).forEach((record, index) => {
          const recordInfo = [];
          if (record.email) recordInfo.push(`üìß ${record.email}`);
          if (record.phone) recordInfo.push(`üìû ${record.phone}`);
          if (record.name) recordInfo.push(`üë§ ${record.name}`);
          if (record.password) recordInfo.push(`üîë ${record.password.substring(0, 10)}...`);
          
          if (recordInfo.length > 0) {
            formattedData[`  ‚îî ${index + 1}`] = recordInfo.join(', ');
          }
        });
      }
    }

    function formatLeakOsintData(data, formattedData) {
      if (!Array.isArray(data)) return;
      
      formattedData['üìä –ù–∞–π–¥–µ–Ω–æ –±–∞–∑'] = data.length;
      
      data.forEach((leak, index) => {
        if (leak && leak.db) {
          formattedData[`üóÑÔ∏è –ë–∞–∑–∞: ${leak.db}`] = leak.info || '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–∑–µ';
          
          if (leak.data && Array.isArray(leak.data)) {
            formattedData[`  ‚îî –ó–∞–ø–∏—Å–µ–π –≤ –±–∞–∑–µ`] = leak.data.length;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ –∑–∞–ø–∏—Å–∏
            leak.data.slice(0, 2).forEach((record, recordIndex) => {
              if (typeof record === 'string') {
                formattedData[`  ‚îî ${recordIndex + 1}`] = record;
              } else if (typeof record === 'object') {
                const recordInfo = [];
                Object.entries(record).forEach(([key, value]) => {
                  if (value && typeof value === 'string') {
                    recordInfo.push(`${key}: ${value}`);
                  }
                });
                if (recordInfo.length > 0) {
                  formattedData[`  ‚îî ${recordIndex + 1}`] = recordInfo.join(', ');
                }
              }
            });
          }
        }
      });
    }

    function formatUsersboxData(data, formattedData) {
      if (!Array.isArray(data)) return;
      
      formattedData['üìä –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π'] = data.length;
      
      data.slice(0, 5).forEach((record, index) => {
        if (record && typeof record === 'object') {
          const recordInfo = [];
          if (record.email) recordInfo.push(`üìß ${record.email}`);
          if (record.phone) recordInfo.push(`üìû ${record.phone}`);
          if (record.name) recordInfo.push(`üë§ ${record.name}`);
          if (record.source) recordInfo.push(`üîó ${record.source}`);
          
          if (recordInfo.length > 0) {
            formattedData[`üìÑ –ó–∞–ø–∏—Å—å ${index + 1}`] = recordInfo.join(', ');
          }
        }
      });
      
      if (data.length > 5) {
        formattedData['...'] = `–∏ –µ—â–µ ${data.length - 5} –∑–∞–ø–∏—Å–µ–π`;
      }
    }

    function formatVektorData(data, formattedData) {
      if (Array.isArray(data)) {
        formattedData['üìä –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π'] = data.length;
        
        data.slice(0, 5).forEach((record, index) => {
          if (typeof record === 'string') {
            formattedData[`üìÑ ${index + 1}`] = record;
          } else if (typeof record === 'object') {
            const recordInfo = [];
            Object.entries(record).forEach(([key, value]) => {
              if (value) recordInfo.push(`${key}: ${value}`);
            });
            if (recordInfo.length > 0) {
              formattedData[`üìÑ ${index + 1}`] = recordInfo.join(', ');
            }
          }
        });
      } else if (typeof data === 'object') {
        Object.entries(data).forEach(([key, value]) => {
          if (value) {
            formattedData[key] = Array.isArray(value) ? value.join(', ') : value;
          }
        });
      }
    }

    function displayFinanceData(bodyId, financeData) {
      const bodyEl = document.getElementById(bodyId);
      if (!bodyEl || !financeData) return;
      
      console.log('üìä Displaying finance data:', financeData);
      
      let financeHtml = '<div style="margin-top: 20px; border-top: 2px solid #e5e7eb; padding-top: 16px;">';
      financeHtml += '<h4 style="color: #1f2937; font-weight: 600; margin-bottom: 12px;">üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>';
      
      // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–∞–Ω–∏–∏
      if (financeData.company) {
        financeHtml += '<div style="margin-bottom: 16px;">';
        financeHtml += '<h5 style="color: #374151; font-weight: 600; margin-bottom: 8px;">–ö–æ–º–ø–∞–Ω–∏—è</h5>';
        financeHtml += formatResultData(financeData.company);
        financeHtml += '</div>';
      }
      
      // –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –≥–æ–¥–∞–º
      if (financeData.data && typeof financeData.data === 'object') {
        financeHtml += '<div style="margin-bottom: 16px;">';
        financeHtml += '<h5 style="color: #374151; font-weight: 600; margin-bottom: 8px;">–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h5>';
        
        const years = Object.keys(financeData.data).sort((a, b) => b - a); // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é
        
        if (years.length > 0) {
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –≥–æ–¥–∞
          const recentYears = years.slice(0, 3);
          
          recentYears.forEach(year => {
            const yearData = financeData.data[year];
            if (yearData && typeof yearData === 'object') {
              financeHtml += `<div style="margin-bottom: 12px; padding: 8px; background: #f9fafb; border-radius: 4px;">`;
              financeHtml += `<h6 style="color: #1f2937; font-weight: 600; margin-bottom: 8px;">üìÖ ${year} –≥–æ–¥</h6>`;
              
              // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
              const formattedYearData = formatFinancialIndicators(yearData);
              financeHtml += formatResultData(formattedYearData);
              
              financeHtml += '</div>';
            }
          });
          
          if (years.length > 3) {
            financeHtml += `<div style="color: #6b7280; font-style: italic;">–ò –µ—â–µ –¥–∞–Ω–Ω—ã–µ –∑–∞ ${years.length - 3} –ª–µ—Ç(–∞)</div>`;
          }
        } else {
          financeHtml += '<div style="color: #6b7280;">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</div>';
        }
        
        financeHtml += '</div>';
      }
      
      // –°—Å—ã–ª–∫–∏ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã
      if (financeData['bo.nalog.ru'] && financeData['bo.nalog.ru']['–û—Ç—á–µ—Ç']) {
        const reports = financeData['bo.nalog.ru']['–û—Ç—á–µ—Ç'];
        financeHtml += '<div style="margin-bottom: 16px;">';
        financeHtml += '<h5 style="color: #374151; font-weight: 600; margin-bottom: 8px;">üìã –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –§–ù–°</h5>';
        
        Object.entries(reports).forEach(([year, url]) => {
          financeHtml += `<div style="margin-bottom: 4px;">`;
          financeHtml += `<a href="${url}" target="_blank" style="color: #2563eb; text-decoration: underline;">`;
          financeHtml += `üìÑ –û—Ç—á–µ—Ç –∑–∞ ${year} –≥–æ–¥</a>`;
          financeHtml += `</div>`;
        });
        
        financeHtml += '</div>';
      }
      
      financeHtml += '</div>';
      
      bodyEl.innerHTML += financeHtml;
    }
    
    function formatFinancialIndicators(yearData) {
      const formatted = {};
      
      // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–æ–π –∫–æ–¥–æ–≤
      const indicators = {
        '1100': '–ò—Ç–æ–≥–æ –ø–æ —Ä–∞–∑–¥–µ–ª—É I (–≤–Ω–µ–æ–±–æ—Ä–æ—Ç–Ω—ã–µ –∞–∫—Ç–∏–≤—ã)',
        '1200': '–ò—Ç–æ–≥–æ –ø–æ —Ä–∞–∑–¥–µ–ª—É II (–æ–±–æ—Ä–æ—Ç–Ω—ã–µ –∞–∫—Ç–∏–≤—ã)', 
        '1600': '–ë–ê–õ–ê–ù–° (–∞–∫—Ç–∏–≤)',
        '1300': '–ò—Ç–æ–≥–æ –ø–æ —Ä–∞–∑–¥–µ–ª—É III (–∫–∞–ø–∏—Ç–∞–ª –∏ —Ä–µ–∑–µ—Ä–≤—ã)',
        '1400': '–ò—Ç–æ–≥–æ –ø–æ —Ä–∞–∑–¥–µ–ª—É IV (–¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞)',
        '1500': '–ò—Ç–æ–≥–æ –ø–æ —Ä–∞–∑–¥–µ–ª—É V (–∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞)',
        '1700': '–ë–ê–õ–ê–ù–° (–ø–∞—Å—Å–∏–≤)',
        '2110': '–í—ã—Ä—É—á–∫–∞',
        '2200': '–ü—Ä–∏–±—ã–ª—å (—É–±—ã—Ç–æ–∫) –æ—Ç –ø—Ä–æ–¥–∞–∂',
        '2300': '–ü—Ä–∏–±—ã–ª—å (—É–±—ã—Ç–æ–∫) –¥–æ –Ω–∞–ª–æ–≥–æ–æ–±–ª–æ–∂–µ–Ω–∏—è',
        '2400': '–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å (—É–±—ã—Ç–æ–∫)'
      };
      
      Object.entries(indicators).forEach(([code, description]) => {
        if (yearData[code] !== undefined && yearData[code] !== null) {
          const value = Number(yearData[code]);
          if (!isNaN(value)) {
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∫—Ä—É–ø–Ω—ã–µ —Å—É–º–º—ã
            formatted[description] = formatCurrency(value);
          }
        }
      });
      
      return formatted;
    }
    
    function formatCurrency(value) {
      if (Math.abs(value) >= 1000000) {
        return `${(value / 1000000).toFixed(1)} –º–ª–Ω —Ä—É–±.`;
      } else if (Math.abs(value) >= 1000) {
        return `${(value / 1000).toFixed(0)} —Ç—ã—Å. —Ä—É–±.`;
      } else {
        return `${value} —Ä—É–±.`;
      }
    }

    // –§—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    function showProgress() {
      document.getElementById('progressContainer').style.display = 'block';
      resetProgress();
    }

    function hideProgress() {
      document.getElementById('progressContainer').style.display = 'none';
    }

    function resetProgress() {
      const fill = document.getElementById('progressFill');
      const percent = document.getElementById('progressPercent');
      const status = document.getElementById('progressStatus');
      
      fill.style.width = '0%';
      percent.textContent = '0%';
      status.textContent = '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...';
    }

    function updateProgress(percentage, statusText) {
      const fill = document.getElementById('progressFill');
      const percent = document.getElementById('progressPercent');
      const status = document.getElementById('progressStatus');
      
      fill.style.width = percentage + '%';
      percent.textContent = Math.round(percentage) + '%';
      status.textContent = statusText;
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    function createResultItem(title, status, data, isOpen = false) {
      const item = document.createElement('div');
      item.className = `result-card ${isOpen ? 'open' : ''}`;
      
      const statusClass = status === 'success' ? 'status-clean' : 
                         status === 'danger' ? 'status-found' : 'status-error';
      const statusText = status === 'success' ? '–ß–∏—Å—Ç–æ' : 
                        status === 'danger' ? '–ù–∞–π–¥–µ–Ω–æ' : '–û—à–∏–±–∫–∞';

      item.innerHTML = `
        <div class="result-header" onclick="toggleResult(this)">
          <div class="result-title">${title}</div>
          <div class="flex items-center gap-3">
            <span class="status-badge ${statusClass}">${statusText}</span>
            <span class="caret">‚ñ∂</span>
          </div>
        </div>
        <div class="result-body">
          ${typeof data === 'string' ? data : formatResultData(data)}
        </div>
      `;

      return item;
    }

    // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    function toggleResult(header) {
      const card = header.closest('.result-card');
      card.classList.toggle('open');
    }

    // –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    function formatResultData(data) {
      if (!data || (typeof data === 'object' && Object.keys(data).length === 0)) {
        return '<div style="color: #6b7280; font-style: italic;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>';
      }

      if (typeof data === 'string') {
        return data;
      }

      let html = '<div class="data-grid">';
      
      for (const [key, value] of Object.entries(data)) {
        if (value !== null && value !== undefined && value !== '') {
          const formattedValue = Array.isArray(value) ? value.join(', ') : 
                                 typeof value === 'object' ? JSON.stringify(value, null, 2) : 
                                 String(value);
          
          html += `
            <div class="data-label">${key}</div>
            <div class="data-value">${formattedValue}</div>
          `;
        }
      }
      
      html += '</div>';
      return html;
    }

    // Helper function –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
    function createAuthHeaders() {
      const headers = {
        'Content-Type': 'application/json'
      };
      
      if (authToken) {
        headers['Authorization'] = `Bearer ${authToken}`;
      }
      
      return headers;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞
    async function performSearch() {
      if (currentMode === 'password') {
        // Password mode uses its own button and logic
        return;
      }
      
      const query = q.value.trim();
      if (!query) {
        alert('–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∏—Å–∫–∞');
        return;
      }

      btn.disabled = true;
      btn.textContent = '–ü–æ–∏—Å–∫...';
      results.innerHTML = '';
      showProgress();

      try {
        if (currentMode === 'company') {
          await performCompanySearch(query);
        } else {
          await performLeakSearch(query);
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:', error);
        hideProgress();
        results.innerHTML = `<div class="result-card"><div style="color: #dc2626;">${error.message}</div></div>`;
      } finally {
        btn.disabled = false;
        btn.textContent = '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å';
      }
    }

    // –ü–æ–∏—Å–∫ —É—Ç–µ—á–µ–∫ (–Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —Å –∫–Ω–æ–ø–∫–æ–π –ò–ò)
    async function performLeakSearch(query) {
      console.log('üîç Starting leak search for:', query);
      
      const allResults = [];
      const sources = [
        { name: 'ITP', step: 1 },
        { name: 'Dyxless', step: 2 },
        { name: 'LeakOsint', step: 3 },
        { name: 'Usersbox', step: 4 },
        { name: 'Vektor', step: 5 }
      ];

      // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
      for (const source of sources) {
        updateProgress((source.step / sources.length) * 90, `–ü–æ–∏—Å–∫ –≤ ${source.name}...`);
        
        try {
          const response = await fetch('/api/leak-search-step', {
            method: 'POST',
            headers: createAuthHeaders(),
            body: JSON.stringify({
              query: query,
              field: fieldSel.value,
              step: source.step
            })
          });

          const stepData = await response.json();
          
          if (stepData.result) {
            console.log(`‚úÖ ${source.name} completed:`, stepData.result);
            allResults.push(stepData.result);
          } else {
            console.log(`‚ùå ${source.name} failed:`, stepData.error);
            allResults.push({ name: source.name, ok: false, error: stepData.error });
          }
        } catch (error) {
          console.error(`üí• Error in ${source.name}:`, error);
          allResults.push({ name: source.name, ok: false, error: error.message });
        }
        
        await new Promise(resolve => setTimeout(resolve, 300));
      }

      // –°—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—ã—Ä—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
      updateProgress(100, '–ó–∞–≤–µ—Ä—à–µ–Ω–æ');
      setTimeout(() => {
        hideProgress();
        window.displayLeakResultsBySources(allResults);
      }, 500);
    }

    // –ü–æ–∏—Å–∫ –∫–æ–º–ø–∞–Ω–∏–π (—Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    async function performCompanySearch(query) {
      console.log('üè¢ Starting company search for:', query);
      
      const allResults = [];
      const sources = [
        { name: 'Datanewton', step: 1 },
        { name: 'Checko', step: 2 }
      ];

      // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –∫–æ–º–ø–∞–Ω–∏–π
      for (let i = 0; i < sources.length; i++) {
        const source = sources[i];
        const progress = 25 + (i * 25);
        
        updateProgress(progress, `–ü–æ–∏—Å–∫ –≤ ${source.name}...`);
        
        try {
          const response = await fetch('/api/company-search-step', {
            method: 'POST',
            headers: createAuthHeaders(),
            body: JSON.stringify({ inn: query, step: source.step })
          });

          const stepData = await response.json();
          
          if (response.ok && stepData.result) {
            allResults.push(stepData.result);
            console.log(`‚úÖ ${source.name} completed:`, stepData.result);
          } else {
            console.log(`‚ùå ${source.name} failed:`, stepData.error);
            allResults.push({ name: source.name, ok: false, error: stepData.error });
          }
        } catch (error) {
          console.error(`üí• Error in ${source.name}:`, error);
          allResults.push({ name: source.name, ok: false, error: error.message });
        }
        
        await new Promise(resolve => setTimeout(resolve, 300));
      }

      // –î–ª—è –∫–æ–º–ø–∞–Ω–∏–π –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–±–µ–∑ –ò–ò –∫–Ω–æ–ø–∫–∏)
      updateProgress(100, '–ó–∞–≤–µ—Ä—à–µ–Ω–æ');
      setTimeout(() => {
        hideProgress();
        displayCompanyResults(allResults);
      }, 500);
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–æ–º–ø–∞–Ω–∏–π (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞)
    function displayCompanyResults(companyResults) {
      results.innerHTML = '';
      
      if (!companyResults || companyResults.length === 0) {
        results.innerHTML = '<div class="result-card"><div style="color: #dc2626;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div></div>';
        return;
      }

      companyResults.forEach((result, index) => {
        const sourceName = result.name || `–ò—Å—Ç–æ—á–Ω–∏–∫ ${index + 1}`;
        let status = 'success';
        
        if (result.error) {
          status = 'warning';
        } else if (result.ok && result.items) {
          // –î–ª—è –∫–æ–º–ø–∞–Ω–∏–π —Å—á–∏—Ç–∞–µ–º —É—Å–ø–µ—Ö–æ–º –Ω–∞–ª–∏—á–∏–µ –ª—é–±—ã—Ö –¥–∞–Ω–Ω—ã—Ö
          status = 'success';
        }
        
        const item = createResultItem(sourceName, status, result.items || result.error);
        results.appendChild(item);
      });
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    btn.addEventListener('click', () => {
      console.log('Button clicked! Current mode:', currentMode);
      console.log('Button element:', btn);
      console.log('Query input:', q);
      performSearch();
    });
    
    q.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        console.log('Enter pressed! Current mode:', currentMode);
        performSearch();
      }
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤
    modeLeaks.addEventListener('click', () => {
      setMode('leaks');
    });
    
    modeCompany.addEventListener('click', () => {
      setMode('company');
    });
    
    modePassword.addEventListener('click', () => {
      setMode('password');
    });

    // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤
    function setMode(mode) {
      currentMode = mode;
      
      // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
      modeLeaks.classList.remove('active');
      modeCompany.classList.remove('active');
      modePassword.classList.remove('active');
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–µ
      if (mode === 'leaks') {
        modeLeaks.classList.add('active');
        searchInput.style.display = 'block';
        searchInput.style.justifyContent = 'flex-start';
        passwordInput.style.display = 'none';
        fieldSel.style.display = 'inline-block';
        fieldSel.value = 'phone'; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        q.placeholder = '–ù–∞–ø—Ä–∏–º–µ—Ä: +79990000000';
        q.value = '';
      } else if (mode === 'company') {
        modeCompany.classList.add('active');
        searchInput.style.display = 'block';
        searchInput.style.justifyContent = 'center'; // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –¥–ª—è –ò–ù–ù
        passwordInput.style.display = 'none';
        fieldSel.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä –¥–ª—è –ò–ù–ù
        q.placeholder = '–í–≤–µ–¥–∏—Ç–µ –ò–ù–ù';
        q.value = '';
        fieldSel.value = 'inn'; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –∫–∞–∫ –ò–ù–ù
      } else if (mode === 'password') {
        modePassword.classList.add('active');
        searchInput.style.display = 'none';
        passwordInput.style.display = 'block';
        fieldSel.style.display = 'none';
      }
      
      // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∏ —Å–º–µ–Ω–µ —Ä–µ–∂–∏–º–∞
      results.innerHTML = '';
    }

    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    window.toggleResult = toggleResult;

    // AI Loading —Ñ—É–Ω–∫—Ü–∏–∏
    function showAILoading() {
      const overlay = document.getElementById('aiLoadingOverlay');
      if (overlay) {
        overlay.style.display = 'flex';
      }
    }

    function hideAILoading() {
      const overlay = document.getElementById('aiLoadingOverlay');
      if (overlay) {
        overlay.style.display = 'none';
      }
    }

    function updateAIStatus(message) {
      const statusElement = document.querySelector('#aiLoadingOverlay .loading-text');
      if (statusElement) {
        statusElement.textContent = message;
      }
    }

    // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ
    window.showAILoading = showAILoading;
    window.hideAILoading = hideAILoading;
    window.updateAIStatus = updateAIStatus;
  </script>

  <!-- AI Loading Overlay -->
  <div id="aiLoadingOverlay" class="ai-loading-overlay">
    <div class="ai-loading-content">
      <div class="ai-loading-title">ü§ñ –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ò–ò</div>
      <div class="ai-loading-subtitle">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞–π–¥–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é...</div>
      
      <div class="ai-spinner"></div>
      
      <div class="ai-progress-dots">
        <div class="ai-dot"></div>
        <div class="ai-dot"></div>
        <div class="ai-dot"></div>
      </div>
      
      <div id="aiStatusText" class="ai-status-text">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</div>
    </div>
  </div>

</body>
</html>