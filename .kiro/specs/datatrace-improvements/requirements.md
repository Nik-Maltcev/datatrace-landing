# Requirements Document

## Introduction

Данная спецификация описывает улучшения для проекта DataTrace - системы поиска утечек данных и проверки компаний. Проект включает в себя исправление критических ошибок API, интеграцию авторизации через Supabase, удаление режима "быстро" и добавление нового режима "проверить пароль" с использованием API DeHashed.

## Requirements

### Requirement 1

**User Story:** Как разработчик, я хочу исправить ошибку 502 в эндпоинте `/api/company-summarize`, чтобы пользователи могли получать ИИ анализ компаний без сбоев

#### Acceptance Criteria

1. WHEN пользователь запрашивает анализ компании THEN система SHALL успешно обрабатывать запрос без ошибки 502
2. WHEN происходит ошибка в OpenAI API THEN система SHALL возвращать fallback ответ вместо 502 ошибки
3. WHEN запрос превышает таймаут THEN система SHALL возвращать базовую информацию о компании
4. WHEN OpenAI API недоступен THEN система SHALL логировать ошибку и возвращать структурированный fallback ответ

### Requirement 2

**User Story:** Как пользователь, я хочу авторизоваться в системе через Supabase, чтобы иметь персонализированный доступ к функциям поиска

#### Acceptance Criteria

1. WHEN пользователь открывает приложение THEN система SHALL отображать форму входа/регистрации
2. WHEN пользователь вводит email и пароль THEN система SHALL аутентифицировать через Supabase Auth
3. WHEN пользователь успешно авторизован THEN система SHALL сохранять сессию и предоставлять доступ к функциям
4. WHEN пользователь не авторизован THEN система SHALL ограничивать доступ к основным функциям
5. WHEN пользователь нажимает "Выйти" THEN система SHALL завершать сессию и перенаправлять на страницу входа

### Requirement 3

**User Story:** Как администратор системы, я хочу убрать режим "быстро", чтобы упростить интерфейс и обеспечить единообразный пользовательский опыт

#### Acceptance Criteria

1. WHEN пользователь открывает интерфейс THEN система SHALL НЕ отображать кнопку "⚡ Быстро"
2. WHEN выполняется поиск THEN система SHALL всегда использовать полный режим с ИИ анализом
3. WHEN происходит поиск утечек THEN система SHALL всегда выполнять последовательный поиск по всем источникам
4. WHEN происходит поиск компаний THEN система SHALL всегда включать ИИ обработку результатов

### Requirement 4

**User Story:** Как пользователь, я хочу использовать режим "проверить пароль" с API DeHashed, чтобы проверять скомпрометированные пароли

#### Acceptance Criteria

1. WHEN пользователь выбирает режим "проверить пароль" THEN система SHALL отображать соответствующий интерфейс
2. WHEN пользователь вводит пароль для проверки THEN система SHALL отправлять запрос к API DeHashed
3. WHEN API DeHashed возвращает результаты THEN система SHALL отображать информацию о компрометации пароля
4. WHEN пароль найден в утечках THEN система SHALL показывать детали утечек и рекомендации по безопасности
5. WHEN пароль не найден в утечках THEN система SHALL уведомлять о том, что пароль безопасен
6. WHEN происходит ошибка API DeHashed THEN система SHALL отображать соответствующее сообщение об ошибке

### Requirement 5

**User Story:** Как пользователь, я хочу иметь улучшенную обработку ошибок во всех API эндпоинтах, чтобы получать понятные сообщения вместо технических ошибок

#### Acceptance Criteria

1. WHEN происходит ошибка в любом API эндпоинте THEN система SHALL возвращать структурированный JSON ответ с описанием ошибки
2. WHEN API источника недоступен THEN система SHALL логировать ошибку и продолжать работу с другими источниками
3. WHEN превышен таймаут запроса THEN система SHALL возвращать частичные результаты с уведомлением
4. WHEN происходит критическая ошибка THEN система SHALL возвращать fallback данные вместо полного отказа

### Requirement 6

**User Story:** Как разработчик, я хочу улучшить архитектуру обработки OpenAI запросов, чтобы система была более надежной и масштабируемой

#### Acceptance Criteria

1. WHEN система инициализирует OpenAI клиент THEN она SHALL проверять наличие и валидность API ключа
2. WHEN выполняется запрос к OpenAI THEN система SHALL использовать правильную версию API (Responses API для GPT-5, Chat Completions для других моделей)
3. WHEN OpenAI API возвращает ошибку THEN система SHALL реализовывать fallback логику с retry механизмом
4. WHEN используется новый Responses API THEN система SHALL корректно извлекать текст из ответа
5. WHEN происходит таймаут OpenAI запроса THEN система SHALL возвращать предварительно сформированный ответ